(function(e){function n(d){if(t[d])return t[d].exports;var o=t[d]={i:d,l:!1,exports:{}};return e[d].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};return n.m=e,n.c=t,n.d=function(e,t,d){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:d})},n.n=function(e){var t=e&&e.__esModule?function(){return e['default']}:function(){return e};return n.d(t,'a',t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p='',n(n.s=1)})([function(e,n,t){e.exports=t(2).default,e.exports.default=e.exports},function(e,n,t){'use strict';Object.defineProperty(n,'__esModule',{value:!0});var d=t(0),o=t.n(d),i=t(3),l=o.a.createVNode;o.a.render(l(16,i.a,null,null,{width:100,height:100,style:{width:'800px',height:'800px'}}),document.getElementsByTagName('main')[0])},function(e,n){'use strict';function t(e){return!u(e.prototype)&&!u(e.prototype.render)}function d(e){var n=typeof e;return'string'==n||'number'==n}function o(e){return u(e)||p(e)}function l(e){return p(e)||!1===e||s(e)||u(e)}function i(e){return'function'==typeof e}function a(e){return'string'==typeof e}function r(e){return'number'==typeof e}function p(e){return null===e}function s(e){return!0===e}function u(e){return void 0===e}function c(e){return'object'==typeof e}function f(e){throw e||(e=mn),new Error('Inferno Error: '+e)}function m(e,n){var t={};if(e)for(var d in e)t[d]=e[d];if(n)for(var o in n)t[o]=n[o];return t}function h(){this.listeners=[]}function g(e,n,t,d){var o=Mn.get(e);if(t)o||(o={items:new Map,docEvent:null},o.docEvent=b(e,o),Mn.set(e,o)),!n&&On&&'onClick'===e&&x(d),o.items.set(d,t);else if(o){var i=o.items;i.delete(d)&&0===i.size&&(document.removeEventListener(_(e),o.docEvent),Mn.delete(e))}}function y(e,n,t,d,o,i){for(var l,a=n;0<d;){if(l=t.get(a),l&&(d--,i.dom=a,l.event?l.event(l.data,e):l(e),e.cancelBubble))return;if(a=a.parentNode,null===a||o&&a.disabled)return}}function _(e){return e.substr(2).toLowerCase()}function k(){this.cancelBubble=!0,this.stopImmediatePropagation()}function b(e,n){var t=function(e){var t=n.items.size;if(0<t){e.stopPropagation=k;var d={dom:document};try{Object.defineProperty(e,'currentTarget',{configurable:!0,get:function(){return d.dom}})}catch(n){}y(e,e.target,n.items,t,'click'===e.type,d)}};return document.addEventListener(_(e),t),t}function v(){}function x(e){e.onclick=v}function N(e){return'checkbox'===e||'radio'===e}function C(n){var e=this.vNode,t=e.props||Dn,d=e.dom,o=t.value;if(t.onInput){var i=t.onInput;i.event?i.event(i.data,n):i(n)}else t.oninput&&t.oninput(n);var l=this.vNode,a=l.props||Dn;o!==a.value&&M(a,d)}function S(n){var e=this.vNode.props||Dn,t=e.onChange;t.event?t.event(t.data,n):t(n)}function w(n){n.stopPropagation();var e=this.vNode,t=e.props||Dn,d=e.dom;if(t.onClick){var o=t.onClick;o.event?o.event(o.data,n):o(n)}else t.onclick&&t.onclick(n);var i=this.vNode,l=i.props||Dn;M(l,d)}function O(e,n,t,d,o){M(t,n),o&&(n.vNode=e,d&&(N(t.type)?(n.onclick=w,n.onclick.wrapped=!0):(n.oninput=C,n.oninput.wrapped=!0),t.onChange&&(n.onchange=S,n.onchange.wrapped=!0)))}function M(e,n){var t=e.type,d=e.value,i=e.checked,l=e.multiple,a=e.defaultValue,r=!o(d);t&&t!==n.type&&n.setAttribute('type',t),l&&l!==n.multiple&&(n.multiple=l),o(a)||r||(n.defaultValue=a+''),N(t)?(r&&(n.value=d),!o(i)&&(n.checked=i)):r&&n.value!==d?(n.defaultValue=d,n.value=d):!o(i)&&(n.checked=i)}function E(e,n){var t=e.type;if('optgroup'===t){var d=e.children;if(gn(d))for(var o=0,i=d.length;o<i;o++)U(d[o],n);else nn(d)&&U(d,n)}else U(e,n)}function U(e,n){var t=e.props||Dn,d=e.dom;d.value=t.value,gn(n)&&-1!==n.indexOf(t.value)||t.value===n?d.selected=!0:(!o(n)||!o(t.selected))&&(d.selected=t.selected||!1)}function V(n){var e=this.vNode,t=e.props||Dn,d=e.dom,o=t.value;if(t.onChange){var i=t.onChange;i.event?i.event(i.data,n):i(n)}else t.onchange&&t.onchange(n);var l=this.vNode,a=l.props||Dn;o!==a.value&&I(l,d,a,!1)}function P(e,n,t,d,o){I(e,n,t,d),o&&(n.vNode=e,d&&(n.onchange=V,n.onchange.wrapped=!0))}function I(e,n,t,d){t.multiple!==n.multiple&&(n.multiple=t.multiple);var a=e.children;if(!l(a)){var r=t.value;if(d&&o(r)&&(r=t.defaultValue),gn(a))for(var p=0,i=a.length;p<i;p++)E(a[p],r);else nn(a)&&E(a,r)}}function D(n){var e=this.vNode.props||Dn,t=e.onChange;t.event?t.event(t.data,n):t(n)}function R(n){var e=this.vNode,t=e.props||Dn,d=t.value;if(t.onInput){var o=t.onInput;o.event?o.event(o.data,n):o(n)}else t.oninput&&t.oninput(n);var i=this.vNode,l=i.props||Dn;d!==l.value&&W(i,e.dom,!1)}function T(e,n,t,d,o){W(t,n,d),o&&(n.vNode=e,d&&(n.oninput=R,n.oninput.wrapped=!0,t.onChange&&(n.onchange=D,n.onchange.wrapped=!0)))}function W(e,n,t){var d=e.value,i=n.value;if(!o(d))i!==d&&(n.defaultValue=d,n.value=d);else if(t){var l=e.defaultValue;o(l)?''!==i&&(n.defaultValue='',n.value=''):l!==i&&(n.defaultValue=l,n.value=l)}}function L(e,n,t,d,o,i){512&e&&O(n,t,d,o,i),2048&e&&P(n,t,d,o,i),1024&e&&T(n,t,d,o,i)}function A(e){return e.type&&N(e.type)?!o(e.checked):!o(e.value)}function $(e){for(var n=e.firstChild;n;)if(!(8===n.nodeType))n=n.nextSibling;else if('!'===n.data){var t=document.createTextNode('');e.replaceChild(t,n),n=n.nextSibling}else{var d=n.previousSibling;e.removeChild(n),n=d||e.firstChild}}function K(e,n,t,d,o,i){var l=e.type,a=e.ref,r=e.props||Dn;if(i){var p=n.namespaceURI===bn,s=De(e,l,r,d,p,t),u=s._lastInput;s._vNode=e,G(u,n,t,s._childContext,p),e.dom=u.dom,Ve(e,a,s,t),s._updating=!1,yn.findDOMNodeEnabled&&Vn.set(s,n)}else{var c=We(e,l,r,d);G(c,n,t,d,o),e.children=c,e.dom=c.dom,Pe(r,a,n,t)}return n}function B(e,n,t,d,i){var a=e.children,r=e.props,p=e.className,s=e.flags,u=e.ref;if(i=i||0<(128&s),1!==n.nodeType||n.tagName.toLowerCase()!==e.type){var c=Me(e,null,t,d,i);return e.dom=c,je(n.parentNode,c,n),c}if(e.dom=n,l(a)?null!==n.firstChild&&(n.textContent=''):F(a,n,t,d,i),r){var f=!1,m=0<(3584&s);for(var h in m&&(f=A(r)),r)ve(h,null,r[h],n,i,f);m&&L(s,e,n,r,!0,f)}return o(p)?''!==n.className&&n.removeAttribute('class'):i?n.setAttribute('class',p):n.className=p,u&&Ie(n,u,t),n}function F(e,n,t,o,l){$(n);var a=n.firstChild;if(d(e))p(a)||3!==a.nodeType?''===e?n.appendChild(document.createTextNode('')):n.textContent=e:a.nodeValue!==e&&(a.nodeValue=e),p(a)||(a=a.nextSibling);else if(gn(e)){for(var r,s=0,i=e.length;s<i;s++)if(r=e[s],!p(r)&&c(r))if(!p(a)){var u=a.nextSibling;G(r,a,t,o,l),a=u}else Se(r,n,t,o,l);}else p(a)?Se(e,n,t,o,l):(G(e,a,t,o,l),a=a.nextSibling);for(;a;){var f=a.nextSibling;n.removeChild(a),a=f}}function j(e,n){if(3!==n.nodeType){var t=we(e,null);return e.dom=t,je(n.parentNode,t,n),t}var d=e.children;return n.nodeValue!==d&&(n.nodeValue=d),e.dom=n,n}function z(e,n){return e.dom=n,n}function G(e,n,t,d,o){var i=e.flags;28&i?K(e,n,t,d,o,0<(4&i)):3970&i?B(e,n,t,d,o):1&i?j(e,n):4096&i?z(e,n):(!1,f())}function J(e,n,t){if(!p(n)){var d=n.firstChild;if(!p(d)){for(G(e,d,t,Dn,!1),d=n.firstChild;d=d.nextSibling;)n.removeChild(d);return!0}}return!1}function Y(e,n,t,d){var o=e.type,i=Un.get(o);if(!u(i)){var l=e.key,a=null===l?i.nonKeyed:i.keyed.get(l);if(!u(a)){var r=a.pop();if(!u(r))return ce(r,e,null,n,t,d,!0),e.dom}}return null}function H(e){var n=e.type,t=e.key,d=Un.get(n);if(u(d)&&(d={keyed:new Map,nonKeyed:[]},Un.set(n,d)),p(t))d.nonKeyed.push(e);else{var o=d.keyed.get(t);u(o)&&(o=[],d.keyed.set(t,o)),o.push(e)}}function q(e,n,t,d){var o=e.type,i=En.get(o);if(!u(i)){var l=e.key,a=null===l?i.nonKeyed:i.keyed.get(l);if(!u(a)){var r=a.pop();if(!u(r)){var p=e.flags,s=me(r,e,null,n,t,d,0<(4&p),!0);if(!s)return e.dom}}}return null}function X(e){var n=e.ref,t=n&&(n.onComponentWillMount||n.onComponentWillUnmount||n.onComponentDidMount||n.onComponentWillUpdate||n.onComponentDidUpdate);if(!t){var d=e.type,o=e.key,i=En.get(d);if(u(i)&&(i={keyed:new Map,nonKeyed:[]},En.set(d,i)),p(o))i.nonKeyed.push(e);else{var l=i.keyed.get(o);u(l)&&(l=[],i.keyed.set(o,l)),l.push(e)}}}function Z(e,n,t,d,o){var i=e.flags;28&i?ee(e,n,t,d,o):3970&i?ne(e,n,t,d,o):i&4097&&Q(e,n)}function Q(e,n){p(n)||ze(n,e.dom)}function ee(e,n,t,d,i){var l=e.children,a=e.flags,r=4&a,s=e.props||Dn,c=e.ref,f=e.dom;i||(r?!l._unmounted&&(!p(yn.beforeUnmount)&&yn.beforeUnmount(e),!u(l.componentWillUnmount)&&l.componentWillUnmount(),c&&!i&&c(null),l._unmounted=!0,yn.findDOMNodeEnabled&&Vn.delete(l),Z(l._lastInput,null,l._lifecycle,!1,i)):(!o(c)&&!o(c.onComponentWillUnmount)&&c.onComponentWillUnmount(f,s),Z(l,null,t,!1,i))),n&&ze(n,f),yn.recyclingEnabled&&!r&&(n||d)&&X(e)}function ne(e,n,t,d,i){var l=e.dom,a=e.ref,r=e.props;a&&!i&&de(a);var s=e.children;if(o(s)||te(s,t,i),!p(r))for(var u in r)null!==r[u]&&be(u)&&(xe(u,r[u],null,l),r[u]=null);p(n)||ze(n,l),yn.recyclingEnabled&&(n||d)&&H(e)}function te(e,n,t){if(gn(e))for(var d,o=0,i=e.length;o<i;o++)d=e[o],!l(d)&&c(d)&&Z(d,null,n,!1,t);else c(e)&&Z(e,null,n,!1,t)}function de(e){if(i(e))e(null);else{if(l(e))return;!1,f()}}function oe(e){yn.findDOMNodeEnabled||(!1,f());var n=e&&e.nodeType?e:null;return Vn.get(e)||n}function ie(e){for(var n,t=0,d=Pn.length;t<d;t++)if(n=Pn[t],n.dom===e)return n;return null}function le(e,n,t){var d={dom:e,input:n,lifecycle:t};return Pn.push(d),d}function ae(e){for(var n=0,t=Pn.length;n<t;n++)if(Pn[n]===e)return void Pn.splice(n,1)}function re(e,n){if(In===n&&(!1,f()),e!==fn){var t=ie(n);if(p(t)){var d=new h;l(e)||(e.dom&&(e=Xe(e)),!J(e,n,d)&&Se(e,n,d,Dn,!1),t=le(n,e,d),d.trigger())}else{var i=t.lifecycle;i.listeners=[],o(e)?(Z(t.input,n,i,!1,!1),ae(t)):(e.dom&&(e=Xe(e)),se(t.input,e,n,i,Dn,!1,!1)),t.input=e,i.trigger()}if(t){var a=t.input;if(a&&28&a.flags)return a.children}}}function pe(e){return function(n,t){e||(e=n),re(t,e)}}function se(e,n,t,d,o,i,l){if(e!==n){var a=e.flags,r=n.flags;if(28&r){var p=0<(4&r);28&a?me(e,n,t,d,o,i,p,l):Te(t,Ue(n,null,d,o,i,p),e,d,l)}else 3970&r?3970&a?ce(e,n,t,d,o,i,l):Te(t,Me(n,null,d,o,i),e,d,l):1&r?1&a?he(e,n):Te(t,we(n,null),e,d,l):4096&r?4096&a?ge(e,n):Te(t,Oe(n,null),e,d,l):Re(e,n,t,d,o,i,l)}}function ue(e,n,t,d){nn(e)?Z(e,n,t,!0,d):gn(e)?Ge(n,e,t,d):n.textContent=''}function ce(e,n,t,d,i,l,a){var r=n.type,p=e.type;if(p!==r)Fe(e,n,t,d,i,l,a);else{var s=e.dom,u=e.props,c=n.props,f=e.children,m=n.children,h=e.flags,g=n.flags,y=n.ref,_=e.className,k=n.className;if(n.dom=s,l=l||0<(128&g),f!==m){var b=!0===l&&'foreignObject'!==n.type;fe(h,g,f,m,s,d,i,b,a)}if(u!==c){var v=u||Dn,x=c||Dn,N=!1;if(x!==Dn){var C=0<(3584&g);for(var S in C&&(N=A(x)),x){var w=x[S],O=v[S];ve(S,O,w,s,l,N)}C&&L(g,n,s,x,a,N)}if(v!==Dn)for(var M in v)o(x[M])&&!o(v[M])&&Ce(M,v[M],s,g)}_!==k&&(o(k)?s.removeAttribute('class'):l?s.setAttribute('class',k):s.className=k),y&&(e.ref!==y||a)&&Ie(s,y,d)}}function fe(e,n,t,o,i,a,r,p,s){var u=!1,c=!1;64&n?u=!0:0<(32&e)&&0<(32&n)?(c=!0,u=!0):l(o)?ue(t,i,a,s):l(t)?d(o)?Le(i,o):gn(o)?Ee(o,i,a,r,p):Se(o,i,a,r,p):d(o)?d(t)?Ae(i,o):(ue(t,i,a,s),Le(i,o)):gn(o)?gn(t)?(u=!0,Ye(t,o)&&(c=!0)):(ue(t,i,a,s),Ee(o,i,a,r,p)):gn(t)?(Ge(i,t,a,s),Se(o,i,a,r,p)):nn(o)&&(nn(t)?se(t,o,i,a,r,p,s):(ue(t,i,a,s),Se(o,i,a,r,p))),u&&(c?_e(t,o,i,a,r,p,s):ye(t,o,i,a,r,p,s))}function me(e,n,t,i,a,r,s,h){var g=e.type,y=n.type,_=e.key,k=n.key;if(g!==y||_!==k)return Fe(e,n,t,i,a,r,h),!1;var b=n.props||Dn;if(s){var v=e.children;if(v._updating=!0,v._unmounted){if(p(t))return!0;je(t,Ue(n,null,i,a,r,0<(4&n.flags)),e.dom)}else{var x,N=!u(v.componentDidUpdate),C=v.state,S=N?m(C,null):C,w=v.props;o(v.getChildContext)||(x=v.getChildContext()),n.children=v,v._isSVG=r,x=o(x)?a:m(a,x);var O=v._lastInput,M=v._updateComponent(S,C,w,b,a,!1,!1),E=!0;v._childContext=x,l(M)?M=Qe():M===fn?(M=O,E=!1):d(M)?M=en(M,null):gn(M)?(!1,f()):c(M)&&!p(M.dom)&&(M=Xe(M)),28&M.flags?M.parentVNode=n:28&O.flags&&(O.parentVNode=n),v._lastInput=M,v._vNode=n,E&&(se(O,M,t,i,x,r,h),N&&v.componentDidUpdate&&v.componentDidUpdate(w,S),!p(yn.afterUpdate)&&yn.afterUpdate(n),yn.findDOMNodeEnabled&&Vn.set(v,M.dom)),n.dom=M.dom}v._updating=!1}else{var U=!0,V=e.props,P=n.ref,I=!o(P),D=e.children,R=D;n.dom=e.dom,n.children=D,_===k?I&&!o(P.onComponentShouldUpdate)&&(U=P.onComponentShouldUpdate(V,b)):U=!0,!1!==U&&(I&&!o(P.onComponentWillUpdate)&&P.onComponentWillUpdate(V,b),R=y(b,a),l(R)?R=Qe():d(R)&&R!==fn?R=en(R,null):gn(R)?(!1,f()):c(R)&&!p(R.dom)&&(R=Xe(R)),R!==fn&&(se(D,R,t,i,a,r,h),n.children=R,I&&!o(P.onComponentDidUpdate)&&P.onComponentDidUpdate(V,b),n.dom=R.dom)),28&R.flags?R.parentVNode=n:28&D.flags&&(D.parentVNode=n)}return!1}function he(e,n){var t=n.children,d=e.dom;n.dom=d,e.children!==t&&(d.nodeValue=t)}function ge(e,n){n.dom=e.dom}function ye(e,n,t,d,o,l,a){for(var r=e.length,p=n.length,s=r>p?p:r,u=0;u<s;u++){var i=n[u];i.dom&&(i=n[u]=Xe(i)),se(e[u],i,t,d,o,l,a)}if(r<p)for(u=s;u<p;u++){var c=n[u];c.dom&&(c=n[u]=Xe(c)),$e(t,Se(c,null,d,o,l))}else if(0===p)Ge(t,e,d,a);else if(r>p)for(u=s;u<r;u++)Z(e[u],t,d,!1,a)}function _e(e,n,t,d,o,l,a){var r,i,s,c,f,m,h,g=e.length,y=n.length,_=g-1,k=y-1,b=0,v=0;if(0===g)return void(0<y&&Ee(n,t,d,o,l));if(0===y)return void Ge(t,e,d,a);var x=e[b],N=n[v],C=e[_],S=n[k];N.dom&&(n[v]=N=Xe(N)),S.dom&&(n[k]=S=Xe(S));outer:for(;;){for(;x.key===N.key;){if(se(x,N,t,d,o,l,a),b++,v++,b>_||v>k)break outer;x=e[b],N=n[v],N.dom&&(n[v]=N=Xe(N))}for(;C.key===S.key;){if(se(C,S,t,d,o,l,a),_--,k--,b>_||v>k)break outer;C=e[_],S=n[k],S.dom&&(n[k]=S=Xe(S))}if(C.key===N.key){se(C,N,t,d,o,l,a),Ke(t,N.dom,x.dom),_--,v++,C=e[_],N=n[v],N.dom&&(n[v]=N=Xe(N));continue}if(x.key===S.key){se(x,S,t,d,o,l,a),m=k+1,f=m<n.length?n[m].dom:null,Ke(t,S.dom,f),b++,k--,x=e[b],S=n[k],S.dom&&(n[k]=S=Xe(S));continue}break}if(b>_){if(v<=k)for(m=k+1,f=m<n.length?n[m].dom:null;v<=k;)h=n[v],h.dom&&(n[v]=h=Xe(h)),v++,Ke(t,Se(h,null,d,o,l),f);}else if(v>k)for(;b<=_;)Z(e[b++],t,d,!1,a);else{g=_-b+1,y=k-v+1;var w=Array(y);for(r=0;r<y;r++)w[r]=-1;var O=!1,M=0,E=0;if(4>=y||16>=g*y){for(r=b;r<=_;r++)if(s=e[r],E<y)for(i=v;i<=k;i++)if(c=n[i],s.key===c.key){w[i-v]=r,M>i?O=!0:M=i,c.dom&&(n[i]=c=Xe(c)),se(s,c,t,d,o,l,a),E++,e[r]=null;break}}else{var U=new Map;for(r=v;r<=k;r++)U.set(n[r].key,r);for(r=b;r<=_;r++)s=e[r],E<y&&(i=U.get(s.key),!u(i)&&(c=n[i],w[i-v]=r,M>i?O=!0:M=i,c.dom&&(n[i]=c=Xe(c)),se(s,c,t,d,o,l,a),E++,e[r]=null))}if(g===e.length&&0==E)for(Ge(t,e,d,a);v<y;)h=n[v],h.dom&&(n[v]=h=Xe(h)),v++,Ke(t,Se(h,null,d,o,l),null);else{for(r=g-E;0<r;)s=e[b++],p(s)||(Z(s,t,d,!0,a),r--);if(O){var V=ke(w);for(i=V.length-1,r=y-1;0<=r;r--)-1===w[r]?(M=r+v,h=n[M],h.dom&&(n[M]=h=Xe(h)),m=M+1,f=m<n.length?n[m].dom:null,Ke(t,Se(h,null,d,o,l),f)):0>i||r!==V[i]?(M=r+v,h=n[M],m=M+1,f=m<n.length?n[m].dom:null,Ke(t,h.dom,f)):i--}else if(E!==y)for(r=y-1;0<=r;r--)-1===w[r]&&(M=r+v,h=n[M],h.dom&&(n[M]=h=Xe(h)),m=M+1,f=m<n.length?n[m].dom:null,Ke(t,Se(h,null,d,o,l),f))}}}function ke(e){var n,t,d,o,i,l=e.slice(0),a=[0],r=e.length;for(n=0;n<r;n++){var p=e[n];if(-1!==p){if(t=a[a.length-1],e[t]<p){l[n]=t,a.push(n);continue}for(d=0,o=a.length-1;d<o;)i=0|(d+o)/2,e[a[i]]<p?d=i+1:o=i;p<e[a[d]]&&(0<d&&(l[n]=a[d-1]),a[d]=n)}}for(d=a.length,o=a[d-1];0<d--;)a[d]=o,o=l[o];return a}function be(e){return'o'===e[0]&&'n'===e[1]}function ve(e,n,t,d,i,l){if(n!==t){if(Sn.has(e)||l&&'value'===e)return;if(xn.has(e))e='autoFocus'===e?e.toLowerCase():e,d[e]=!!t;else if(vn.has(e)){var a=o(t)?'':t;d[e]!==a&&(d[e]=a)}else if(be(e))xe(e,n,t,d);else if(o(t))d.removeAttribute(e);else if('style'===e)Ne(n,t,d);else if('dangerouslySetInnerHTML'===e){var r=n&&n.__html,p=t&&t.__html;r===p||o(p)||(d.innerHTML=p)}else i&&Nn.has(e)?d.setAttributeNS(Nn.get(e),e,t):d.setAttribute(e,t)}}function xe(e,n,t,d){if(n!==t)if(wn.has(e))g(e,n,t,d);else{var l=e.toLowerCase(),a=d[l];if(a&&a.wrapped)return;if(!i(t)&&!o(t)){var r=t.event;r&&i(r)?d[l]=function(n){r(t.data,n)}:(!1,f())}else d[l]=t}}function Ne(e,n,t){var d,i,l=t.style;if(a(n))return void(l.cssText=n);if(!o(e)&&!a(e)){for(d in n)i=n[d],i!==e[d]&&(l[d]=!r(i)||Cn.has(d)?i:i+'px');for(d in e)o(n[d])&&(l[d]='')}else for(d in n)i=n[d],l[d]=!r(i)||Cn.has(d)?i:i+'px'}function Ce(e,n,t,d){'value'===e?t.value=2048&d?null:'':'style'===e?t.removeAttribute('style'):be(e)?g(e,n,null,t):t.removeAttribute(e)}function Se(e,n,t,d,o){var i=e.flags;if(3970&i)return Me(e,n,t,d,o);return 28&i?Ue(e,n,t,d,o,0<(4&i)):4096&i?Oe(e,n):1&i?we(e,n):void(!1,f())}function we(e,n){var t=document.createTextNode(e.children);return e.dom=t,p(n)||$e(n,t),t}function Oe(e,n){var t=document.createTextNode('');return e.dom=t,p(n)||$e(n,t),t}function Me(e,n,t,o,i){var a;if(yn.recyclingEnabled&&(a=Y(e,t,o,i),!p(a)))return p(n)||$e(n,a),a;var r=e.flags;i=i||0<(128&r),a=Be(e.type,i);var s=e.children,u=e.props,c=e.className,f=e.ref;if(e.dom=a,!l(s))if(d(s))Le(a,s);else{var m=!0===i&&'foreignObject'!==e.type;gn(s)?Ee(s,a,t,o,m):nn(s)&&Se(s,a,t,o,m)}if(!p(u)){var h=!1,g=0<(3584&r);for(var y in g&&(h=A(u)),u)ve(y,null,u[y],a,i,h);g&&L(r,e,a,u,!0,h)}return null!==c&&(i?a.setAttribute('class',c):a.className=c),p(f)||Ie(a,f,t),p(n)||$e(n,a),a}function Ee(e,n,t,d,o){for(var a,r=0,i=e.length;r<i;r++)a=e[r],l(a)||(a.dom&&(e[r]=a=Xe(a)),Se(e[r],n,t,d,o))}function Ue(e,n,t,d,o,i){var l;if(yn.recyclingEnabled&&(l=q(e,t,d,o),!p(l)))return p(n)||$e(n,l),l;var a=e.type,r=e.props||Dn,s=e.ref;if(i){var u=De(e,a,r,d,o,t),c=u._lastInput;u._vNode=e,e.dom=l=Se(c,null,t,u._childContext,o),p(n)||$e(n,l),Ve(e,s,u,t),u._updating=!1,yn.findDOMNodeEnabled&&Vn.set(u,l)}else{var f=We(e,a,r,d);e.dom=l=Se(f,null,t,d,o),e.children=f,Pe(r,s,l,t),p(n)||$e(n,l)}return l}function Ve(e,n,t,d){n&&(i(n)?n(t):(!1,f()));var o=!u(t.componentDidMount),l=yn.afterMount;(o||!p(l))&&d.addListener(function(){t._updating=!0,l&&l(e),o&&t.componentDidMount(),t._updating=!1})}function Pe(e,n,t,d){n&&(!o(n.onComponentWillMount)&&n.onComponentWillMount(e),!o(n.onComponentDidMount)&&d.addListener(function(){return n.onComponentDidMount(t,e)}))}function Ie(e,n,t){if(i(n))t.addListener(function(){return n(e)});else{if(l(n))return;!1,f()}}function De(e,n,t,i,a,r){u(i)&&(i=Dn);var s=new n(t,i);e.children=s,s._blockSetState=!1,s.context=i,s.props===Dn&&(s.props=t),s._lifecycle=r,s._unmounted=!1,s._pendingSetState=!0,s._isSVG=a,o(s.componentWillMount)||(s._blockRender=!0,s.componentWillMount(),s._blockRender=!1);var c;o(s.getChildContext)||(c=s.getChildContext()),s._childContext=o(c)?i:m(i,c),p(yn.beforeRender)||yn.beforeRender(s);var h=s.render(t,s.state,i);return p(yn.afterRender)||yn.afterRender(s),gn(h)?(!1,f()):l(h)?h=Qe():d(h)?h=en(h,null):(h.dom&&(h=Xe(h)),28&h.flags&&(h.parentVNode=e)),s._pendingSetState=!1,s._lastInput=h,s}function Re(e,n,t,d,o,i,l){Te(t,Se(n,null,d,o,i),e,d,l)}function Te(e,n,t,d,o){Z(t,null,d,!1,o),je(e,n,t.dom)}function We(e,n,t,o){var i=n(t,o);return gn(i)?(!1,f()):l(i)?i=Qe():d(i)?i=en(i,null):(i.dom&&(i=Xe(i)),28&i.flags&&(i.parentVNode=e)),i}function Le(e,n){''===n?e.appendChild(document.createTextNode('')):e.textContent=n}function Ae(e,n){e.firstChild.nodeValue=n}function $e(e,n){e.appendChild(n)}function Ke(e,n,t){o(t)?$e(e,n):e.insertBefore(n,t)}function Be(e,n){return!0===n?document.createElementNS(bn,e):document.createElement(e)}function Fe(e,n,t,d,o,i,l){Z(e,null,d,!1,l);var a=Se(n,null,d,o,i);n.dom=a,je(t,a,e.dom)}function je(e,n,t){e||(e=t.parentNode),e.replaceChild(n,t)}function ze(e,n){e.removeChild(n)}function Ge(e,n,t,d){yn.recyclingEnabled&&(!yn.recyclingEnabled||d)||Je(null,n,t,d),e.textContent=''}function Je(e,n,t,d){for(var o,a=0,i=n.length;a<i;a++)o=n[a],l(o)||Z(o,e,t,!0,d)}function Ye(e,n){return 0<n.length&&!o(n[0])&&!o(n[0].key)&&0<e.length&&!o(e[0])&&!o(e[0].key)}function He(e,n,t,d,o,i,l){this.children=e,this.className=n,this.dom=null,this.flags=t,this.key=d,this.props=o,this.ref=i,this.type=l}function qe(e,n,d,o,i,l,a,r){16&e&&(e=t(n)?4:8);var p=new He(void 0===o?null:o,void 0===d?null:d,e,void 0===l?null:l,void 0===i?null:i,void 0===a?null:a,n);return!0!==r&&un(p),null!==yn.createVNode&&yn.createVNode(p),p}function Xe(e){var n,t=e.flags;if(28&t){var o,a=e.props;if(p(a))o=Dn;else for(var r in o={},a)o[r]=a[r];n=qe(t,e.type,null,null,o,e.key,e.ref,!0);var s=n.props,u=s.children;if(u)if(gn(u)){var c=u.length;if(0<c){for(var f,m=[],h=0;h<c;h++)f=u[h],d(f)?m.push(f):!l(f)&&nn(f)&&m.push(Xe(f));s.children=m}}else nn(u)&&(s.children=Xe(u));n.children=null}else if(3970&t){var i,g=e.children,y=e.props;if(null===y)i=Dn;else for(var _ in i={},y)i[_]=y[_];n=qe(t,e.type,e.className,g,i,e.key,e.ref,!g)}else 1&t&&(n=en(e.children,e.key));return n}function Ze(e,n){for(var t=[],o=arguments.length-2;0<o--;)t[o]=arguments[o+2];var a=t,r=t.length;0<r&&!u(t[0])&&(!n&&(n={}),1===r&&(a=t[0]),!u(a)&&(n.children=a));var p;if(gn(e)){for(var s=[],c=0,i=e.length;c<i;c++)s.push(Xe(e[c]));p=s}else{var f=e.flags,h=e.className,g=e.key,y=e.ref;if(n&&(n.hasOwnProperty('className')&&(h=n.className),n.hasOwnProperty('ref')&&(y=n.ref),n.hasOwnProperty('key')&&(g=n.key)),28&f){p=qe(f,e.type,h,null,e.props||n?m(e.props,n):Dn,g,y,!0);var _=p.props;if(_){var k=_.children;if(k)if(gn(k)){var b=k.length;if(0<b){for(var v,x=[],N=0;N<b;N++)v=k[N],d(v)?x.push(v):!l(v)&&nn(v)&&x.push(Xe(v));_.children=x}}else nn(k)&&(_.children=Xe(k))}p.children=null}else 3970&f?(a=n&&!u(n.children)?n.children:e.children,p=qe(f,e.type,h,a,e.props||n?m(e.props,n):Dn,g,y,!1)):1&f&&(p=en(e.children,g))}return p}function Qe(){return qe(4096,null)}function en(e,n){return qe(1,null,null,e,null,n)}function nn(e){return!!e.flags}function tn(e,n){return n.key=e,n}function dn(e,n){return r(e)&&(e='.'+e),p(n.key)||'.'===n.key[0]?tn(e,n):n}function on(e,n){return n.key=e+n.key,n}function ln(e,t,o,i){for(var a=e.length;o<a;o++){var r=e[o],n=i+'.'+o;l(r)||(gn(r)?ln(r,t,0,n):(d(r)?r=en(r,null):(nn(r)&&r.dom||r.key&&'.'===r.key[0])&&(r=Xe(r)),r=p(r.key)||'.'===r.key[0]?tn(n,r):on(i,r),t.push(r)))}}function an(e){var t;!0===e.$?e=e.slice():e.$=!0;for(var o,n=0,i=e.length;n<i;n++){if(o=e[n],l(o)||gn(o)){var a=(t||e).slice(0,n);return ln(e,a,n,''),a}d(o)?(t||(t=e.slice(0,n)),t.push(dn(n,en(o,null)))):nn(o)&&null!==o.dom||p(o.key)&&0==(64&o.flags)?(t||(t=e.slice(0,n)),t.push(dn(n,Xe(o)))):t&&t.push(dn(n,Xe(o)))}return t||e}function rn(e){if(gn(e))return an(e);return nn(e)&&null!==e.dom?Xe(e):e}function pn(e,n,t){3970&e.flags&&(o(t)&&n.hasOwnProperty('children')&&(e.children=n.children),n.hasOwnProperty('className')&&(e.className=n.className||null,delete n.className)),n.hasOwnProperty('ref')&&(e.ref=n.ref,delete n.ref),n.hasOwnProperty('key')&&(e.key=n.key,delete n.key)}function sn(e){if('svg'===e)return 128;return'input'===e?512:'select'===e?2048:'textarea'===e?1024:'media'===e?256:2}function un(e){var n=e.props,t=e.children;if(28&e.flags){var d=e.type,i=d.defaultProps;if(!o(i))if(!n)n=e.props=i;else for(var r in i)u(n[r])&&(n[r]=i[r]);a(d)&&(e.flags=sn(d),n&&n.children&&(e.children=n.children,t=n.children))}n&&(pn(e,n,t),!l(n.children)&&(n.children=rn(n.children))),l(t)||(e.children=rn(t))}function cn(e,n){return i(n)?{data:e,event:n}:null}Object.defineProperty(n,'__esModule',{value:!0});var fn='$NO_OP',mn='a runtime error occured! Use Inferno in development environment to find the error.',hn=!!('undefined'!=typeof window&&window.document),gn=Array.isArray;h.prototype.addListener=function(e){this.listeners.push(e)},h.prototype.trigger=function(){for(var e,n=this.listeners;e=n.shift();)e()};var yn={afterMount:null,afterRender:null,afterUpdate:null,beforeRender:null,beforeUnmount:null,createVNode:null,findDOMNodeEnabled:!1,recyclingEnabled:!1,roots:[]},_n='http://www.w3.org/1999/xlink',kn='http://www.w3.org/XML/1998/namespace',bn='http://www.w3.org/2000/svg',vn=new Set;vn.add('volume'),vn.add('defaultChecked');var xn=new Set(['muted','scoped','loop','open','checked','default','capture','disabled','readOnly','required','autoplay','controls','seamless','reversed','allowfullscreen','novalidate','hidden','autoFocus','selected','indeterminate']),Nn=new Map;Nn.set('xlink:href',_n),Nn.set('xlink:arcrole',_n),Nn.set('xlink:actuate',_n),Nn.set('xlink:show',_n),Nn.set('xlink:role',_n),Nn.set('xlink:title',_n),Nn.set('xlink:type',_n),Nn.set('xml:base',kn),Nn.set('xml:lang',kn),Nn.set('xml:space',kn);var Cn=new Set(['animationIterationCount','borderImageOutset','borderImageSlice','borderImageWidth','boxFlex','boxFlexGroup','boxOrdinalGroup','columnCount','flex','flexGrow','flexPositive','flexShrink','flexNegative','flexOrder','gridRow','gridColumn','fontWeight','lineClamp','lineHeight','opacity','order','orphans','tabSize','widows','zIndex','zoom','fillOpacity','floodOpacity','stopOpacity','strokeDasharray','strokeDashoffset','strokeMiterlimit','strokeOpacity','strokeWidth']),Sn=new Set;Sn.add('children'),Sn.add('childrenType'),Sn.add('defaultValue'),Sn.add('ref'),Sn.add('key'),Sn.add('checked'),Sn.add('multiple');var wn=new Set(['onClick','onMouseDown','onMouseUp','onMouseMove','onSubmit','onDblClick','onKeyDown','onKeyUp','onKeyPress']),On=hn&&!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),Mn=new Map,En=new Map,Un=new Map,Vn=new Map,Pn=yn.roots;var In=hn?document.body:null,Dn={};var Rn='3.7.1';n['default']={EMPTY_OBJ:Dn,NO_OP:fn,cloneVNode:Ze,createRenderer:pe,createVNode:qe,findDOMNode:oe,getFlagsForElementVnode:sn,internal_DOMNodeMap:Vn,internal_isUnitlessNumber:Cn,internal_normalize:un,internal_patch:se,linkEvent:cn,options:yn,render:re,version:Rn},n.EMPTY_OBJ=Dn,n.NO_OP=fn,n.cloneVNode=Ze,n.createRenderer=pe,n.createVNode=qe,n.findDOMNode=oe,n.getFlagsForElementVnode=sn,n.internal_DOMNodeMap=Vn,n.internal_isUnitlessNumber=Cn,n.internal_normalize=un,n.internal_patch=se,n.linkEvent=cn,n.options=yn,n.render=re,n.version=Rn},function(e,n,t){'use strict';var d=t(0),o=t.n(d),i=t(4),l=t.n(i),a=o.a.createVNode;class r extends l.a{constructor(e){super(e);const n=[];for(let t=0;t<e.height;++t){const t=[];for(let n=0;n<e.width;++n)t.push(Math.random());n.push(t)}this.state={field:n}}componentDidMount(){window.requestAnimationFrame(()=>this.tick())}tick(){const{width:e,height:n}=this.props,{field:t}=this.state,d=[];for(let o=0;o<this.props.height;++o){const i=[];for(let d=0;d<this.props.width;++d){const l=t[o][d];let a=0;const r=t[(o+n-1)%n][(d+e-1)%e]+t[(o+n-1)%n][d]+t[(o+n-1)%n][(d+1)%e]+t[o][(d+e-1)%e]+t[o][(d+1)%e]+t[(o+1)%n][(d+e-1)%e]+t[(o+1)%n][d]+t[(o+1)%n][(d+1)%e];1>=r?a=0:1<r&&2>=r?a=(r-1)*l:2<r&&3>=r?a=l+(r-2)*(1-l):3<r&&4>=r?a=4-r:4<r&&(a=0),i.push(a)}d.push(i)}this.setState({field:d}),window.requestAnimationFrame(()=>this.tick())}render(){const{width:e,height:n,style:t}=this.props,{field:d}=this.state;return a(128,'svg',null,this.state.field.map((e,n)=>e.map((e,t)=>a(2,'rect',null,null,{x:t,y:n,width:1,height:1,fill:`rgba(0,0,0,${e})`}))),{viewBox:`0 0 ${e} ${n}`,style:t})}}n.a=r},function(e,n,t){e.exports=t(5).default,e.exports.default=e.exports},function(e,n,t){'use strict';function d(e){var n=typeof e;return'string'==n||'number'==n}function o(e){return p(e)||a(e)}function i(e){return a(e)||!1===e||r(e)||p(e)}function l(e){return'function'==typeof e}function a(e){return null===e}function r(e){return!0===e}function p(e){return void 0===e}function s(e){throw e||(e=_),new Error('Inferno Error: '+e)}function u(e,n){var t={};if(e)for(var d in e)t[d]=e[d];if(n)for(var o in n)t[o]=n[o];return t}function c(e,n){if(28&e.flags){var t=e.parentVNode;t&&(t.dom=n,c(t,n))}}function f(e,n,t){var d=v.get(e);void 0===d&&(d=[],v.set(e,d),x.then(function(){v.delete(e),e._updating=!0,h(e,n,function(){for(var n=0,t=d.length;n<t;n++)d[n].call(e)}),e._updating=!1})),o(t)||d.push(t)}function m(e,n,t){l(n)&&(n=n(e.state,e.props,e.context));var d=e._pendingState;if(o(d))e._pendingState=d=n;else for(var i in n)d[i]=n[i];if(k&&!e._pendingSetState&&!e._blockRender)e._updating?f(e,!1,t):(e._pendingSetState=!0,e._updating=!0,h(e,!1,t),e._updating=!1);else{var a=e.state;if(null===a)e.state=d;else for(var r in d)a[r]=d[r];e._pendingState=null,!o(t)&&e._blockRender&&e._lifecycle.addListener(t.bind(e))}}function h(e,n,t){if(!e._unmounted){if(n||!e._blockRender){e._pendingSetState=!1;var l=e._pendingState,r=e.state,p=u(r,l),f=e.props,m=e.context;e._pendingState=null;var h=e._updateComponent(r,p,f,f,m,n,!0),_=!0;i(h)?h=g.createVNode(4096,null):h===y?(h=e._lastInput,_=!1):d(h)?h=g.createVNode(1,null,null,h):b(h)&&(!1,s());var k=e._lastInput,v=e._vNode,x=k.dom&&k.dom.parentNode||(k.dom=v.dom);if(e._lastInput=h,_){var N;o(e.getChildContext)||(N=e.getChildContext()),N=o(N)?e._childContext:u(m,N);var C=e._lifecycle;g.internal_patch(k,h,x,C,N,e._isSVG,!1),C.trigger(),o(e.componentDidUpdate)||e.componentDidUpdate(f,r,m),a(g.options.afterUpdate)||g.options.afterUpdate(v)}var S=v.dom=h.dom;g.options.findDOMNodeEnabled&&g.internal_DOMNodeMap.set(e,h.dom),c(v,S)}else e.state=e._pendingState,e._pendingState=null;o(t)||t.call(e)}}Object.defineProperty(n,'__esModule',{value:!0});var g=t(0),y='$NO_OP',_='a runtime error occured! Use Inferno in development environment to find the error.',k=!!('undefined'!=typeof window&&window.document),b=Array.isArray;var v=new Map,x=Promise.resolve(),N=function(e,n){this.state=null,this._blockRender=!1,this._blockSetState=!0,this._pendingSetState=!1,this._pendingState=null,this._lastInput=null,this._vNode=null,this._unmounted=!1,this._lifecycle=null,this._childContext=null,this._isSVG=!1,this._updating=!0,this.props=e||g.EMPTY_OBJ,this.context=n||g.EMPTY_OBJ};N.prototype.forceUpdate=function(e){this._unmounted||!k||h(this,!0,e)},N.prototype.setState=function(e,n){this._unmounted||(this._blockSetState?(!1,s()):m(this,e,n))},N.prototype.setStateSync=function(e){!1,this.setState(e)},N.prototype._updateComponent=function(e,n,t,d,i,l,a){if(!0===this._unmounted&&(!1,s()),t!==d||d===g.EMPTY_OBJ||e!==n||l){if(t!==d||d===g.EMPTY_OBJ){if(!o(this.componentWillReceiveProps)&&!a){var r=u(this.state);this._blockRender=!0,this.componentWillReceiveProps(d,i),this._blockRender=!1;var p=this.state;r!==p&&(this.state=r,this._pendingSetState=!0,this._pendingState=p)}this._pendingSetState&&(n=u(n,this._pendingState),this._pendingSetState=!1,this._pendingState=null)}if(l||o(this.shouldComponentUpdate)||this.shouldComponentUpdate&&this.shouldComponentUpdate(d,n,i)){o(this.componentWillUpdate)||(this._blockSetState=!0,this.componentWillUpdate(d,n,i),this._blockSetState=!1),this.props=d,this.state=n,this.context=i,g.options.beforeRender&&g.options.beforeRender(this);var c=this.render(d,n,i);return g.options.afterRender&&g.options.afterRender(this),c}this.props=d,this.state=n,this.context=i}return y},N.prototype.render=function(){},n['default']=N}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMWEyNGNlMWQ3YjBkMzQyZGY4ODAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2luZmVybm8vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21haW4uanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2luZmVybm8vZGlzdC9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvRnV6enlHYW1lT2ZMaWZlLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9pbmZlcm5vLWNvbXBvbmVudC9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaW5mZXJuby1jb21wb25lbnQvZGlzdC9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiWUFDQSxjQU1BLElBQ0EsaUJBR0EsbUJBQ0EsQ0FDQSxJQUNBLEtBSUEsMkNBR0EsYUFHQSxPQUNBLE9BSUEsSUF6QkEsZUE0QkEsTUFHQSx1QkFDQSxHQUNBLGtDQUNBLENBQ0EsZ0JBQ0EsY0FHQSxPQUdBLGlCQUNBLFlBQ0EscUJBQTJCLFVBQTBCLFVBQ3JELFlBQWlDLENBQWUsUUFDaEQsRUFFQSxhQURBLFFBSUEsbUJBQXNELHdDQUErRCxTQUdySCxNQUdBLCtCQzdEQSx1QkFDQSxtSUNDQSxxQkFFQSxJQUFRLFlBQ0wsY0FESCxPQUMyQixXQUFlLFVBQWEsQ0FBRSxNQUFPLFFBQVMsT0FBUSxXQUMvRSxTQUFTLHFCQUFxQixRQUVoQyxtQkNSQSxhQWNBLGFBQ0EsdUNBQ0EsUUFDQSxhQUNBLE9BQ0EsNEJBQ0EsWUFDQSxhQUNBLGNBQ0EsS0FDQSxhQUNBLDRCQUNBLEtBQ0EsYUFDQSxPQUNBLHFCQUNBLGFBQ0EsT0FDQSxtQkFDQSxhQUNBLE9BQ0EsbUJBQ0EsYUFDQSxPQUNBLFVBQ0EsYUFDQSxPQUNBLE9BQ0EsYUFDQSxZQUNBLE9BQ0EsYUFDQSxPQUNBLG1CQUNBLGFBRUEsV0FFQSxnQkFDQSxvQkFJQSxDQUNBLGVBQ0EsSUFDQSxNQUNBLFlBQ0EsYUFHQSxLQUNBLFlBQ0EsYUFHQSxLQUNBLFNBQ0EsWUFDQSxNQUNBLGFBa0lBLG1CQUNBLFVBQ0EsT0FFQSxXQUE4Qix3QkFDOUIsaUJBQ0EsVUFFQSxVQUNBLFFBQ0EsZUFHQSxhQUVBLG1CQUNBLFNBQ0EsUUFFQSxXQUNBLGlEQUNBLGFBR0EsVUFDQSxFQUNBLHVCQUNBLFdBQ0EsU0FDQSxDQUVBLE9BREEsV0FHQSxNQUNBLFFBQ0EsZ0JBR0EsUUFFQSxPQUNBLGNBR0EsY0FJQSwwQkFDQSxTQUVBLE1BQ0EsRUFDQSxhQUNBLG9CQUNBLGNBQ0EsWUFDQSxNQUNBLHFCQUNBLDJCQUNBLGVBQ0Esa0JBQ0EsZUFDQSxZQUNBLEdBRUEsd0JBQ0EsS0FFQSxhQUNBLHlDQUNBLENBQ0EsOEJBQ0EsVUFDQSxHQUVBLEdBQ0EsU0FFQSxDQUNBLHdCQUNBLG1CQUNBLENBQ0EsRUFFQSxpQ0FEQSxTQUVBLENBQ0EsWUFBb0IsRUFDcEIsYUFVQSxHQUNBLFNBSUEsQ0FDQSxhQUNBLHVCQUNBLFlBQ0EsYUFDQSxZQUNBLFVBQ0EsY0FDQSxRQUNBLG1CQUNBLFNBQ0EsVUFDQSxnQkFHQSxRQUVBLElBQ0EsUUFDQSxXQUlBLHNCQUNBLFVBRUEsZ0JBRUEsT0FFQSxPQUNBLGFBQ0Esa0JBQ0EsY0FDQSxXQUNBLGdCQUdBLFFBRUEsS0FDQSxhQUNBLEdBQ0EsNkJBQ0EsVUFDQSxjQUNBLGlCQUNBLFNBQ0EsVUFDQSxnQkFHQSxRQUVBLElBQ0EsUUFDQSxXQUlBLHNCQUNBLFVBRUEsVUFDQSxPQUNBLHFCQUNBLENBRUEsYUFFQSxnQkFDQSxTQUNBLG9CQUdBLGVBQ0Esb0JBRUEsY0FDQSxhQUNBLHNCQUlBLGNBQ0EsZUFDQSxTQUNBLFNBQ0EsVUFDQSxZQUNBLGFBQ0EsZ0JBQ0EsY0FDQSxxQkFFQSxtQkFDQSxhQUVBLFlBQ0EsMkJBRUEsSUFFQSxZQUVBLFVBQ0EsU0FJQSxpQkFDQSxhQUNBLGlCQUVBLFVBQ0EsU0FHQSxVQUlBLENBQ0EsZUFDQSxTQUNBLHVCQUNBLFNBQ0EsWUFDQSxzQkFBa0QsT0FBUyxJQUMzRCxNQUdBLFlBQ0EsUUFFQSxNQUVBLEtBRUEsUUFDQSxlQUNBLFNBQ0EsY0FFQSxjQUNBLGNBQ0EsMEJBQ0EsWUFFQSx5QkFDQSwwQkFFQSxjQUNBLGFBQ0EsWUFDQSxVQUNBLGNBQ0EsUUFDQSxvQkFDQSxTQUNBLFdBQ0EsZ0JBR0EsUUFFQSxJQUNBLFFBQ0EsWUFJQSx1QkFDQSxVQUVBLGdCQUVBLE9BRUEsWUFDQSxxQkFDQSxDQUVBLGlCQUVBLGNBQ0Esc0JBR0EsYUFDQSxtQkFDQSxnQkFDQSx3QkFFQSxrQkFDQSxrQkFDQSxTQUNBLFlBQ0EsV0FFQSxjQUNBLHNCQUFrRCxPQUFTLElBQzNELE1BR0EsWUFDQSxRQUVBLE1BQ0EsQ0FJQSxDQUNBLGFBQ0Esa0JBQ0EsY0FDQSxXQUNBLGdCQUdBLFFBRUEsS0FDQSxhQUNBLFlBQ0EsVUFDQSxjQUNBLG1CQUNBLFNBQ0EsVUFDQSxnQkFHQSxRQUVBLElBQ0EsUUFDQSxXQUlBLHNCQUNBLFVBRUEsZ0JBRUEsYUFFQSxRQUNBLHFCQUNBLENBRUEsZUFFQSxjQUNBLG9CQUNBLGFBQ0EsYUFDQSxzQkFJQSxjQUNBLGlCQUNBLFNBQ0EsVUFDQSxVQUNBLEtBaUJBLFVBQ0EsaUJBR0EsbUJBcEJBLFNBQ0EsYUFDQSxLQU1BLHdCQUNBLFdBRUEsSUFSQSxVQUNBLGlCQUdBLFFBUUEsQ0FjQSxDQUNBLHVCQUNBLENBQ0EsT0FFQSxhQUNBLFFBRUEsYUFDQSxRQUVBLGFBQ0EsYUFDQSxvQkFDQSxXQUNBLGNBQ0EsTUFJQSxDQUNBLGFBQ0EsYUFFQSxtQkFDQSxvQkFlQSxpQ0FkQSwrQkFDQSxNQUNBLHNCQUNBLFdBQ0EsS0FDQSxTQUNBLGtCQUNBLHNCQUNBLFVBR0EsRUFJQSx1QkFDQSxTQUNBLFNBQ0EsUUFDQSxlQUNBLFNBQ0Esb0JBQ0Esb0JBQ0EsYUFDQSxtQkFDQSx5QkFDQSxJQUNBLGNBQ0EsZ0JBQ0EsdUJBRUEsUUFDQSxLQUNBLE9BQ0EsWUFDQSxlQUNBLG1CQUNBLElBQ0EsV0FDQSxDQUNBLFNBQ0EscUJBQ0EsU0FDQSxhQUNBLFVBQ0EsY0FDQSxVQUNBLFlBQ0EsMkRBSUEsWUFDQSxZQUdBLFNBRkEsV0FDQSxpQkFFQSxNQUNBLE1BQ0EsS0FHQSxvQ0FFQSxJQUhBLGVBSUEsSUFDQSxRQUVBLGtCQUlBLFlBRkEsa0JBS0EsZUFFQSxlQUNBLENBaUJBLE1BZkEsTUFRQSxvQ0FJQSwwQkFUQSxhQUlBLGVBT0EsWUFFQSxxQkFDQSxDQUNBLGFBQ0EsY0FDQSxXQUNBLGVBS0EsNkNBR0EsT0FFQSxnQkFUQSxrQkFHQSxhQU9BLFdBR0EscUJBQ0EseUJBQThDLE9BQVMsSUFDdkQsU0FDQSxZQUNBLGNBQ0EsU0FDQSxZQUNBLGFBQ0EsR0FFQSxLQU9BLG9CQUNBLE1BUUEsZUFQQSxpQkFHQSxxQkFLQSxTQUNBLGNBQ0EsZUFDQSxHQUNBLEVBQ0EsZUFDQSxtQkFDQSxZQUNBLE1BR0EsU0FGQSxXQUNBLGlCQUVBLFNBQ0EsU0FLQSxTQUpBLGtCQUVBLGVBQ0EsUUFFQSxlQUNBLENBRUEsU0FEQSxRQUVBLHFCQUNBLFNBQ0EsTUFDQSxpQkFFQSxTQUNBLE9BRUEsYUFDQSxJQUVBLE9BQ0EsT0FNQSxXQUVBLEtBQ0EsaUJBQ0EsVUFDQSxTQUNBLG9CQUNBLEtBQ0EsbUJBRUEsZUFDQSxlQUVBLGVBQ0EsUUFDQSxDQUNBLENBQ0EsUUFLQSxDQUVBLG1CQUNBLFNBQ0EsVUFDQSxnQkFDQSxTQUNBLGtDQUNBLGdCQUNBLFNBQ0EsVUFDQSxtQkFDQSxpQkFFQSxHQUNBLENBQ0EsT0FDQSxNQUNBLGFBQ0EsU0FDQSxTQUNBLFNBQ0EsVUFDQSxTQUNBLFVBQ0EsS0FFQSxnQkFFQSxVQUNBLGdCQUVBLFlBQ0EsZUFDQSxPQUNBLE9BQ0EsYUFFQSxZQUNBLE9BQ0EsRUFDQSxtQkFDQSxTQUNBLFVBQ0EsZ0JBQ0EsU0FDQSxrQ0FDQSxnQkFDQSxTQUNBLGVBQ0EsU0FDQSwwQkFDQSxlQUNBLFlBRUEsR0FDQSxDQUNBLENBQ0EsT0FDQSxNQUNBLGFBQ0EsU0FDQSxNQUNBLE1BQ0Esd0JBQ0EsMEJBQ0EsdUJBQ0EseUJBQ0Esc0JBR0EsZUFDQSxTQUNBLFNBQ0EsVUFDQSxTQUNBLFVBQ0EsS0FFQSxnQkFFQSxVQUNBLGdCQUVBLFlBQ0EsZUFDQSxPQUNBLE9BQ0EsYUFFQSxZQUNBLE9BQ0EsRUFJQSxDQUNBLHFCQUNBLFNBQ0EsTUFDQSxLQUVBLGNBQ0EsT0FFQSxjQUNBLFFBRUEsT0FDQSxlQUNBLENBQ0EsYUFFQSxLQUNBLHNCQUNBLFNBQ0EsYUFDQSxRQUNBLFFBQ0EsY0FDQSxRQUdBLGFBQ0EsbUJBQ0EsbUJBRUEsc0JBQ0EseUJBRUEsMEJBQ0EsTUFFQSxRQUNBLGlCQUNBLHVCQUVBLGdDQUlBLG9CQUNBLFdBQ0EsMkJBR0EsZ0NBSUEsa0JBRUEsV0FDQSxrQkFDQSxLQUNBLE9BRUEsS0FDQSxzQkFDQSxTQUNBLFFBQ0EsUUFDQSxTQUNBLElBRUEsY0FDQSxZQUNBLE1BRUEsV0FDQSxZQUVBLHFCQUNBLGtCQUVBLGFBSUEsTUFDQSxNQUVBLDhCQUNBLE9BRUEsS0FDQSxrQkFDQSxJQUNBLHdCQUE4QyxPQUFTLElBQ3ZELE1BQ0EsWUFDQSxVQUlBLGlCQUNBLFdBRUEsYUFDQSxjQUNBLElBQ0EsT0FFQSxVQUNBLElBQ0EsS0FLQSxVQUNBLEdBQ0EsQ0FRQSxDQU9BLGNBQ0EsSUFJQSx3QkFFQSwyQkFDQSxlQUNBLFVBQ0EsY0FDQSxvQkFBdUMsT0FBUyxJQUNoRCxTQUNBLFFBQ0EsUUFHQSxlQUNBLE1BQ0Esa0JBQ0EsT0FDQSxDQUNBLE1BQ0EsUUFFQSxhQUVBLFVBREEsVUFFQSxjQUNBLGtCQUF1QyxPQUFTLElBQ2hELE9BQ0EsVUFJQSx3QkFIQSxFQVFBLENBUUEsZ0JBQ0EsSUFJQSxZQUVBLEtBR0EsY0FDQSxjQUNBLE9BQ0EsTUFDQSxTQUNBLFFBRUEsUUFDQSxVQUVBLGtCQUNBLFlBRUEsVUFDQSxLQUNBLFNBQ0EsWUFDQSxhQUNBLFVBQ0EsaUJBR0EsVUFDQSxRQUVBLFlBRUEseUJBQ0EsVUFDQSxTQUNBLE1BQ0EsU0FDQSxZQUNBLG9CQUVBLFFBQ0EsR0FDQSxjQUNBLHFCQUVBLEtBRUEsS0FDQSxPQUNBLENBSUEsQ0FDQSwwQkFDQSxVQUNBLFNBQ0EsVUFDQSxjQUNBLE9BQ0EsUUFDQSxLQUdBLDhCQUVBLG9CQUNBLEtBQ0EsUUFDQSxPQUdBLDRCQUdBLG1CQUNBLElBQ0EsSUFHQSxrQkFHQSxhQUNBLE9BQ0EsT0FHQSxrQkFLQSxhQUVBLGlCQUNBLEVBQ0Esb0JBQ0EsQ0FDQSxNQUVBLGNBQ0EsTUFHQSwwQkFFQSxHQUNBLDBCQUNBLFNBQ0EsU0FDQSxRQUNBLE1BRUEsc0JBQ0EsU0FDQSxRQUNBLFVBQ0EsVUFDQSxhQUNBLGFBQ0EsVUFDQSxVQUNBLFFBQ0EsY0FDQSxlQUNBLFdBQ0EsZ0JBQ0EsZUFDQSx5QkFDQSxxQkFFQSxVQUNBLE9BQ0EsUUFDQSxNQUNBLGVBQ0EsT0FFQSw4QkFFQSxRQUVBLE9BQ0EsT0FDQSxLQUNBLGVBR0EsSUFFQSxjQUNBLElBQ0EsY0FFQSxVQUNBLFVBQ0EsWUFJQSxTQUVBLENBQ0EsUUFDQSx1QkFJQSwwQkFHQSxhQUtBLG1CQUNBLGFBR0EsU0FDQSxFQUNBLDhCQUNBLElBQ0EsTUFDQSxLQUNBLEtBRUEsS0FDQSxVQUNBLFVBQ0EsS0FFQSxNQUNBLEtBRUEsWUFDQSxLQUNBLEtBR0EsUUFDQSxNQUdBLGNBSUEsY0FDQSxLQUNBLEtBR0EsU0FDQSxZQUdBLFNBQ0EsTUFDQSxPQUNBLEtBQ0EsVUFJQSxRQUNBLFlBR0EsZUFDQSxPQUNBLFlBRUEsZUFDQSxRQUNBLE1BR0EsbUJBQ0EsWUFLQSxzQkFHQSxrQkFHQSxtQkFDQSw0QkFDQSxTQUNBLFNBQ0EsU0FDQSxRQUNBLGNBQ0EsTUFJQSxNQUhBLDhCQUlBLGVBQ0EsU0FDQSxjQUNBLDBCQUNBLElBQ0EsS0FFQSwrQ0FDQSxJQUNBLEtBQ0EsSUFRQSxVQVBBLHdCQUVBLFFBQ0EsTUFFQSxZQUNBLFVBRUEsdUJBRUEscUJBQ0EsYUFDQSxXQUlBLE9BRUEsZUFDQSxlQUNBLGtDQUNBLE9BQ0EsZ0JBQ0EsT0FFQSxLQUNBLFFBQ0EsSUFFQSxNQUNBLFlBRUEsTUFJQSxVQUVBLEtBQ0EsV0FDQSxTQUdBLE9BQ0EsYUFFQSxjQUNBLGVBRUEsaUJBQ0EsZUFFQSxhQUNBLHVCQUNBLHNCQUVBLDhCQUNBLGlCQUVBLGtCQUNBLCtCQUdBLGNBQ0EsR0FDQSxHQUNBLFlBQ0EsS0FDQSxJQUNBLFVBQ0EsVUFDQSxPQUNBLFNBQ0EsU0FDQSxZQUNBLE1BQ0EsV0FDQSxNQUlBLFFBQ0EsK0JBR0EsOEJBTEEsS0FNQSxTQUNBLFFBQ0EsMEJBRUEsNkJBQ0EsT0FDQSxPQUVBLFdBQ0EsY0FFQSxNQUlBLFVBRUEsS0FDQSxXQUNBLFNBR0EsT0FDQSxTQUNBLG9CQUNBLFdBQ0EsUUFDQSx5QkFFQSxrQ0FHQSxNQUNBLGFBRUEsY0FDQSxlQUVBLGNBRUEsQ0FDQSxTQUNBLGdCQUNBLFNBQ0EsYUFDQSxNQUNBLFFBQ0EsaUJBRUEsYUFDQSxnQkFDQSxTQUNBLElBQ0EsMEJBQ0EsQ0FNVSxZQUxWLFdBQ0EsU0FHQSxVQUNBLEVBQTRCLFFBQzVCLE9BQ0EsT0FDQSxhQUVBLFVBQ0EsaUJBQ0EsSUFDQSxRQUE4QixJQUF3QixRQUN0RCxPQUNBLE9BQ0EsYUFFQSxpQkFDQSxZQUVBLFNBQ0EsTUFFQSxvQkFDQSxRQUE4QixJQUF3QixJQUN0RCxNQUdBLGVBQ0EsMEJBQ0EsSUFPQSxHQUNBLEVBQ0EsRUFDQSxFQUNBLEVBQ0EsRUFDQSxNQVpBLFdBQ0EsV0FDQSxNQUNBLElBQ0EsSUFDQSxLQVFBLE1BS0EsWUFKQSxLQUVBLGtCQUdBLE1BR0EsV0FGQSxtQkFHQSxPQUNBLE9BQ0EsT0FDQSxPQUNBLGFBRUEsU0FDQSxhQUlBLG9CQUVBLHFCQUNBLElBQ0Esa0JBQ0EsSUFDQSxTQUNBLFNBRUEsU0FDQSxPQUNBLE9BQ0EsYUFFQSxNQUVBLHFCQUNBLElBQ0Esa0JBQ0EsSUFDQSxTQUNBLFNBRUEsU0FDQSxPQUNBLE9BQ0EsYUFFQSxNQUVBLGtCQUNBLENBQ0EsK0JBQ0EsS0FDQSxJQUNBLE1BQ0EsT0FDQSxPQUNBLGFBRUEsT0FDQSxRQUVBLGtCQUNBLENBQ0Esc0JBQ0Esd0JBQ0EsWUFDQSxPQUNBLElBQ0EsTUFDQSxPQUNBLE9BQ0EsYUFFQSxPQUNBLFFBQ0EsQ0FDQSxLQUNBLElBQ0EsUUFDQSxhQUNBLHdCQUNBLEtBQ0EsUUFDQSxPQUNBLGFBRUEsT0FDQSxjQUlBLHdCQUNBLFNBQ0EsVUFHQSxtQkFDQSxPQUNBLFFBQ0EsUUFFQSxlQUFtQixFQUFhLElBQ2hDLFVBRUEsS0FDQSxRQUNBLElBRUEsV0FDQSxhQUE0QixJQUFXLEtBQ3ZDLFNBQ0EsS0FDQSxRQUFvQyxJQUFXLEtBQy9DLFNBQ0EsbUJBQ0EsR0FDQSxPQUNBLElBR0EsS0FFQSxNQUNBLGFBRUEsT0FDQSxrQkFDQSxTQUNBLEtBQ0EsS0FLQSxNQUNBLFVBRUEsU0FBNEIsSUFBVyxLQUN2QyxlQUdBLFdBQTRCLElBQVcsS0FDdkMsTUFDQSxLQUNBLGdCQUNBLE1BQ0EsU0FDQSxPQUNBLE9BQ0EsSUFHQSxLQUVBLE1BQ0EsYUFFQSxPQUNBLGtCQUNBLFNBSUEsTUFFQSxrQkFDQSxTQUNBLFlBQ0EsT0FDQSxPQUNBLGFBRUEsT0FDQSwwQkFHQSxVQUNBLE9BQ0EsSUFDQSxTQUNBLEtBQ0EsT0FDQSxjQUdBLFVBQ0EsT0FDQSxxQkFDQSxNQUFxQyxFQUFRLEtBQzdDLEtBQ0EsWUFDQSxNQUNBLE9BQ0EsYUFFQSxXQUNBLHdCQUNBLGVBR0EseUJBQ0EsUUFDQSxNQUNBLFNBQ0Esd0JBQ0EsWUFHQSxRQUlBLEdBQ0EsU0FHQSxjQUFxQyxFQUFRLEtBQzdDLEtBQ0EsYUFDQSxNQUNBLE9BQ0EsYUFFQSxXQUNBLHdCQUNBLGVBSUEsZUFDQSxDQUNBLENBQ0EsQ0FDQSxjQUNBLElBR0EsR0FDQSxFQUNBLEVBQ0EsRUFDQSxZQU5BLEdBQ0EsVUFNQSxhQUFlLEVBQVMsUUFDeEIsT0FDQSxTQUdBLHVCQUNBLFVBQ0EsQ0FDQSxTQUNBLFFBQ0EsUUFDQSxPQUNBLGFBQ0EsRUFDQSxPQUNBLFlBQ0EsWUFHQSxFQUdBLFFBQ0EsUUFDQSxlQUVBLElBRUEsUUFDQSxTQUNBLGFBQ0EsR0FDQSxPQUNBLFNBRUEsS0FDQSxTQUNBLGNBQ0EsbUJBQ0EsV0FDQSx3QkFDQSxVQUNBLGtCQUNBLFlBRUEsYUFDQSwyQkFDQSxzQkFFQSxxQkFDQSxZQUNBLEtBQ0EsV0FFQSxPQUNBLFNBQ0EsTUFFQSxvQkFDQSxPQUVBLDJCQUNBLFlBRUEsZ0RBQ0EsWUFDQSxjQUNBLE9BQ0EsT0FDQSxTQUdBLFlBR0EsWUFFQSwyQkFHQSxjQUdBLGlCQUNBLEVBQ0Esb0JBQ0EsSUFDQSxZQUNBLE9BRUEsZUFDQSxTQUNBLGdCQUVBLGFBQ0EsUUFFQSx1QkFDQSxTQUNBLFNBQ0EscUJBQ0EsS0FDQSxPQU1BLE1BRUEsSUFFQSxLQUVBLE9BRUEsQ0FFQSxDQUNBLGtCQUNBLElBRUEsR0FDQSxNQUZBLFNBR0EsS0FHQSxjQUZBLDJCQUdBLENBRUEsYUFDQSxTQUNBLE9BQ0EsZUFFQSxXQUdBLE1BQ0EsYUFDQSxhQUdBLEdBRUEsS0FDQSxjQUNBLEtBQ0EsMEJBR0EsS0FDQSxvQkFDQSxDQUdBLGdDQUVBLEdBQ0EsOEJBRUEsU0FDQSxZQUdBLFVBRUEsa0JBSUEsQ0FDQSxzQkFDQSxTQUNBLFNBQ0EsYUFFQSxxQkFDQSxtQkFFQSxTQUNBLE9BRUEsUUFDQSxJQVdBLGdCQUVBLEtBQ0EsZ0JBQ0EsaUNBQ0EsVUFLQSxTQUpBLE1BQ0EsTUFFQSxVQUVBLGdCQUNBLCtCQUNBLElBS0EsU0FKQSxNQUNBLE1BRUEsVUFFQSxzQkFDQSxJQUNBLFNBQ0EscUJBQ0EsWUFDQSxNQU1BLE1BTEEsT0FFQSxrQkFJQSxXQUNBLGlCQUNBLGdCQUNBLGFBQ0EsVUFDQSxjQUNBLFNBQ0EsT0FDQSxRQUNBLEtBRUEsWUFDQSxlQUNBLHlCQUNBLE1BRUEsY0FDQSxPQUVBLGFBRUEsVUFDQSxJQUNBLFFBRUEsa0JBSUEsWUFGQSxrQkFLQSxlQUVBLGVBQ0EsQ0FlQSxNQWJBLDZCQUdBLGFBR0EsYUFDQSxNQUVBLFVBQ0EsTUFFQSxVQUVBLHNCQUNBLG1CQUEwQyxPQUFTLElBQ25ELE1BRUEsS0FDQSxTQUNBLGFBRUEsVUFHQSxlQUNBLHdCQUNBLElBQ0EsU0FDQSxxQkFDQSxZQUNBLE1BTUEsTUFMQSxPQUVBLGtCQUlBLFNBQ0EsY0FDQSxTQUNBLE9BQ0Esb0JBQ0EsYUFDQSwrQkFDQSxpQkFDQSxNQUVBLFFBQ0EsY0FDQSxnQkFDQSx1QkFFQSxRQUNBLEtBQ0EsT0FDQSx5QkFDQSxjQUNBLFdBQ0EsWUFDQSxNQUVBLE9BQ0EsQ0FDQSxTQUNBLG9CQUVBLEtBQ0EsS0FjQSxTQUdBLGlCQUNBLHdCQUNBLGdCQUNBLCtCQUNBLEdBRUEsZ0JBR0EsVUFFQSxzQkFDQSxZQUVBLEdBQ0Esb0JBRUEsVUFDQSx5QkFFQSw2QkFDQSw4Q0FBZ0QsVUFBNEMsd0JBRzVGLElBQ0Esa0JBQ0EsSUFDQSw2QkFBNEMsT0FBbUIsS0FFL0QsT0FDQSxJQUNBLEtBS0EsVUFDQSxHQUNBLENBT0EsQ0FJQSx3QkFDQSxDQUNBLE9BRUEsWUFDQSxhQUNBLGFBQ0Esb0JBQ0EsWUFDQSxlQUdBLFdBQ0EsZUFDQSxnQkFDQSxzQkFDQSxhQUNBLHdCQUNBLGtCQUNBLHVCQUVBLG9CQUNBLE9BQ0EsdUJBRUEscUJBSUEsY0FIQSxPQUtBLFlBQ0Esa0JBRUEsbUNBQ0EsU0E4QkEsWUE3QkEsaUJBRUEsZUFJQSxVQUVBLEtBQ0EsT0FFQSxLQUNBLFlBR0EsU0FDQSxRQUVBLE9BS0EsZUFHQSxrQkFDQSxzQkFDQSxlQUVBLDBCQUNBLFdBQ0EsbUJBQ0Esc0JBQ0EsS0FDQSxzQkFDQSxLQUNBLG9CQUNBLE9BQ0EsT0F5QkEsTUFyQkEsV0FFQSxLQUNBLE9BRUEsS0FDQSxZQUdBLFNBQ0EsUUFFQSxPQUtBLGVBR0Esa0JBRUEsZ0JBQ0EsQ0FDQSw2Q0FLQSxPQUZBLGNBR0EsZ0JBQ0EsY0FDQSxZQUNBLGdCQUNBLEdBQ0EsZUFDQSxrQkFDQSxDQUNBLEtBR0EsVUFFQSxrQkFDQSxnQkFDQSxPQUNBLGdCQUdBLCtCQUVBLGlCQUNBLDBCQUNBLEtBQ0Esd0JBQ0EsY0FDQSxlQUNBLEtBQ0Esa0JBRUEsU0FFQSxjQUNBLGtCQUNBLGdCQUNBLEdBQ0EsZUFDQSxvQkFDQSwyQkFDQSx5QkFFQSwwQkFDQSxHQUNBLG9CQUNBLG1CQUEwQyxPQUFTLElBQ25ELE1BQ0EsS0FDQSxNQUdBLGNBQ0EsZ0JBQ0EsT0FDQSxrQkFDQSxhQUNBLE1BQ0EsaUJBQ0EsYUFDQSxJQUlBLENBQ0EsMEJBQ0EsTUFDQSxnQkFDQSxxQkFDQSxVQUNBLGFBQ0EsV0FDQSxhQUNBLFdBQ0EsTUFZQSxDQUNBLDRCQUNBLENBQ0EsU0FDQSxLQUNBLEVBRUEscUdBQ0EsVUFPQSxNQU5BLFFBRUEsTUFDQSwwQkFFQSxpQkFFQSxjQUNBLElBQ0EsT0FDQSxjQUNBLElBQ0EsT0FDQSxTQUNBLEtBR0EsaUJBRUEsS0FEQSxhQUlBLHVDQUNBLGdCQUNBLFVBR0EsU0FDQSxjQUNBLFNBQ0EsY0FDQSxXQUNBLE9BQW1DLEVBQVMsSUFDNUMsTUFDQSxLQUNBLE9BRUEsZUFDQSxjQUdBLFNBQ0EsVUFDQSxDQUNBLEtBQ0Esb0JBR0Esa0JBQ0EsSUFDQSxnQkFDQSxJQUVBLE9BREEsYUFFQSxTQUNBLFNBR0EsaUJBRUEsS0FEQSxhQUlBLCtDQUNBLEdBQ0EsS0FDQSx5QkFFQSxNQUNBLFFBY0EsQ0FDQSxnQkFDQSxpQ0FDQSwwQkFFQSxNQUNBLFNBQ0EsaUJBQ0EsTUFDQSxLQUVBLE1BQ0EsWUFFQSxLQUNBLFNBR0EsZ0JBQ0EsWUFDQSxRQUNBLGNBQWtELE9BQVMsSUFDM0QsY0FFQSxPQUNBLEdBQ0EsS0FDQSxTQUNBLFVBQ0EsY0FDQSxRQUVBLDRCQUNBLG1CQUVBLDRCQUNBLGFBRUEsc0JBQ0EsYUFHQSxXQUNBLHdCQUVBLGFBQ0EsNEJBQ0EsV0FDQSxTQUdBLFNBQ0EsY0FDQSxTQUNBLGNBQ0EsV0FDQSxPQUE2QyxFQUFhLElBQzFELE1BQ0EsS0FDQSxPQUVBLGVBQ0EsY0FHQSxTQUNBLFVBQ0EsQ0FDQSxLQUNBLG9CQUdBLE1BQ0EsWUFDQSxJQUNBLEtBQ0EsU0FDQSxVQUNBLFlBQ0EsV0FDQSw2QkFFQSxhQUVBLHFCQUNBLGFBRUEsWUFDQSxDQUNBLFNBQ0EsYUFDQSxnQkFDQSxNQUNBLGdCQUNBLHlCQUNBLFFBQ0EsY0FDQSxXQUNBLEtBSUEsQ0FDQSxnQkFDQSxDQUVBLFNBREEsUUFFQSxnQkFDQSxPQUNBLFVBRUEsaUJBQ0EsZUFHQSxVQUNBLGdCQUNBLENBRUEsaUJBREEsTUFFQSxvQkFDQSxhQUFnQyxPQUFhLFFBQzdDLE9BQ0EsU0FDQSxNQUNBLE9BQ0EsYUFHQSxNQUNBLFlBRUEsNEJBQ0Esb0JBRUEsbUJBQ0EsZUFHQSxRQUVBLFVBR0EsU0FDQSxFQUNBLGNBQ0EsSUFLQSxHQUNBLGFBR0EsUUFHQSx5QkFBdUMsT0FBUyxRQUNoRCxNQUNBLGlCQUNBLG9CQUNBLEtBRUEsZ0JBREEsS0FFQSxDQUVBLG9CQUVBLHVCQUVBLGdCQUNBLHdCQUVBLCtCQUVBLGtCQUdBLHdCQUVBLE9BQ0EsT0FDQSxNQUNBLGNBQ0EsSUFDQSxZQUVBLHFCQUNBLGFBR0EsUUFDQSxrQkFDQSxDQUNBLHNDQUNBLDJCQUVBLDJCQUNBLHdDQUNBLGNBR0EsNkJBQ0EsaUJBQ0EsYUFFQSxzQkFDQSxpQkFDQSxhQUVBLEtBQ0EsY0FDQSxJQUNBLGdCQUVBLFdBQ0EsWUFFQSxJQUNBLGFBRUEsS0FDQSxlQUVBLEtBQ0EsWUFFQSxJQUNBLEVBQ0EsY0FDQSxTQUNBLFVBR0EsdUJBRUEsU0FDQSxTQUNBLGlCQUNBLFFBQ0EsT0FHQSxvQkFDQSxVQUNBLGFBS0EsTUFDQSxlQUNBLFdBQ0Esd0JBQ0EsYUFHQSxVQUVBLEtBQ0EsZUFDQSw0QkFHQSxZQUNBLGtCQXNCQSxNQVVBLENBQ0EsZ0JBQ0EsT0FDQSxNQUFnQixRQUVoQixTQUNBLElBaUJBLENBeHdGQSxxQ0FBOEMsQ0FJOUMsV0FDQSxPQUNBLFlBRUEsOEhBR0EsMkJBOERBLG1DQUNBLGdCQUNBLFNBQ0EsOEJBQ0EsUUFHQSxVQUZBLGNBR0EsU0FFQSxHQUlBLEVBQ0EsT0FDQSxZQUNBLGlCQUNBLGlCQUNBLGtCQUNBLG1CQUNBLGlCQUNBLEtBQ0Esc0JBQ0Esb0JBTUEsYUFDQSxrQ0FDQSwwQ0FDQSx3Q0FDQSxpQkFDQSx5QkFDQSxVQXFCQSw0T0FDQSx3QkFDQSwyQkFDQSwyQkFDQSx3QkFDQSx3QkFDQSx5QkFDQSx3QkFDQSxzQkFDQSxzQkFDQSx1QkFDQSxVQW1DQSxzZUFDQSxtQkFDQSx1QkFDQSx1QkFDQSxjQUNBLGNBQ0Esa0JBQ0EsbUJBQ0EsVUFjQSx3SEFDQSxnQkFDQSw0Q0FDQSwyQkEwbkJBLHNCQTROQSxXQUtBLE1BMENBLHdCQU1BLEtBb2xDQSxhQWttQkEsUUFrQkEsYUFqQkEsQ0FDQSxhQUNBLFNBQ0EsY0FDQSxrQkFDQSxlQUNBLGVBQ0EsMkJBQ0EsdUJBQ0EsNkJBQ0Esc0JBQ0Esa0JBQ0EsYUFDQSxXQUNBLFVBQ0EsWUFHQSxlQUNBLFdBQ0EsZ0JBQ0Esb0JBQ0EsaUJBQ0EsaUJBQ0EsNkJBQ0EseUJBQ0EsK0JBQ0Esd0JBQ0Esb0JBQ0EsZUFDQSxhQUNBLFlBQ0EsMEVDNXlGQSx1QkFFTSxlQUF3QixHQUE5QixDQUNFLENBQVksY0FDVixDQUVBLGNBQ0EsVUFBSyxHQUFJLEdBQUksRUFBRyxFQUFJLEVBQU0sT0FBVSxJQUNsQyxNQUNBLFVBQUssR0FBSSxHQUFJLEVBQUcsRUFBSSxFQUFNLE1BQ3hCLE1BQUksS0FBSyxLQUVYLFlBQ0QsT0FFRCxNQUFLLE1BQVEsQ0FDZCxRQUVELG9CQUNFLFFBQU8sc0JBQXNCLElBQU0sS0FDcEMsT0FFRCxPQUNFLE1BQU0sQ0FBRSxRQUFPLFVBQVcsS0FDMUIsTUFBTSxDQUFFLFNBQVUsS0FDbEIsTUFFQSxTQUFLLEdBQUksR0FBSSxFQUFHLEVBQUksS0FBSyxNQUFNLE9BQVUsSUFDdkMsTUFDQSxVQUFLLEdBQUksR0FBSSxFQUFHLEVBQUksS0FBSyxNQUFNLE1BQVMsSUFDdEMsTUFBTSxHQUNOLFdBQUksR0FFSixPQUFNLEdBQVksRUFBTSxDQUFHLElBQVUsTUFBUSxDQUFHLElBQVMsTUFDdkMsRUFBTSxDQUFHLElBQWtCLFNBQzNCLEVBQU0sQ0FBRyxJQUFVLE1BQVEsQ0FBQyxFQUFLLE1BQzNCLEtBQXFCLENBQUcsSUFBUyxNQUNqQyxLQUFxQixDQUFDLEVBQUssTUFDakMsRUFBTSxDQUFDLEVBQUssTUFBZSxDQUFHLElBQVMsTUFDdkMsRUFBTSxDQUFDLEVBQW9CLFNBQzNCLEVBQU0sQ0FBQyxFQUFLLE1BQWUsQ0FBQyxFQUU5QyxNQUFpQixDQUFiLElBQWdCLEVBQ2YsRUFBUSxLQUEwQixDQUFiLElBQWdCLEVBQVcsQ0FBQyxFQUNqRCxLQUFRLEtBQTBCLENBQWIsSUFBZ0IsRUFBVyxFQUFjLENBQUMsRUFBWSxJQUMzRSxLQUFRLEtBQTBCLENBQWIsSUFBZ0IsRUFDckMsSUFBUSxNQUFXLEVBRXhCLEtBQ0QsT0FDRCxHQUNELE9BRUQsTUFBSyxTQUFTLENBQ2QsaUJBQU8sc0JBQXNCLElBQU0sS0FDcEMsT0FFRCxTQUNFLE1BQU0sQ0FBRSxRQUFPLFNBQVEsU0FBVSxLQUNqQyxNQUFNLENBQUUsU0FBVSxLQUVsQiw4QkFFTSxLQUFLLE1BQU0sTUFBTSxJQUFVLE9BQU0sRUFBSSxJQUFXLDRCQUFQLENBQXVCLElBQVEsVUFBWSxTQUFhLE9BQWdDLGNBQXBCLENBQXBFLFFBRi9DLFNBQ2dDLE9BQWQsQ0FBMEIsS0FENUMsR0FLRCxTQUdILEVBQ0EsdUJDdkVBLHVCQUNBLDZDQ0RBLGFBZ0JBLGFBQ0EsT0FDQSw0QkFDQSxZQUNBLGFBQ0EsY0FDQSxLQUNBLGFBQ0EsNEJBQ0EsS0FDQSxhQUNBLE9BQ0EscUJBQ0EsYUFDQSxPQUNBLFVBQ0EsYUFDQSxPQUNBLE9BQ0EsYUFDQSxZQUNBLE9BQ0EsYUFFQSxXQUVBLGVBQ0EscUJBQ0EsZUFDQSxJQUNBLE1BQ0EsWUFDQSxhQUdBLEtBQ0EsWUFDQSxhQUdBLEtBQ0EsUUFVQSxDQUlBLGVBQ0EsZUFDQSxTQUVBLGtCQUNBLE1BRUEsT0FDQSxDQUNBLENBQ0EsaUJBQ0EsU0FDQSxXQUNBLFNBQ0EsT0FDQSwwQkFDQSxHQUNBLFlBQ0EsNkJBQ0EsaUJBQW1ELE9BQVMsSUFDNUQsU0FFQSxPQUNBLEtBQ0EsWUFFQSxJQUNBLFFBRUEsUUFDQSxpQkFDQSxDQUNBLDZCQUVBLGtCQUNBLGlCQUNBLHFCQUdBLGdCQUNBLGFBR0EsbUNBQ0EsZUFDQSxVQVNBLGFBUkEsc0JBQ0EsYUFDQSxZQUdBLGtCQUlBLFNBQ0EsU0FDQSxXQUdBLG9CQUNBLGFBR0EscUJBQ0EsY0FDQSx5Q0FFQSxRQUNBLEVBQ0EsaUJBQ0EsT0FHQSxrQ0FDQSxHQUNBLDRCQUNBLGtCQUNBLFFBQ0EsV0FDQSxVQUNBLHdCQUNBLGFBQ0EsaUNBQ0EsS0FDQSwwQkFFQSxNQUNBLFdBQ0EsV0FFQSxNQUNBLDRCQUVBLFFBSUEsVUFFQSxhQUNBLGVBQ0Esc0JBQ0EscUJBQ0EsVUFDQSxlQUNBLElBQ0EsT0FDQSx1QkFFQSxxQkFDQSxPQUdBLGNBRUEsZUFDQSx3Q0FDQSxhQUNBLGNBQ0EsdUJBRUEsc0NBQ0Esd0JBRUEsY0FDQSxlQUNBLGNBQ0Esa0RBRUEsS0FDQSxNQUVBLGdCQUNBLDhCQUVBLEtBQ0EsUUFFQSxRQUVBLENBbE5BLHFDQUE4QyxDQUFjLFdBRTVELFFBS0EsS0FDQSxXQUVBLDZIQUdBLDBCQXFEQSxTQUVBLHdDQStJQSxZQUNBLFVBQ0EscUJBQ0EsdUJBQ0EsdUNBQ0EscUJBQ0EsaUJBQ0EsVUFDQSw4QkFDQSx3QkFDQSxVQUNBLGVBRUEsNkJBRUEsNEJBQ0EsV0FDQSxtQ0FDQSxrQkFHQSxNQUNBLFlBQ0Esa0NBQ0EsTUFHQSxrQkFDQSxtQkFRQSxPQUZBLFlBR0Esb0NBUUEsU0FDQSxhQUNBLG9EQUNBLGNBSUEsZ0JBRUEsS0FDQSxhQUNBLFdBQ0EsU0FDQSwyQkFDQSwyQ0FFQSxjQUNBLFlBQ0EscUJBQ0Esb0NBQ0EsMkJBQ0EsTUFFQSxhQUVBLGFBQ0EseUJBRUEsZ0JBQ0EsTUFDQSw4QkFDQSxvQkFDQSx1Q0FFQSxLQUVBLElBQ0EsVUFDQSw2QkFDQSx5REFDQSxRQUNBLDRCQUNBLHVCQUNBLGdDQUVBLHdCQUNBLGFBQ0EsYUFDQSxvQkFDQSxxQ0FFQSxpQkFDQSxjQUlBLGlCQUhBLG1DQUVBLE9BR0EsTUFDQSxhQUNBLGFBRUEsU0FDQSxDQUNBLFFBQ0EsRUFDQSw2QkFBa0YsR0FFbEYiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgMWEyNGNlMWQ3YjBkMzQyZGY4ODAiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vZGlzdCcpLmRlZmF1bHQ7XG5tb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG5cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbm9kZV9tb2R1bGVzL2luZmVybm8vaW5kZXguanNcbi8vIG1vZHVsZSBpZCA9IDBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiaW1wb3J0IEluZmVybm8gZnJvbSAnaW5mZXJubydcblxuaW1wb3J0IEZ1enp5R2FtZU9mTGlmZSBmcm9tICcuL0Z1enp5R2FtZU9mTGlmZS5qcydcblxuSW5mZXJuby5yZW5kZXIoXG4gIDxGdXp6eUdhbWVPZkxpZmUgd2lkdGg9eyAxMDAgfSBoZWlnaHQ9eyAxMDAgfSBzdHlsZT17eyB3aWR0aDogJzgwMHB4JywgaGVpZ2h0OiAnODAwcHgnfX0gLz4sXG4gIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdtYWluJylbMF1cbilcbi8vIHZpbTogc2V0IHRzPTIgc3c9MiBldDpcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9tYWluLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuXG4vKipcclxuICogQG1vZHVsZSBJbmZlcm5vLVNoYXJlZFxyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG52YXIgTk9fT1AgPSBcIiROT19PUFwiO1xyXG52YXIgRVJST1JfTVNHID0gXCJhIHJ1bnRpbWUgZXJyb3Igb2NjdXJlZCEgVXNlIEluZmVybm8gaW4gZGV2ZWxvcG1lbnQgZW52aXJvbm1lbnQgdG8gZmluZCB0aGUgZXJyb3IuXCI7XHJcbi8vIFRoaXMgc2hvdWxkIGJlIGJvb2xlYW4gYW5kIG5vdCByZWZlcmVuY2UgdG8gd2luZG93LmRvY3VtZW50XHJcbnZhciBpc0Jyb3dzZXIgPSAhISh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvdy5kb2N1bWVudCk7XHJcbi8vIHRoaXMgaXMgTVVDSCBmYXN0ZXIgdGhhbiAuY29uc3RydWN0b3IgPT09IEFycmF5IGFuZCBpbnN0YW5jZW9mIEFycmF5XHJcbi8vIGluIE5vZGUgNyBhbmQgdGhlIGxhdGVyIHZlcnNpb25zIG9mIFY4LCBzbG93ZXIgaW4gb2xkZXIgdmVyc2lvbnMgdGhvdWdoXHJcbnZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheTtcclxuZnVuY3Rpb24gaXNTdGF0ZWZ1bENvbXBvbmVudChvKSB7XHJcbiAgICByZXR1cm4gIWlzVW5kZWZpbmVkKG8ucHJvdG90eXBlKSAmJiAhaXNVbmRlZmluZWQoby5wcm90b3R5cGUucmVuZGVyKTtcclxufVxyXG5mdW5jdGlvbiBpc1N0cmluZ09yTnVtYmVyKG8pIHtcclxuICAgIHZhciB0eXBlID0gdHlwZW9mIG87XHJcbiAgICByZXR1cm4gdHlwZSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlID09PSBcIm51bWJlclwiO1xyXG59XHJcbmZ1bmN0aW9uIGlzTnVsbE9yVW5kZWYobykge1xyXG4gICAgcmV0dXJuIGlzVW5kZWZpbmVkKG8pIHx8IGlzTnVsbChvKTtcclxufVxyXG5mdW5jdGlvbiBpc0ludmFsaWQobykge1xyXG4gICAgcmV0dXJuIGlzTnVsbChvKSB8fCBvID09PSBmYWxzZSB8fCBpc1RydWUobykgfHwgaXNVbmRlZmluZWQobyk7XHJcbn1cclxuZnVuY3Rpb24gaXNGdW5jdGlvbihvKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG8gPT09IFwiZnVuY3Rpb25cIjtcclxufVxyXG5mdW5jdGlvbiBpc1N0cmluZyhvKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG8gPT09IFwic3RyaW5nXCI7XHJcbn1cclxuZnVuY3Rpb24gaXNOdW1iZXIobykge1xyXG4gICAgcmV0dXJuIHR5cGVvZiBvID09PSBcIm51bWJlclwiO1xyXG59XHJcbmZ1bmN0aW9uIGlzTnVsbChvKSB7XHJcbiAgICByZXR1cm4gbyA9PT0gbnVsbDtcclxufVxyXG5mdW5jdGlvbiBpc1RydWUobykge1xyXG4gICAgcmV0dXJuIG8gPT09IHRydWU7XHJcbn1cclxuZnVuY3Rpb24gaXNVbmRlZmluZWQobykge1xyXG4gICAgcmV0dXJuIG8gPT09IHZvaWQgMDtcclxufVxyXG5mdW5jdGlvbiBpc09iamVjdChvKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG8gPT09IFwib2JqZWN0XCI7XHJcbn1cclxuZnVuY3Rpb24gdGhyb3dFcnJvcihtZXNzYWdlKSB7XHJcbiAgICBpZiAoIW1lc3NhZ2UpIHtcclxuICAgICAgICBtZXNzYWdlID0gRVJST1JfTVNHO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKChcIkluZmVybm8gRXJyb3I6IFwiICsgbWVzc2FnZSkpO1xyXG59XHJcbmZ1bmN0aW9uIHdhcm5pbmcobWVzc2FnZSkge1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGVcclxuICAgIGNvbnNvbGUud2FybihtZXNzYWdlKTtcclxufVxyXG5mdW5jdGlvbiBjb21iaW5lRnJvbShmaXJzdCwgc2Vjb25kKSB7XHJcbiAgICB2YXIgb3V0ID0ge307XHJcbiAgICBpZiAoZmlyc3QpIHtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gZmlyc3QpIHtcclxuICAgICAgICAgICAgb3V0W2tleV0gPSBmaXJzdFtrZXldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChzZWNvbmQpIHtcclxuICAgICAgICBmb3IgKHZhciBrZXkkMSBpbiBzZWNvbmQpIHtcclxuICAgICAgICAgICAgb3V0W2tleSQxXSA9IHNlY29uZFtrZXkkMV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dDtcclxufVxyXG5mdW5jdGlvbiBMaWZlY3ljbGUoKSB7XHJcbiAgICB0aGlzLmxpc3RlbmVycyA9IFtdO1xyXG59XHJcbkxpZmVjeWNsZS5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRMaXN0ZW5lcihjYWxsYmFjaykge1xyXG4gICAgdGhpcy5saXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XHJcbn07XHJcbkxpZmVjeWNsZS5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uIHRyaWdnZXIoKSB7XHJcbiAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnM7XHJcbiAgICB2YXIgbGlzdGVuZXI7XHJcbiAgICAvLyBXZSBuZWVkIHRvIHJlbW92ZSBjdXJyZW50IGxpc3RlbmVyIGZyb20gYXJyYXkgd2hlbiBjYWxsaW5nIGl0LCBiZWNhdXNlIG1vcmUgbGlzdGVuZXJzIG1pZ2h0IGJlIGFkZGVkXHJcbiAgICB3aGlsZSAoKGxpc3RlbmVyID0gbGlzdGVuZXJzLnNoaWZ0KCkpKSB7XHJcbiAgICAgICAgbGlzdGVuZXIoKTtcclxuICAgIH1cclxufTtcblxuLyoqXHJcbiAqIEBtb2R1bGUgSW5mZXJub1xyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG52YXIgb3B0aW9ucyA9IHtcclxuICAgIGFmdGVyTW91bnQ6IG51bGwsXHJcbiAgICBhZnRlclJlbmRlcjogbnVsbCxcclxuICAgIGFmdGVyVXBkYXRlOiBudWxsLFxyXG4gICAgYmVmb3JlUmVuZGVyOiBudWxsLFxyXG4gICAgYmVmb3JlVW5tb3VudDogbnVsbCxcclxuICAgIGNyZWF0ZVZOb2RlOiBudWxsLFxyXG4gICAgZmluZERPTU5vZGVFbmFibGVkOiBmYWxzZSxcclxuICAgIHJlY3ljbGluZ0VuYWJsZWQ6IGZhbHNlLFxyXG4gICAgcm9vdHM6IFtdXHJcbn07XG5cbi8qKlxyXG4gKiBAbW9kdWxlIEluZmVybm9cclxuICovIC8qKiBUeXBlRG9jIENvbW1lbnQgKi9cclxudmFyIHhsaW5rTlMgPSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIjtcclxudmFyIHhtbE5TID0gXCJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2VcIjtcclxudmFyIHN2Z05TID0gXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiO1xyXG52YXIgc3RyaWN0UHJvcHMgPSBuZXcgU2V0KCk7XHJcbnN0cmljdFByb3BzLmFkZChcInZvbHVtZVwiKTtcclxuc3RyaWN0UHJvcHMuYWRkKFwiZGVmYXVsdENoZWNrZWRcIik7XHJcbnZhciBib29sZWFuUHJvcHMgPSBuZXcgU2V0KCk7XHJcbmJvb2xlYW5Qcm9wcy5hZGQoXCJtdXRlZFwiKTtcclxuYm9vbGVhblByb3BzLmFkZChcInNjb3BlZFwiKTtcclxuYm9vbGVhblByb3BzLmFkZChcImxvb3BcIik7XHJcbmJvb2xlYW5Qcm9wcy5hZGQoXCJvcGVuXCIpO1xyXG5ib29sZWFuUHJvcHMuYWRkKFwiY2hlY2tlZFwiKTtcclxuYm9vbGVhblByb3BzLmFkZChcImRlZmF1bHRcIik7XHJcbmJvb2xlYW5Qcm9wcy5hZGQoXCJjYXB0dXJlXCIpO1xyXG5ib29sZWFuUHJvcHMuYWRkKFwiZGlzYWJsZWRcIik7XHJcbmJvb2xlYW5Qcm9wcy5hZGQoXCJyZWFkT25seVwiKTtcclxuYm9vbGVhblByb3BzLmFkZChcInJlcXVpcmVkXCIpO1xyXG5ib29sZWFuUHJvcHMuYWRkKFwiYXV0b3BsYXlcIik7XHJcbmJvb2xlYW5Qcm9wcy5hZGQoXCJjb250cm9sc1wiKTtcclxuYm9vbGVhblByb3BzLmFkZChcInNlYW1sZXNzXCIpO1xyXG5ib29sZWFuUHJvcHMuYWRkKFwicmV2ZXJzZWRcIik7XHJcbmJvb2xlYW5Qcm9wcy5hZGQoXCJhbGxvd2Z1bGxzY3JlZW5cIik7XHJcbmJvb2xlYW5Qcm9wcy5hZGQoXCJub3ZhbGlkYXRlXCIpO1xyXG5ib29sZWFuUHJvcHMuYWRkKFwiaGlkZGVuXCIpO1xyXG5ib29sZWFuUHJvcHMuYWRkKFwiYXV0b0ZvY3VzXCIpO1xyXG5ib29sZWFuUHJvcHMuYWRkKFwic2VsZWN0ZWRcIik7XHJcbmJvb2xlYW5Qcm9wcy5hZGQoXCJpbmRldGVybWluYXRlXCIpO1xyXG52YXIgbmFtZXNwYWNlcyA9IG5ldyBNYXAoKTtcclxubmFtZXNwYWNlcy5zZXQoXCJ4bGluazpocmVmXCIsIHhsaW5rTlMpO1xyXG5uYW1lc3BhY2VzLnNldChcInhsaW5rOmFyY3JvbGVcIiwgeGxpbmtOUyk7XHJcbm5hbWVzcGFjZXMuc2V0KFwieGxpbms6YWN0dWF0ZVwiLCB4bGlua05TKTtcclxubmFtZXNwYWNlcy5zZXQoXCJ4bGluazpzaG93XCIsIHhsaW5rTlMpO1xyXG5uYW1lc3BhY2VzLnNldChcInhsaW5rOnJvbGVcIiwgeGxpbmtOUyk7XHJcbm5hbWVzcGFjZXMuc2V0KFwieGxpbms6dGl0bGVcIiwgeGxpbmtOUyk7XHJcbm5hbWVzcGFjZXMuc2V0KFwieGxpbms6dHlwZVwiLCB4bGlua05TKTtcclxubmFtZXNwYWNlcy5zZXQoXCJ4bWw6YmFzZVwiLCB4bWxOUyk7XHJcbm5hbWVzcGFjZXMuc2V0KFwieG1sOmxhbmdcIiwgeG1sTlMpO1xyXG5uYW1lc3BhY2VzLnNldChcInhtbDpzcGFjZVwiLCB4bWxOUyk7XHJcbnZhciBpc1VuaXRsZXNzTnVtYmVyID0gbmV3IFNldCgpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcImFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50XCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcImJvcmRlckltYWdlT3V0c2V0XCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcImJvcmRlckltYWdlU2xpY2VcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwiYm9yZGVySW1hZ2VXaWR0aFwiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJib3hGbGV4XCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcImJveEZsZXhHcm91cFwiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJib3hPcmRpbmFsR3JvdXBcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwiY29sdW1uQ291bnRcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwiZmxleFwiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJmbGV4R3Jvd1wiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJmbGV4UG9zaXRpdmVcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwiZmxleFNocmlua1wiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJmbGV4TmVnYXRpdmVcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwiZmxleE9yZGVyXCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcImdyaWRSb3dcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwiZ3JpZENvbHVtblwiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJmb250V2VpZ2h0XCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcImxpbmVDbGFtcFwiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJsaW5lSGVpZ2h0XCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcIm9wYWNpdHlcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwib3JkZXJcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwib3JwaGFuc1wiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJ0YWJTaXplXCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcIndpZG93c1wiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJ6SW5kZXhcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwiem9vbVwiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJmaWxsT3BhY2l0eVwiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJmbG9vZE9wYWNpdHlcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwic3RvcE9wYWNpdHlcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwic3Ryb2tlRGFzaGFycmF5XCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcInN0cm9rZURhc2hvZmZzZXRcIik7XHJcbmlzVW5pdGxlc3NOdW1iZXIuYWRkKFwic3Ryb2tlTWl0ZXJsaW1pdFwiKTtcclxuaXNVbml0bGVzc051bWJlci5hZGQoXCJzdHJva2VPcGFjaXR5XCIpO1xyXG5pc1VuaXRsZXNzTnVtYmVyLmFkZChcInN0cm9rZVdpZHRoXCIpO1xyXG52YXIgc2tpcFByb3BzID0gbmV3IFNldCgpO1xyXG5za2lwUHJvcHMuYWRkKFwiY2hpbGRyZW5cIik7XHJcbnNraXBQcm9wcy5hZGQoXCJjaGlsZHJlblR5cGVcIik7XHJcbnNraXBQcm9wcy5hZGQoXCJkZWZhdWx0VmFsdWVcIik7XHJcbnNraXBQcm9wcy5hZGQoXCJyZWZcIik7XHJcbnNraXBQcm9wcy5hZGQoXCJrZXlcIik7XHJcbnNraXBQcm9wcy5hZGQoXCJjaGVja2VkXCIpO1xyXG5za2lwUHJvcHMuYWRkKFwibXVsdGlwbGVcIik7XHJcbnZhciBkZWxlZ2F0ZWRFdmVudHMgPSBuZXcgU2V0KCk7XHJcbmRlbGVnYXRlZEV2ZW50cy5hZGQoXCJvbkNsaWNrXCIpO1xyXG5kZWxlZ2F0ZWRFdmVudHMuYWRkKFwib25Nb3VzZURvd25cIik7XHJcbmRlbGVnYXRlZEV2ZW50cy5hZGQoXCJvbk1vdXNlVXBcIik7XHJcbmRlbGVnYXRlZEV2ZW50cy5hZGQoXCJvbk1vdXNlTW92ZVwiKTtcclxuZGVsZWdhdGVkRXZlbnRzLmFkZChcIm9uU3VibWl0XCIpO1xyXG5kZWxlZ2F0ZWRFdmVudHMuYWRkKFwib25EYmxDbGlja1wiKTtcclxuZGVsZWdhdGVkRXZlbnRzLmFkZChcIm9uS2V5RG93blwiKTtcclxuZGVsZWdhdGVkRXZlbnRzLmFkZChcIm9uS2V5VXBcIik7XHJcbmRlbGVnYXRlZEV2ZW50cy5hZGQoXCJvbktleVByZXNzXCIpO1xuXG4vKipcclxuICogQG1vZHVsZSBJbmZlcm5vXHJcbiAqLyAvKiogVHlwZURvYyBDb21tZW50ICovXHJcbnZhciBpc2lPUyA9IGlzQnJvd3NlciAmJlxyXG4gICAgISFuYXZpZ2F0b3IucGxhdGZvcm0gJiZcclxuICAgIC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KG5hdmlnYXRvci5wbGF0Zm9ybSk7XHJcbnZhciBkZWxlZ2F0ZWRFdmVudHMkMSA9IG5ldyBNYXAoKTtcclxuZnVuY3Rpb24gaGFuZGxlRXZlbnQobmFtZSwgbGFzdEV2ZW50LCBuZXh0RXZlbnQsIGRvbSkge1xyXG4gICAgdmFyIGRlbGVnYXRlZFJvb3RzID0gZGVsZWdhdGVkRXZlbnRzJDEuZ2V0KG5hbWUpO1xyXG4gICAgaWYgKG5leHRFdmVudCkge1xyXG4gICAgICAgIGlmICghZGVsZWdhdGVkUm9vdHMpIHtcclxuICAgICAgICAgICAgZGVsZWdhdGVkUm9vdHMgPSB7IGl0ZW1zOiBuZXcgTWFwKCksIGRvY0V2ZW50OiBudWxsIH07XHJcbiAgICAgICAgICAgIGRlbGVnYXRlZFJvb3RzLmRvY0V2ZW50ID0gYXR0YWNoRXZlbnRUb0RvY3VtZW50KG5hbWUsIGRlbGVnYXRlZFJvb3RzKTtcclxuICAgICAgICAgICAgZGVsZWdhdGVkRXZlbnRzJDEuc2V0KG5hbWUsIGRlbGVnYXRlZFJvb3RzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFsYXN0RXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGlzaU9TICYmIG5hbWUgPT09IFwib25DbGlja1wiKSB7XHJcbiAgICAgICAgICAgICAgICB0cmFwQ2xpY2tPbk5vbkludGVyYWN0aXZlRWxlbWVudChkb20pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlbGVnYXRlZFJvb3RzLml0ZW1zLnNldChkb20sIG5leHRFdmVudCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChkZWxlZ2F0ZWRSb290cykge1xyXG4gICAgICAgIHZhciBpdGVtcyA9IGRlbGVnYXRlZFJvb3RzLml0ZW1zO1xyXG4gICAgICAgIGlmIChpdGVtcy5kZWxldGUoZG9tKSkge1xyXG4gICAgICAgICAgICAvLyBJZiBhbnkgaXRlbXMgd2VyZSBkZWxldGVkLCBjaGVjayBpZiBsaXN0ZW5lciBuZWVkIHRvIGJlIHJlbW92ZWRcclxuICAgICAgICAgICAgaWYgKGl0ZW1zLnNpemUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIobm9ybWFsaXplRXZlbnROYW1lKG5hbWUpLCBkZWxlZ2F0ZWRSb290cy5kb2NFdmVudCk7XHJcbiAgICAgICAgICAgICAgICBkZWxlZ2F0ZWRFdmVudHMkMS5kZWxldGUobmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZGlzcGF0Y2hFdmVudHMoZXZlbnQsIHRhcmdldCwgaXRlbXMsIGNvdW50LCBpc0NsaWNrLCBldmVudERhdGEpIHtcclxuICAgIHZhciBkb20gPSB0YXJnZXQ7XHJcbiAgICB3aGlsZSAoY291bnQgPiAwKSB7XHJcbiAgICAgICAgdmFyIGV2ZW50c1RvVHJpZ2dlciA9IGl0ZW1zLmdldChkb20pO1xyXG4gICAgICAgIGlmIChldmVudHNUb1RyaWdnZXIpIHtcclxuICAgICAgICAgICAgY291bnQtLTtcclxuICAgICAgICAgICAgLy8gbGlua0V2ZW50IG9iamVjdFxyXG4gICAgICAgICAgICBldmVudERhdGEuZG9tID0gZG9tO1xyXG4gICAgICAgICAgICBpZiAoZXZlbnRzVG9UcmlnZ2VyLmV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBldmVudHNUb1RyaWdnZXIuZXZlbnQoZXZlbnRzVG9UcmlnZ2VyLmRhdGEsIGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50c1RvVHJpZ2dlcihldmVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGV2ZW50LmNhbmNlbEJ1YmJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRvbSA9IGRvbS5wYXJlbnROb2RlO1xyXG4gICAgICAgIC8vIEh0bWwgTm9kZXMgY2FuIGJlIG5lc3RlZCBmZTogc3BhbiBpbnNpZGUgYnV0dG9uIGluIHRoYXQgc2NlbmFyaW8gYnJvd3NlciBkb2VzIG5vdCBoYW5kbGUgZGlzYWJsZWQgYXR0cmlidXRlIG9uIHBhcmVudCxcclxuICAgICAgICAvLyBiZWNhdXNlIHRoZSBldmVudCBsaXN0ZW5lciBpcyBvbiBkb2N1bWVudC5ib2R5XHJcbiAgICAgICAgLy8gRG9uJ3QgcHJvY2VzcyBjbGlja3Mgb24gZGlzYWJsZWQgZWxlbWVudHNcclxuICAgICAgICBpZiAoZG9tID09PSBudWxsIHx8IChpc0NsaWNrICYmIGRvbS5kaXNhYmxlZCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBub3JtYWxpemVFdmVudE5hbWUobmFtZSkge1xyXG4gICAgcmV0dXJuIG5hbWUuc3Vic3RyKDIpLnRvTG93ZXJDYXNlKCk7XHJcbn1cclxuZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKCkge1xyXG4gICAgdGhpcy5jYW5jZWxCdWJibGUgPSB0cnVlO1xyXG4gICAgdGhpcy5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxufVxyXG5mdW5jdGlvbiBhdHRhY2hFdmVudFRvRG9jdW1lbnQobmFtZSwgZGVsZWdhdGVkUm9vdHMpIHtcclxuICAgIHZhciBkb2NFdmVudCA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBjb3VudCA9IGRlbGVnYXRlZFJvb3RzLml0ZW1zLnNpemU7XHJcbiAgICAgICAgaWYgKGNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24gPSBzdG9wUHJvcGFnYXRpb247XHJcbiAgICAgICAgICAgIC8vIEV2ZW50IGRhdGEgbmVlZHMgdG8gYmUgb2JqZWN0IHRvIHNhdmUgcmVmZXJlbmNlIHRvIGN1cnJlbnRUYXJnZXQgZ2V0dGVyXHJcbiAgICAgICAgICAgIHZhciBldmVudERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBkb206IGRvY3VtZW50XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXZlbnQsIFwiY3VycmVudFRhcmdldFwiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnREYXRhLmRvbTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgLyogc2FmYXJpNyBhbmQgcGhhbnRvbUpTIHdpbGwgY3Jhc2ggKi9cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkaXNwYXRjaEV2ZW50cyhldmVudCwgZXZlbnQudGFyZ2V0LCBkZWxlZ2F0ZWRSb290cy5pdGVtcywgY291bnQsIGV2ZW50LnR5cGUgPT09IFwiY2xpY2tcIiwgZXZlbnREYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihub3JtYWxpemVFdmVudE5hbWUobmFtZSksIGRvY0V2ZW50KTtcclxuICAgIHJldHVybiBkb2NFdmVudDtcclxufVxyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tZW1wdHlcclxuZnVuY3Rpb24gZW1wdHlGbigpIHsgfVxyXG5mdW5jdGlvbiB0cmFwQ2xpY2tPbk5vbkludGVyYWN0aXZlRWxlbWVudChkb20pIHtcclxuICAgIC8vIE1vYmlsZSBTYWZhcmkgZG9lcyBub3QgZmlyZSBwcm9wZXJseSBidWJibGUgY2xpY2sgZXZlbnRzIG9uXHJcbiAgICAvLyBub24taW50ZXJhY3RpdmUgZWxlbWVudHMsIHdoaWNoIG1lYW5zIGRlbGVnYXRlZCBjbGljayBsaXN0ZW5lcnMgZG8gbm90XHJcbiAgICAvLyBmaXJlLiBUaGUgd29ya2Fyb3VuZCBmb3IgdGhpcyBidWcgaW52b2x2ZXMgYXR0YWNoaW5nIGFuIGVtcHR5IGNsaWNrXHJcbiAgICAvLyBsaXN0ZW5lciBvbiB0aGUgdGFyZ2V0IG5vZGUuXHJcbiAgICAvLyBodHRwOi8vd3d3LnF1aXJrc21vZGUub3JnL2Jsb2cvYXJjaGl2ZXMvMjAxMC8wOS9jbGlja19ldmVudF9kZWwuaHRtbFxyXG4gICAgLy8gSnVzdCBzZXQgaXQgdXNpbmcgdGhlIG9uY2xpY2sgcHJvcGVydHkgc28gdGhhdCB3ZSBkb24ndCBoYXZlIHRvIG1hbmFnZSBhbnlcclxuICAgIC8vIGJvb2trZWVwaW5nIGZvciBpdC4gTm90IHN1cmUgaWYgd2UgbmVlZCB0byBjbGVhciBpdCB3aGVuIHRoZSBsaXN0ZW5lciBpc1xyXG4gICAgLy8gcmVtb3ZlZC5cclxuICAgIC8vIFRPRE86IE9ubHkgZG8gdGhpcyBmb3IgdGhlIHJlbGV2YW50IFNhZmFyaXMgbWF5YmU/XHJcbiAgICBkb20ub25jbGljayA9IGVtcHR5Rm47XHJcbn1cblxuLyoqXHJcbiAqIEBtb2R1bGUgSW5mZXJub1xyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG5mdW5jdGlvbiBpc0NoZWNrZWRUeXBlKHR5cGUpIHtcclxuICAgIHJldHVybiB0eXBlID09PSBcImNoZWNrYm94XCIgfHwgdHlwZSA9PT0gXCJyYWRpb1wiO1xyXG59XHJcbmZ1bmN0aW9uIG9uVGV4dElucHV0Q2hhbmdlKGUpIHtcclxuICAgIHZhciB2Tm9kZSA9IHRoaXMudk5vZGU7XHJcbiAgICB2YXIgcHJvcHMgPSB2Tm9kZS5wcm9wcyB8fCBFTVBUWV9PQko7XHJcbiAgICB2YXIgZG9tID0gdk5vZGUuZG9tO1xyXG4gICAgdmFyIHByZXZpb3VzVmFsdWUgPSBwcm9wcy52YWx1ZTtcclxuICAgIGlmIChwcm9wcy5vbklucHV0KSB7XHJcbiAgICAgICAgdmFyIGV2ZW50ID0gcHJvcHMub25JbnB1dDtcclxuICAgICAgICBpZiAoZXZlbnQuZXZlbnQpIHtcclxuICAgICAgICAgICAgZXZlbnQuZXZlbnQoZXZlbnQuZGF0YSwgZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBldmVudChlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChwcm9wcy5vbmlucHV0KSB7XHJcbiAgICAgICAgcHJvcHMub25pbnB1dChlKTtcclxuICAgIH1cclxuICAgIC8vIHRoZSB1c2VyIG1heSBoYXZlIHVwZGF0ZWQgdGhlIHZOb2RlIGZyb20gdGhlIGFib3ZlIG9uSW5wdXQgZXZlbnRzIHN5bmNyb25vdXNseVxyXG4gICAgLy8gc28gd2UgbmVlZCB0byBnZXQgaXQgZnJvbSB0aGUgY29udGV4dCBvZiBgdGhpc2AgYWdhaW5cclxuICAgIHZhciBuZXdWTm9kZSA9IHRoaXMudk5vZGU7XHJcbiAgICB2YXIgbmV3UHJvcHMgPSBuZXdWTm9kZS5wcm9wcyB8fCBFTVBUWV9PQko7XHJcbiAgICAvLyBJZiByZW5kZXIgaXMgZ29pbmcgYXN5bmMgdGhlcmUgaXMgbm8gdmFsdWUgY2hhbmdlIHlldCwgaXQgd2lsbCBjb21lIGJhY2sgdG8gcHJvY2VzcyBpbnB1dCBzb29uXHJcbiAgICBpZiAocHJldmlvdXNWYWx1ZSAhPT0gbmV3UHJvcHMudmFsdWUpIHtcclxuICAgICAgICAvLyBXaGVuIHRoaXMgaGFwcGVucyB3ZSBuZWVkIHRvIHN0b3JlIGN1cnJlbnQgY3Vyc29yIHBvc2l0aW9uIGFuZCByZXN0b3JlIGl0LCB0byBhdm9pZCBqdW1waW5nXHJcbiAgICAgICAgYXBwbHlWYWx1ZShuZXdQcm9wcywgZG9tKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB3cmFwcGVkT25DaGFuZ2UoZSkge1xyXG4gICAgdmFyIHByb3BzID0gdGhpcy52Tm9kZS5wcm9wcyB8fCBFTVBUWV9PQko7XHJcbiAgICB2YXIgZXZlbnQgPSBwcm9wcy5vbkNoYW5nZTtcclxuICAgIGlmIChldmVudC5ldmVudCkge1xyXG4gICAgICAgIGV2ZW50LmV2ZW50KGV2ZW50LmRhdGEsIGUpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgZXZlbnQoZSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gb25DaGVja2JveENoYW5nZShlKSB7XHJcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpOyAvLyBUaGlzIGNsaWNrIHNob3VsZCBub3QgcHJvcGFnYXRlIGl0cyBmb3IgaW50ZXJuYWwgdXNlXHJcbiAgICB2YXIgdk5vZGUgPSB0aGlzLnZOb2RlO1xyXG4gICAgdmFyIHByb3BzID0gdk5vZGUucHJvcHMgfHwgRU1QVFlfT0JKO1xyXG4gICAgdmFyIGRvbSA9IHZOb2RlLmRvbTtcclxuICAgIGlmIChwcm9wcy5vbkNsaWNrKSB7XHJcbiAgICAgICAgdmFyIGV2ZW50ID0gcHJvcHMub25DbGljaztcclxuICAgICAgICBpZiAoZXZlbnQuZXZlbnQpIHtcclxuICAgICAgICAgICAgZXZlbnQuZXZlbnQoZXZlbnQuZGF0YSwgZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBldmVudChlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChwcm9wcy5vbmNsaWNrKSB7XHJcbiAgICAgICAgcHJvcHMub25jbGljayhlKTtcclxuICAgIH1cclxuICAgIC8vIHRoZSB1c2VyIG1heSBoYXZlIHVwZGF0ZWQgdGhlIHZOb2RlIGZyb20gdGhlIGFib3ZlIG9uSW5wdXQgZXZlbnRzIHN5bmNyb25vdXNseVxyXG4gICAgLy8gc28gd2UgbmVlZCB0byBnZXQgaXQgZnJvbSB0aGUgY29udGV4dCBvZiBgdGhpc2AgYWdhaW5cclxuICAgIHZhciBuZXdWTm9kZSA9IHRoaXMudk5vZGU7XHJcbiAgICB2YXIgbmV3UHJvcHMgPSBuZXdWTm9kZS5wcm9wcyB8fCBFTVBUWV9PQko7XHJcbiAgICAvLyBJZiByZW5kZXIgaXMgZ29pbmcgYXN5bmMgdGhlcmUgaXMgbm8gdmFsdWUgY2hhbmdlIHlldCwgaXQgd2lsbCBjb21lIGJhY2sgdG8gcHJvY2VzcyBpbnB1dCBzb29uXHJcbiAgICBhcHBseVZhbHVlKG5ld1Byb3BzLCBkb20pO1xyXG59XHJcbmZ1bmN0aW9uIHByb2Nlc3NJbnB1dCh2Tm9kZSwgZG9tLCBuZXh0UHJvcHNPckVtcHR5LCBtb3VudGluZywgaXNDb250cm9sbGVkKSB7XHJcbiAgICBhcHBseVZhbHVlKG5leHRQcm9wc09yRW1wdHksIGRvbSk7XHJcbiAgICBpZiAoaXNDb250cm9sbGVkKSB7XHJcbiAgICAgICAgZG9tLnZOb2RlID0gdk5vZGU7IC8vIFRPRE86IFJlbW92ZSB0aGlzIHdoZW4gaW1wbGVtZW50aW5nIEZpYmVyJ3NcclxuICAgICAgICBpZiAobW91bnRpbmcpIHtcclxuICAgICAgICAgICAgaWYgKGlzQ2hlY2tlZFR5cGUobmV4dFByb3BzT3JFbXB0eS50eXBlKSkge1xyXG4gICAgICAgICAgICAgICAgZG9tLm9uY2xpY2sgPSBvbkNoZWNrYm94Q2hhbmdlO1xyXG4gICAgICAgICAgICAgICAgZG9tLm9uY2xpY2sud3JhcHBlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkb20ub25pbnB1dCA9IG9uVGV4dElucHV0Q2hhbmdlO1xyXG4gICAgICAgICAgICAgICAgZG9tLm9uaW5wdXQud3JhcHBlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5leHRQcm9wc09yRW1wdHkub25DaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIGRvbS5vbmNoYW5nZSA9IHdyYXBwZWRPbkNoYW5nZTtcclxuICAgICAgICAgICAgICAgIGRvbS5vbmNoYW5nZS53cmFwcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBhcHBseVZhbHVlKG5leHRQcm9wc09yRW1wdHksIGRvbSkge1xyXG4gICAgdmFyIHR5cGUgPSBuZXh0UHJvcHNPckVtcHR5LnR5cGU7XHJcbiAgICB2YXIgdmFsdWUgPSBuZXh0UHJvcHNPckVtcHR5LnZhbHVlO1xyXG4gICAgdmFyIGNoZWNrZWQgPSBuZXh0UHJvcHNPckVtcHR5LmNoZWNrZWQ7XHJcbiAgICB2YXIgbXVsdGlwbGUgPSBuZXh0UHJvcHNPckVtcHR5Lm11bHRpcGxlO1xyXG4gICAgdmFyIGRlZmF1bHRWYWx1ZSA9IG5leHRQcm9wc09yRW1wdHkuZGVmYXVsdFZhbHVlO1xyXG4gICAgdmFyIGhhc1ZhbHVlID0gIWlzTnVsbE9yVW5kZWYodmFsdWUpO1xyXG4gICAgaWYgKHR5cGUgJiYgdHlwZSAhPT0gZG9tLnR5cGUpIHtcclxuICAgICAgICBkb20uc2V0QXR0cmlidXRlKFwidHlwZVwiLCB0eXBlKTtcclxuICAgIH1cclxuICAgIGlmIChtdWx0aXBsZSAmJiBtdWx0aXBsZSAhPT0gZG9tLm11bHRpcGxlKSB7XHJcbiAgICAgICAgZG9tLm11bHRpcGxlID0gbXVsdGlwbGU7XHJcbiAgICB9XHJcbiAgICBpZiAoIWlzTnVsbE9yVW5kZWYoZGVmYXVsdFZhbHVlKSAmJiAhaGFzVmFsdWUpIHtcclxuICAgICAgICBkb20uZGVmYXVsdFZhbHVlID0gZGVmYXVsdFZhbHVlICsgXCJcIjtcclxuICAgIH1cclxuICAgIGlmIChpc0NoZWNrZWRUeXBlKHR5cGUpKSB7XHJcbiAgICAgICAgaWYgKGhhc1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIGRvbS52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWYoY2hlY2tlZCkpIHtcclxuICAgICAgICAgICAgZG9tLmNoZWNrZWQgPSBjaGVja2VkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChoYXNWYWx1ZSAmJiBkb20udmFsdWUgIT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGRvbS5kZWZhdWx0VmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgZG9tLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCFpc051bGxPclVuZGVmKGNoZWNrZWQpKSB7XHJcbiAgICAgICAgICAgIGRvbS5jaGVja2VkID0gY2hlY2tlZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBtb2R1bGUgSW5mZXJub1xyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG5mdW5jdGlvbiB1cGRhdGVDaGlsZE9wdGlvbkdyb3VwKHZOb2RlLCB2YWx1ZSkge1xyXG4gICAgdmFyIHR5cGUgPSB2Tm9kZS50eXBlO1xyXG4gICAgaWYgKHR5cGUgPT09IFwib3B0Z3JvdXBcIikge1xyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHZOb2RlLmNoaWxkcmVuO1xyXG4gICAgICAgIGlmIChpc0FycmF5KGNoaWxkcmVuKSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZUNoaWxkT3B0aW9uKGNoaWxkcmVuW2ldLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoaXNWTm9kZShjaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgdXBkYXRlQ2hpbGRPcHRpb24oY2hpbGRyZW4sIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB1cGRhdGVDaGlsZE9wdGlvbih2Tm9kZSwgdmFsdWUpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHVwZGF0ZUNoaWxkT3B0aW9uKHZOb2RlLCB2YWx1ZSkge1xyXG4gICAgdmFyIHByb3BzID0gdk5vZGUucHJvcHMgfHwgRU1QVFlfT0JKO1xyXG4gICAgdmFyIGRvbSA9IHZOb2RlLmRvbTtcclxuICAgIC8vIHdlIGRvIHRoaXMgYXMgbXVsdGlwbGUgbWF5IGhhdmUgY2hhbmdlZFxyXG4gICAgZG9tLnZhbHVlID0gcHJvcHMudmFsdWU7XHJcbiAgICBpZiAoKGlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmluZGV4T2YocHJvcHMudmFsdWUpICE9PSAtMSkgfHxcclxuICAgICAgICBwcm9wcy52YWx1ZSA9PT0gdmFsdWUpIHtcclxuICAgICAgICBkb20uc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIWlzTnVsbE9yVW5kZWYodmFsdWUpIHx8ICFpc051bGxPclVuZGVmKHByb3BzLnNlbGVjdGVkKSkge1xyXG4gICAgICAgIGRvbS5zZWxlY3RlZCA9IHByb3BzLnNlbGVjdGVkIHx8IGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG9uU2VsZWN0Q2hhbmdlKGUpIHtcclxuICAgIHZhciB2Tm9kZSA9IHRoaXMudk5vZGU7XHJcbiAgICB2YXIgcHJvcHMgPSB2Tm9kZS5wcm9wcyB8fCBFTVBUWV9PQko7XHJcbiAgICB2YXIgZG9tID0gdk5vZGUuZG9tO1xyXG4gICAgdmFyIHByZXZpb3VzVmFsdWUgPSBwcm9wcy52YWx1ZTtcclxuICAgIGlmIChwcm9wcy5vbkNoYW5nZSkge1xyXG4gICAgICAgIHZhciBldmVudCA9IHByb3BzLm9uQ2hhbmdlO1xyXG4gICAgICAgIGlmIChldmVudC5ldmVudCkge1xyXG4gICAgICAgICAgICBldmVudC5ldmVudChldmVudC5kYXRhLCBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGV2ZW50KGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHByb3BzLm9uY2hhbmdlKSB7XHJcbiAgICAgICAgcHJvcHMub25jaGFuZ2UoZSk7XHJcbiAgICB9XHJcbiAgICAvLyB0aGUgdXNlciBtYXkgaGF2ZSB1cGRhdGVkIHRoZSB2Tm9kZSBmcm9tIHRoZSBhYm92ZSBvbklucHV0IGV2ZW50cyBzeW5jcm9ub3VzbHlcclxuICAgIC8vIHNvIHdlIG5lZWQgdG8gZ2V0IGl0IGZyb20gdGhlIGNvbnRleHQgb2YgYHRoaXNgIGFnYWluXHJcbiAgICB2YXIgbmV3Vk5vZGUgPSB0aGlzLnZOb2RlO1xyXG4gICAgdmFyIG5ld1Byb3BzID0gbmV3Vk5vZGUucHJvcHMgfHwgRU1QVFlfT0JKO1xyXG4gICAgLy8gSWYgcmVuZGVyIGlzIGdvaW5nIGFzeW5jIHRoZXJlIGlzIG5vIHZhbHVlIGNoYW5nZSB5ZXQsIGl0IHdpbGwgY29tZSBiYWNrIHRvIHByb2Nlc3MgaW5wdXQgc29vblxyXG4gICAgaWYgKHByZXZpb3VzVmFsdWUgIT09IG5ld1Byb3BzLnZhbHVlKSB7XHJcbiAgICAgICAgLy8gV2hlbiB0aGlzIGhhcHBlbnMgd2UgbmVlZCB0byBzdG9yZSBjdXJyZW50IGN1cnNvciBwb3NpdGlvbiBhbmQgcmVzdG9yZSBpdCwgdG8gYXZvaWQganVtcGluZ1xyXG4gICAgICAgIGFwcGx5VmFsdWUkMShuZXdWTm9kZSwgZG9tLCBuZXdQcm9wcywgZmFsc2UpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHByb2Nlc3NTZWxlY3Qodk5vZGUsIGRvbSwgbmV4dFByb3BzT3JFbXB0eSwgbW91bnRpbmcsIGlzQ29udHJvbGxlZCkge1xyXG4gICAgYXBwbHlWYWx1ZSQxKHZOb2RlLCBkb20sIG5leHRQcm9wc09yRW1wdHksIG1vdW50aW5nKTtcclxuICAgIGlmIChpc0NvbnRyb2xsZWQpIHtcclxuICAgICAgICBkb20udk5vZGUgPSB2Tm9kZTsgLy8gVE9ETzogUmVtb3ZlIHRoaXMgd2hlbiBpbXBsZW1lbnRpbmcgRmliZXInc1xyXG4gICAgICAgIGlmIChtb3VudGluZykge1xyXG4gICAgICAgICAgICBkb20ub25jaGFuZ2UgPSBvblNlbGVjdENoYW5nZTtcclxuICAgICAgICAgICAgZG9tLm9uY2hhbmdlLndyYXBwZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBhcHBseVZhbHVlJDEodk5vZGUsIGRvbSwgbmV4dFByb3BzT3JFbXB0eSwgbW91bnRpbmcpIHtcclxuICAgIGlmIChuZXh0UHJvcHNPckVtcHR5Lm11bHRpcGxlICE9PSBkb20ubXVsdGlwbGUpIHtcclxuICAgICAgICBkb20ubXVsdGlwbGUgPSBuZXh0UHJvcHNPckVtcHR5Lm11bHRpcGxlO1xyXG4gICAgfVxyXG4gICAgdmFyIGNoaWxkcmVuID0gdk5vZGUuY2hpbGRyZW47XHJcbiAgICBpZiAoIWlzSW52YWxpZChjaGlsZHJlbikpIHtcclxuICAgICAgICB2YXIgdmFsdWUgPSBuZXh0UHJvcHNPckVtcHR5LnZhbHVlO1xyXG4gICAgICAgIGlmIChtb3VudGluZyAmJiBpc051bGxPclVuZGVmKHZhbHVlKSkge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IG5leHRQcm9wc09yRW1wdHkuZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNBcnJheShjaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVDaGlsZE9wdGlvbkdyb3VwKGNoaWxkcmVuW2ldLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoaXNWTm9kZShjaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgdXBkYXRlQ2hpbGRPcHRpb25Hcm91cChjaGlsZHJlbiwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG4vKipcclxuICogQG1vZHVsZSBJbmZlcm5vXHJcbiAqLyAvKiogVHlwZURvYyBDb21tZW50ICovXHJcbmZ1bmN0aW9uIHdyYXBwZWRPbkNoYW5nZSQxKGUpIHtcclxuICAgIHZhciBwcm9wcyA9IHRoaXMudk5vZGUucHJvcHMgfHwgRU1QVFlfT0JKO1xyXG4gICAgdmFyIGV2ZW50ID0gcHJvcHMub25DaGFuZ2U7XHJcbiAgICBpZiAoZXZlbnQuZXZlbnQpIHtcclxuICAgICAgICBldmVudC5ldmVudChldmVudC5kYXRhLCBlKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGV2ZW50KGUpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG9uVGV4dGFyZWFJbnB1dENoYW5nZShlKSB7XHJcbiAgICB2YXIgdk5vZGUgPSB0aGlzLnZOb2RlO1xyXG4gICAgdmFyIHByb3BzID0gdk5vZGUucHJvcHMgfHwgRU1QVFlfT0JKO1xyXG4gICAgdmFyIHByZXZpb3VzVmFsdWUgPSBwcm9wcy52YWx1ZTtcclxuICAgIGlmIChwcm9wcy5vbklucHV0KSB7XHJcbiAgICAgICAgdmFyIGV2ZW50ID0gcHJvcHMub25JbnB1dDtcclxuICAgICAgICBpZiAoZXZlbnQuZXZlbnQpIHtcclxuICAgICAgICAgICAgZXZlbnQuZXZlbnQoZXZlbnQuZGF0YSwgZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBldmVudChlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChwcm9wcy5vbmlucHV0KSB7XHJcbiAgICAgICAgcHJvcHMub25pbnB1dChlKTtcclxuICAgIH1cclxuICAgIC8vIHRoZSB1c2VyIG1heSBoYXZlIHVwZGF0ZWQgdGhlIHZOb2RlIGZyb20gdGhlIGFib3ZlIG9uSW5wdXQgZXZlbnRzIHN5bmNyb25vdXNseVxyXG4gICAgLy8gc28gd2UgbmVlZCB0byBnZXQgaXQgZnJvbSB0aGUgY29udGV4dCBvZiBgdGhpc2AgYWdhaW5cclxuICAgIHZhciBuZXdWTm9kZSA9IHRoaXMudk5vZGU7XHJcbiAgICB2YXIgbmV3UHJvcHMgPSBuZXdWTm9kZS5wcm9wcyB8fCBFTVBUWV9PQko7XHJcbiAgICAvLyBJZiByZW5kZXIgaXMgZ29pbmcgYXN5bmMgdGhlcmUgaXMgbm8gdmFsdWUgY2hhbmdlIHlldCwgaXQgd2lsbCBjb21lIGJhY2sgdG8gcHJvY2VzcyBpbnB1dCBzb29uXHJcbiAgICBpZiAocHJldmlvdXNWYWx1ZSAhPT0gbmV3UHJvcHMudmFsdWUpIHtcclxuICAgICAgICAvLyBXaGVuIHRoaXMgaGFwcGVucyB3ZSBuZWVkIHRvIHN0b3JlIGN1cnJlbnQgY3Vyc29yIHBvc2l0aW9uIGFuZCByZXN0b3JlIGl0LCB0byBhdm9pZCBqdW1waW5nXHJcbiAgICAgICAgYXBwbHlWYWx1ZSQyKG5ld1ZOb2RlLCB2Tm9kZS5kb20sIGZhbHNlKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBwcm9jZXNzVGV4dGFyZWEodk5vZGUsIGRvbSwgbmV4dFByb3BzT3JFbXB0eSwgbW91bnRpbmcsIGlzQ29udHJvbGxlZCkge1xyXG4gICAgYXBwbHlWYWx1ZSQyKG5leHRQcm9wc09yRW1wdHksIGRvbSwgbW91bnRpbmcpO1xyXG4gICAgaWYgKGlzQ29udHJvbGxlZCkge1xyXG4gICAgICAgIGRvbS52Tm9kZSA9IHZOb2RlOyAvLyBUT0RPOiBSZW1vdmUgdGhpcyB3aGVuIGltcGxlbWVudGluZyBGaWJlcidzXHJcbiAgICAgICAgaWYgKG1vdW50aW5nKSB7XHJcbiAgICAgICAgICAgIGRvbS5vbmlucHV0ID0gb25UZXh0YXJlYUlucHV0Q2hhbmdlO1xyXG4gICAgICAgICAgICBkb20ub25pbnB1dC53cmFwcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKG5leHRQcm9wc09yRW1wdHkub25DaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIGRvbS5vbmNoYW5nZSA9IHdyYXBwZWRPbkNoYW5nZSQxO1xyXG4gICAgICAgICAgICAgICAgZG9tLm9uY2hhbmdlLndyYXBwZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGFwcGx5VmFsdWUkMihuZXh0UHJvcHNPckVtcHR5LCBkb20sIG1vdW50aW5nKSB7XHJcbiAgICB2YXIgdmFsdWUgPSBuZXh0UHJvcHNPckVtcHR5LnZhbHVlO1xyXG4gICAgdmFyIGRvbVZhbHVlID0gZG9tLnZhbHVlO1xyXG4gICAgaWYgKGlzTnVsbE9yVW5kZWYodmFsdWUpKSB7XHJcbiAgICAgICAgaWYgKG1vdW50aW5nKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSBuZXh0UHJvcHNPckVtcHR5LmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmKGRlZmF1bHRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0VmFsdWUgIT09IGRvbVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9tLmRlZmF1bHRWYWx1ZSA9IGRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBkb20udmFsdWUgPSBkZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZG9tVmFsdWUgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGRvbS5kZWZhdWx0VmFsdWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgZG9tLnZhbHVlID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8qIFRoZXJlIGlzIHZhbHVlIHNvIGtlZXAgaXQgY29udHJvbGxlZCAqL1xyXG4gICAgICAgIGlmIChkb21WYWx1ZSAhPT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgZG9tLmRlZmF1bHRWYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICBkb20udmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBtb2R1bGUgSW5mZXJub1xyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG4vKipcclxuICogVGhlcmUgaXMgY3VycmVudGx5IG5vIHN1cHBvcnQgZm9yIHN3aXRjaGluZyBzYW1lIGlucHV0IGJldHdlZW4gY29udHJvbGxlZCBhbmQgbm9uQ29udHJvbGxlZFxyXG4gKiBJZiB0aGF0IGV2ZXIgYmVjb21lcyBhIHJlYWwgaXNzdWUsIHRoZW4gcmUgZGVzaWduIGNvbnRyb2xsZWQgZWxlbWVudHNcclxuICogQ3VycmVudGx5IHVzZXIgbXVzdCBjaG9vc2UgZWl0aGVyIGNvbnRyb2xsZWQgb3Igbm9uLWNvbnRyb2xsZWQgYW5kIHN0aWNrIHdpdGggdGhhdFxyXG4gKi9cclxuZnVuY3Rpb24gcHJvY2Vzc0VsZW1lbnQoZmxhZ3MsIHZOb2RlLCBkb20sIG5leHRQcm9wc09yRW1wdHksIG1vdW50aW5nLCBpc0NvbnRyb2xsZWQpIHtcclxuICAgIGlmIChmbGFncyAmIDUxMiAvKiBJbnB1dEVsZW1lbnQgKi8pIHtcclxuICAgICAgICBwcm9jZXNzSW5wdXQodk5vZGUsIGRvbSwgbmV4dFByb3BzT3JFbXB0eSwgbW91bnRpbmcsIGlzQ29udHJvbGxlZCk7XHJcbiAgICB9XHJcbiAgICBpZiAoZmxhZ3MgJiAyMDQ4IC8qIFNlbGVjdEVsZW1lbnQgKi8pIHtcclxuICAgICAgICBwcm9jZXNzU2VsZWN0KHZOb2RlLCBkb20sIG5leHRQcm9wc09yRW1wdHksIG1vdW50aW5nLCBpc0NvbnRyb2xsZWQpO1xyXG4gICAgfVxyXG4gICAgaWYgKGZsYWdzICYgMTAyNCAvKiBUZXh0YXJlYUVsZW1lbnQgKi8pIHtcclxuICAgICAgICBwcm9jZXNzVGV4dGFyZWEodk5vZGUsIGRvbSwgbmV4dFByb3BzT3JFbXB0eSwgbW91bnRpbmcsIGlzQ29udHJvbGxlZCk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gaXNDb250cm9sbGVkRm9ybUVsZW1lbnQobmV4dFByb3BzT3JFbXB0eSkge1xyXG4gICAgcmV0dXJuIG5leHRQcm9wc09yRW1wdHkudHlwZSAmJiBpc0NoZWNrZWRUeXBlKG5leHRQcm9wc09yRW1wdHkudHlwZSlcclxuICAgICAgICA/ICFpc051bGxPclVuZGVmKG5leHRQcm9wc09yRW1wdHkuY2hlY2tlZClcclxuICAgICAgICA6ICFpc051bGxPclVuZGVmKG5leHRQcm9wc09yRW1wdHkudmFsdWUpO1xyXG59XG5cbi8qKlxyXG4gKiBAbW9kdWxlIEluZmVybm9cclxuICovIC8qKiBUeXBlRG9jIENvbW1lbnQgKi9cclxuZnVuY3Rpb24gbm9ybWFsaXplQ2hpbGROb2RlcyhwYXJlbnREb20pIHtcclxuICAgIHZhciBkb20gPSBwYXJlbnREb20uZmlyc3RDaGlsZDtcclxuICAgIHdoaWxlIChkb20pIHtcclxuICAgICAgICBpZiAoZG9tLm5vZGVUeXBlID09PSA4KSB7XHJcbiAgICAgICAgICAgIGlmIChkb20uZGF0YSA9PT0gXCIhXCIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlciA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgcGFyZW50RG9tLnJlcGxhY2VDaGlsZChwbGFjZWhvbGRlciwgZG9tKTtcclxuICAgICAgICAgICAgICAgIGRvbSA9IGRvbS5uZXh0U2libGluZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBsYXN0RG9tID0gZG9tLnByZXZpb3VzU2libGluZztcclxuICAgICAgICAgICAgICAgIHBhcmVudERvbS5yZW1vdmVDaGlsZChkb20pO1xyXG4gICAgICAgICAgICAgICAgZG9tID0gbGFzdERvbSB8fCBwYXJlbnREb20uZmlyc3RDaGlsZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZG9tID0gZG9tLm5leHRTaWJsaW5nO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBoeWRyYXRlQ29tcG9uZW50KHZOb2RlLCBkb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcsIGlzQ2xhc3MpIHtcclxuICAgIHZhciB0eXBlID0gdk5vZGUudHlwZTtcclxuICAgIHZhciByZWYgPSB2Tm9kZS5yZWY7XHJcbiAgICB2YXIgcHJvcHMgPSB2Tm9kZS5wcm9wcyB8fCBFTVBUWV9PQko7XHJcbiAgICBpZiAoaXNDbGFzcykge1xyXG4gICAgICAgIHZhciBfaXNTVkcgPSBkb20ubmFtZXNwYWNlVVJJID09PSBzdmdOUztcclxuICAgICAgICB2YXIgaW5zdGFuY2UgPSBjcmVhdGVDbGFzc0NvbXBvbmVudEluc3RhbmNlKHZOb2RlLCB0eXBlLCBwcm9wcywgY29udGV4dCwgX2lzU1ZHLCBsaWZlY3ljbGUpO1xyXG4gICAgICAgIHZhciBpbnB1dCA9IGluc3RhbmNlLl9sYXN0SW5wdXQ7XHJcbiAgICAgICAgaW5zdGFuY2UuX3ZOb2RlID0gdk5vZGU7XHJcbiAgICAgICAgaHlkcmF0ZShpbnB1dCwgZG9tLCBsaWZlY3ljbGUsIGluc3RhbmNlLl9jaGlsZENvbnRleHQsIF9pc1NWRyk7XHJcbiAgICAgICAgdk5vZGUuZG9tID0gaW5wdXQuZG9tO1xyXG4gICAgICAgIG1vdW50Q2xhc3NDb21wb25lbnRDYWxsYmFja3Modk5vZGUsIHJlZiwgaW5zdGFuY2UsIGxpZmVjeWNsZSk7XHJcbiAgICAgICAgaW5zdGFuY2UuX3VwZGF0aW5nID0gZmFsc2U7IC8vIE1vdW50IGZpbmlzaGVkIGFsbG93IGdvaW5nIHN5bmNcclxuICAgICAgICBpZiAob3B0aW9ucy5maW5kRE9NTm9kZUVuYWJsZWQpIHtcclxuICAgICAgICAgICAgY29tcG9uZW50VG9ET01Ob2RlTWFwLnNldChpbnN0YW5jZSwgZG9tKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB2YXIgaW5wdXQkMSA9IGNyZWF0ZUZ1bmN0aW9uYWxDb21wb25lbnRJbnB1dCh2Tm9kZSwgdHlwZSwgcHJvcHMsIGNvbnRleHQpO1xyXG4gICAgICAgIGh5ZHJhdGUoaW5wdXQkMSwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICB2Tm9kZS5jaGlsZHJlbiA9IGlucHV0JDE7XHJcbiAgICAgICAgdk5vZGUuZG9tID0gaW5wdXQkMS5kb207XHJcbiAgICAgICAgbW91bnRGdW5jdGlvbmFsQ29tcG9uZW50Q2FsbGJhY2tzKHByb3BzLCByZWYsIGRvbSwgbGlmZWN5Y2xlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBkb207XHJcbn1cclxuZnVuY3Rpb24gaHlkcmF0ZUVsZW1lbnQodk5vZGUsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRykge1xyXG4gICAgdmFyIGNoaWxkcmVuID0gdk5vZGUuY2hpbGRyZW47XHJcbiAgICB2YXIgcHJvcHMgPSB2Tm9kZS5wcm9wcztcclxuICAgIHZhciBjbGFzc05hbWUgPSB2Tm9kZS5jbGFzc05hbWU7XHJcbiAgICB2YXIgZmxhZ3MgPSB2Tm9kZS5mbGFncztcclxuICAgIHZhciByZWYgPSB2Tm9kZS5yZWY7XHJcbiAgICBpc1NWRyA9IGlzU1ZHIHx8IChmbGFncyAmIDEyOCAvKiBTdmdFbGVtZW50ICovKSA+IDA7XHJcbiAgICBpZiAoZG9tLm5vZGVUeXBlICE9PSAxIHx8IGRvbS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT09IHZOb2RlLnR5cGUpIHtcclxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XHJcbiAgICAgICAgICAgIHdhcm5pbmcoXCJJbmZlcm5vIGh5ZHJhdGlvbjogU2VydmVyLXNpZGUgbWFya3VwIGRvZXNuJ3QgbWF0Y2ggY2xpZW50LXNpZGUgbWFya3VwIG9yIEluaXRpYWwgcmVuZGVyIHRhcmdldCBpcyBub3QgZW1wdHlcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBuZXdEb20gPSBtb3VudEVsZW1lbnQodk5vZGUsIG51bGwsIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcpO1xyXG4gICAgICAgIHZOb2RlLmRvbSA9IG5ld0RvbTtcclxuICAgICAgICByZXBsYWNlQ2hpbGQoZG9tLnBhcmVudE5vZGUsIG5ld0RvbSwgZG9tKTtcclxuICAgICAgICByZXR1cm4gbmV3RG9tO1xyXG4gICAgfVxyXG4gICAgdk5vZGUuZG9tID0gZG9tO1xyXG4gICAgaWYgKCFpc0ludmFsaWQoY2hpbGRyZW4pKSB7XHJcbiAgICAgICAgaHlkcmF0ZUNoaWxkcmVuKGNoaWxkcmVuLCBkb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoZG9tLmZpcnN0Q2hpbGQgIT09IG51bGwpIHtcclxuICAgICAgICBkb20udGV4dENvbnRlbnQgPSBcIlwiOyAvLyBkb20gaGFzIGNvbnRlbnQsIGJ1dCBWTm9kZSBoYXMgbm8gY2hpbGRyZW4gcmVtb3ZlIGV2ZXJ5dGhpbmcgZnJvbSBET01cclxuICAgIH1cclxuICAgIGlmIChwcm9wcykge1xyXG4gICAgICAgIHZhciBoYXNDb250cm9sbGVkVmFsdWUgPSBmYWxzZTtcclxuICAgICAgICB2YXIgaXNGb3JtRWxlbWVudCA9IChmbGFncyAmIDM1ODQgLyogRm9ybUVsZW1lbnQgKi8pID4gMDtcclxuICAgICAgICBpZiAoaXNGb3JtRWxlbWVudCkge1xyXG4gICAgICAgICAgICBoYXNDb250cm9sbGVkVmFsdWUgPSBpc0NvbnRyb2xsZWRGb3JtRWxlbWVudChwcm9wcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gcHJvcHMpIHtcclxuICAgICAgICAgICAgLy8gZG8gbm90IGFkZCBhIGhhc093blByb3BlcnR5IGNoZWNrIGhlcmUsIGl0IGFmZmVjdHMgcGVyZm9ybWFuY2VcclxuICAgICAgICAgICAgcGF0Y2hQcm9wKHByb3AsIG51bGwsIHByb3BzW3Byb3BdLCBkb20sIGlzU1ZHLCBoYXNDb250cm9sbGVkVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNGb3JtRWxlbWVudCkge1xyXG4gICAgICAgICAgICBwcm9jZXNzRWxlbWVudChmbGFncywgdk5vZGUsIGRvbSwgcHJvcHMsIHRydWUsIGhhc0NvbnRyb2xsZWRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCFpc051bGxPclVuZGVmKGNsYXNzTmFtZSkpIHtcclxuICAgICAgICBpZiAoaXNTVkcpIHtcclxuICAgICAgICAgICAgZG9tLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIGNsYXNzTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBkb20uY2xhc3NOYW1lID0gY2xhc3NOYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChkb20uY2xhc3NOYW1lICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGRvbS5yZW1vdmVBdHRyaWJ1dGUoXCJjbGFzc1wiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAocmVmKSB7XHJcbiAgICAgICAgbW91bnRSZWYoZG9tLCByZWYsIGxpZmVjeWNsZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZG9tO1xyXG59XHJcbmZ1bmN0aW9uIGh5ZHJhdGVDaGlsZHJlbihjaGlsZHJlbiwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSB7XHJcbiAgICBub3JtYWxpemVDaGlsZE5vZGVzKHBhcmVudERvbSk7XHJcbiAgICB2YXIgZG9tID0gcGFyZW50RG9tLmZpcnN0Q2hpbGQ7XHJcbiAgICBpZiAoaXNTdHJpbmdPck51bWJlcihjaGlsZHJlbikpIHtcclxuICAgICAgICBpZiAoIWlzTnVsbChkb20pICYmIGRvbS5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgICAgICBpZiAoZG9tLm5vZGVWYWx1ZSAhPT0gY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgIGRvbS5ub2RlVmFsdWUgPSBjaGlsZHJlbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjaGlsZHJlbiA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICBwYXJlbnREb20uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJcIikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcGFyZW50RG9tLnRleHRDb250ZW50ID0gY2hpbGRyZW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaXNOdWxsKGRvbSkpIHtcclxuICAgICAgICAgICAgZG9tID0gZG9tLm5leHRTaWJsaW5nO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzQXJyYXkoY2hpbGRyZW4pKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICBpZiAoIWlzTnVsbChjaGlsZCkgJiYgaXNPYmplY3QoY2hpbGQpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWlzTnVsbChkb20pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRTaWJsaW5nID0gZG9tLm5leHRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgICAgIGh5ZHJhdGUoY2hpbGQsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9tID0gbmV4dFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtb3VudChjaGlsZCwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIEl0J3MgVk5vZGVcclxuICAgICAgICBpZiAoIWlzTnVsbChkb20pKSB7XHJcbiAgICAgICAgICAgIGh5ZHJhdGUoY2hpbGRyZW4sIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRyk7XHJcbiAgICAgICAgICAgIGRvbSA9IGRvbS5uZXh0U2libGluZztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG1vdW50KGNoaWxkcmVuLCBwYXJlbnREb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIGNsZWFyIGFueSBvdGhlciBET00gbm9kZXMsIHRoZXJlIHNob3VsZCBiZSBvbmx5IGEgc2luZ2xlIGVudHJ5IGZvciB0aGUgcm9vdFxyXG4gICAgd2hpbGUgKGRvbSkge1xyXG4gICAgICAgIHZhciBuZXh0U2libGluZyQxID0gZG9tLm5leHRTaWJsaW5nO1xyXG4gICAgICAgIHBhcmVudERvbS5yZW1vdmVDaGlsZChkb20pO1xyXG4gICAgICAgIGRvbSA9IG5leHRTaWJsaW5nJDE7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gaHlkcmF0ZVRleHQodk5vZGUsIGRvbSkge1xyXG4gICAgaWYgKGRvbS5ub2RlVHlwZSAhPT0gMykge1xyXG4gICAgICAgIHZhciBuZXdEb20gPSBtb3VudFRleHQodk5vZGUsIG51bGwpO1xyXG4gICAgICAgIHZOb2RlLmRvbSA9IG5ld0RvbTtcclxuICAgICAgICByZXBsYWNlQ2hpbGQoZG9tLnBhcmVudE5vZGUsIG5ld0RvbSwgZG9tKTtcclxuICAgICAgICByZXR1cm4gbmV3RG9tO1xyXG4gICAgfVxyXG4gICAgdmFyIHRleHQgPSB2Tm9kZS5jaGlsZHJlbjtcclxuICAgIGlmIChkb20ubm9kZVZhbHVlICE9PSB0ZXh0KSB7XHJcbiAgICAgICAgZG9tLm5vZGVWYWx1ZSA9IHRleHQ7XHJcbiAgICB9XHJcbiAgICB2Tm9kZS5kb20gPSBkb207XHJcbiAgICByZXR1cm4gZG9tO1xyXG59XHJcbmZ1bmN0aW9uIGh5ZHJhdGVWb2lkKHZOb2RlLCBkb20pIHtcclxuICAgIHZOb2RlLmRvbSA9IGRvbTtcclxuICAgIHJldHVybiBkb207XHJcbn1cclxuZnVuY3Rpb24gaHlkcmF0ZSh2Tm9kZSwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSB7XHJcbiAgICB2YXIgZmxhZ3MgPSB2Tm9kZS5mbGFncztcclxuICAgIGlmIChmbGFncyAmIDI4IC8qIENvbXBvbmVudCAqLykge1xyXG4gICAgICAgIGh5ZHJhdGVDb21wb25lbnQodk5vZGUsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgKGZsYWdzICYgNCAvKiBDb21wb25lbnRDbGFzcyAqLykgPiAwKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGZsYWdzICYgMzk3MCAvKiBFbGVtZW50ICovKSB7XHJcbiAgICAgICAgaHlkcmF0ZUVsZW1lbnQodk5vZGUsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChmbGFncyAmIDEgLyogVGV4dCAqLykge1xyXG4gICAgICAgIGh5ZHJhdGVUZXh0KHZOb2RlLCBkb20pO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoZmxhZ3MgJiA0MDk2IC8qIFZvaWQgKi8pIHtcclxuICAgICAgICBoeWRyYXRlVm9pZCh2Tm9kZSwgZG9tKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcclxuICAgICAgICAgICAgdGhyb3dFcnJvcigoXCJoeWRyYXRlKCkgZXhwZWN0cyBhIHZhbGlkIFZOb2RlLCBpbnN0ZWFkIGl0IHJlY2VpdmVkIGFuIG9iamVjdCB3aXRoIHRoZSB0eXBlIFxcXCJcIiArICh0eXBlb2Ygdk5vZGUpICsgXCJcXFwiLlwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93RXJyb3IoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBoeWRyYXRlUm9vdChpbnB1dCwgcGFyZW50RG9tLCBsaWZlY3ljbGUpIHtcclxuICAgIGlmICghaXNOdWxsKHBhcmVudERvbSkpIHtcclxuICAgICAgICB2YXIgZG9tID0gcGFyZW50RG9tLmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgaWYgKCFpc051bGwoZG9tKSkge1xyXG4gICAgICAgICAgICBoeWRyYXRlKGlucHV0LCBkb20sIGxpZmVjeWNsZSwgRU1QVFlfT0JKLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGRvbSA9IHBhcmVudERvbS5maXJzdENoaWxkO1xyXG4gICAgICAgICAgICAvLyBjbGVhciBhbnkgb3RoZXIgRE9NIG5vZGVzLCB0aGVyZSBzaG91bGQgYmUgb25seSBhIHNpbmdsZSBlbnRyeSBmb3IgdGhlIHJvb3RcclxuICAgICAgICAgICAgd2hpbGUgKChkb20gPSBkb20ubmV4dFNpYmxpbmcpKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnREb20ucmVtb3ZlQ2hpbGQoZG9tKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cblxuLyoqXHJcbiAqIEBtb2R1bGUgSW5mZXJub1xyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG52YXIgY29tcG9uZW50UG9vbHMgPSBuZXcgTWFwKCk7XHJcbnZhciBlbGVtZW50UG9vbHMgPSBuZXcgTWFwKCk7XHJcbmZ1bmN0aW9uIHJlY3ljbGVFbGVtZW50KHZOb2RlLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSB7XHJcbiAgICB2YXIgdGFnID0gdk5vZGUudHlwZTtcclxuICAgIHZhciBwb29scyA9IGVsZW1lbnRQb29scy5nZXQodGFnKTtcclxuICAgIGlmICghaXNVbmRlZmluZWQocG9vbHMpKSB7XHJcbiAgICAgICAgdmFyIGtleSA9IHZOb2RlLmtleTtcclxuICAgICAgICB2YXIgcG9vbCA9IGtleSA9PT0gbnVsbCA/IHBvb2xzLm5vbktleWVkIDogcG9vbHMua2V5ZWQuZ2V0KGtleSk7XHJcbiAgICAgICAgaWYgKCFpc1VuZGVmaW5lZChwb29sKSkge1xyXG4gICAgICAgICAgICB2YXIgcmVjeWNsZWRWTm9kZSA9IHBvb2wucG9wKCk7XHJcbiAgICAgICAgICAgIGlmICghaXNVbmRlZmluZWQocmVjeWNsZWRWTm9kZSkpIHtcclxuICAgICAgICAgICAgICAgIHBhdGNoRWxlbWVudChyZWN5Y2xlZFZOb2RlLCB2Tm9kZSwgbnVsbCwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdk5vZGUuZG9tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn1cclxuZnVuY3Rpb24gcG9vbEVsZW1lbnQodk5vZGUpIHtcclxuICAgIHZhciB0YWcgPSB2Tm9kZS50eXBlO1xyXG4gICAgdmFyIGtleSA9IHZOb2RlLmtleTtcclxuICAgIHZhciBwb29scyA9IGVsZW1lbnRQb29scy5nZXQodGFnKTtcclxuICAgIGlmIChpc1VuZGVmaW5lZChwb29scykpIHtcclxuICAgICAgICBwb29scyA9IHtcclxuICAgICAgICAgICAga2V5ZWQ6IG5ldyBNYXAoKSxcclxuICAgICAgICAgICAgbm9uS2V5ZWQ6IFtdXHJcbiAgICAgICAgfTtcclxuICAgICAgICBlbGVtZW50UG9vbHMuc2V0KHRhZywgcG9vbHMpO1xyXG4gICAgfVxyXG4gICAgaWYgKGlzTnVsbChrZXkpKSB7XHJcbiAgICAgICAgcG9vbHMubm9uS2V5ZWQucHVzaCh2Tm9kZSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB2YXIgcG9vbCA9IHBvb2xzLmtleWVkLmdldChrZXkpO1xyXG4gICAgICAgIGlmIChpc1VuZGVmaW5lZChwb29sKSkge1xyXG4gICAgICAgICAgICBwb29sID0gW107XHJcbiAgICAgICAgICAgIHBvb2xzLmtleWVkLnNldChrZXksIHBvb2wpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwb29sLnB1c2godk5vZGUpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHJlY3ljbGVDb21wb25lbnQodk5vZGUsIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcpIHtcclxuICAgIHZhciB0eXBlID0gdk5vZGUudHlwZTtcclxuICAgIHZhciBwb29scyA9IGNvbXBvbmVudFBvb2xzLmdldCh0eXBlKTtcclxuICAgIGlmICghaXNVbmRlZmluZWQocG9vbHMpKSB7XHJcbiAgICAgICAgdmFyIGtleSA9IHZOb2RlLmtleTtcclxuICAgICAgICB2YXIgcG9vbCA9IGtleSA9PT0gbnVsbCA/IHBvb2xzLm5vbktleWVkIDogcG9vbHMua2V5ZWQuZ2V0KGtleSk7XHJcbiAgICAgICAgaWYgKCFpc1VuZGVmaW5lZChwb29sKSkge1xyXG4gICAgICAgICAgICB2YXIgcmVjeWNsZWRWTm9kZSA9IHBvb2wucG9wKCk7XHJcbiAgICAgICAgICAgIGlmICghaXNVbmRlZmluZWQocmVjeWNsZWRWTm9kZSkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmbGFncyA9IHZOb2RlLmZsYWdzO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZhaWxlZCA9IHBhdGNoQ29tcG9uZW50KHJlY3ljbGVkVk5vZGUsIHZOb2RlLCBudWxsLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCAoZmxhZ3MgJiA0IC8qIENvbXBvbmVudENsYXNzICovKSA+IDAsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFmYWlsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdk5vZGUuZG9tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn1cclxuZnVuY3Rpb24gcG9vbENvbXBvbmVudCh2Tm9kZSkge1xyXG4gICAgdmFyIGhvb2tzID0gdk5vZGUucmVmO1xyXG4gICAgdmFyIG5vblJlY3ljbGVIb29rcyA9IGhvb2tzICYmXHJcbiAgICAgICAgKGhvb2tzLm9uQ29tcG9uZW50V2lsbE1vdW50IHx8XHJcbiAgICAgICAgICAgIGhvb2tzLm9uQ29tcG9uZW50V2lsbFVubW91bnQgfHxcclxuICAgICAgICAgICAgaG9va3Mub25Db21wb25lbnREaWRNb3VudCB8fFxyXG4gICAgICAgICAgICBob29rcy5vbkNvbXBvbmVudFdpbGxVcGRhdGUgfHxcclxuICAgICAgICAgICAgaG9va3Mub25Db21wb25lbnREaWRVcGRhdGUpO1xyXG4gICAgaWYgKG5vblJlY3ljbGVIb29rcykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciB0eXBlID0gdk5vZGUudHlwZTtcclxuICAgIHZhciBrZXkgPSB2Tm9kZS5rZXk7XHJcbiAgICB2YXIgcG9vbHMgPSBjb21wb25lbnRQb29scy5nZXQodHlwZSk7XHJcbiAgICBpZiAoaXNVbmRlZmluZWQocG9vbHMpKSB7XHJcbiAgICAgICAgcG9vbHMgPSB7XHJcbiAgICAgICAgICAgIGtleWVkOiBuZXcgTWFwKCksXHJcbiAgICAgICAgICAgIG5vbktleWVkOiBbXVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29tcG9uZW50UG9vbHMuc2V0KHR5cGUsIHBvb2xzKTtcclxuICAgIH1cclxuICAgIGlmIChpc051bGwoa2V5KSkge1xyXG4gICAgICAgIHBvb2xzLm5vbktleWVkLnB1c2godk5vZGUpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgdmFyIHBvb2wgPSBwb29scy5rZXllZC5nZXQoa2V5KTtcclxuICAgICAgICBpZiAoaXNVbmRlZmluZWQocG9vbCkpIHtcclxuICAgICAgICAgICAgcG9vbCA9IFtdO1xyXG4gICAgICAgICAgICBwb29scy5rZXllZC5zZXQoa2V5LCBwb29sKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcG9vbC5wdXNoKHZOb2RlKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQG1vZHVsZSBJbmZlcm5vXHJcbiAqLyAvKiogVHlwZURvYyBDb21tZW50ICovXHJcbmZ1bmN0aW9uIHVubW91bnQodk5vZGUsIHBhcmVudERvbSwgbGlmZWN5Y2xlLCBjYW5SZWN5Y2xlLCBpc1JlY3ljbGluZykge1xyXG4gICAgdmFyIGZsYWdzID0gdk5vZGUuZmxhZ3M7XHJcbiAgICBpZiAoZmxhZ3MgJiAyOCAvKiBDb21wb25lbnQgKi8pIHtcclxuICAgICAgICB1bm1vdW50Q29tcG9uZW50KHZOb2RlLCBwYXJlbnREb20sIGxpZmVjeWNsZSwgY2FuUmVjeWNsZSwgaXNSZWN5Y2xpbmcpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoZmxhZ3MgJiAzOTcwIC8qIEVsZW1lbnQgKi8pIHtcclxuICAgICAgICB1bm1vdW50RWxlbWVudCh2Tm9kZSwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNhblJlY3ljbGUsIGlzUmVjeWNsaW5nKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGZsYWdzICYgKDEgLyogVGV4dCAqLyB8IDQwOTYgLyogVm9pZCAqLykpIHtcclxuICAgICAgICB1bm1vdW50Vm9pZE9yVGV4dCh2Tm9kZSwgcGFyZW50RG9tKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB1bm1vdW50Vm9pZE9yVGV4dCh2Tm9kZSwgcGFyZW50RG9tKSB7XHJcbiAgICBpZiAoIWlzTnVsbChwYXJlbnREb20pKSB7XHJcbiAgICAgICAgcmVtb3ZlQ2hpbGQocGFyZW50RG9tLCB2Tm9kZS5kb20pO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHVubW91bnRDb21wb25lbnQodk5vZGUsIHBhcmVudERvbSwgbGlmZWN5Y2xlLCBjYW5SZWN5Y2xlLCBpc1JlY3ljbGluZykge1xyXG4gICAgdmFyIGluc3RhbmNlID0gdk5vZGUuY2hpbGRyZW47XHJcbiAgICB2YXIgZmxhZ3MgPSB2Tm9kZS5mbGFncztcclxuICAgIHZhciBpc1N0YXRlZnVsQ29tcG9uZW50JCQxID0gZmxhZ3MgJiA0O1xyXG4gICAgdmFyIHByb3BzID0gdk5vZGUucHJvcHMgfHwgRU1QVFlfT0JKO1xyXG4gICAgdmFyIHJlZiA9IHZOb2RlLnJlZjtcclxuICAgIHZhciBkb20gPSB2Tm9kZS5kb207XHJcbiAgICBpZiAoIWlzUmVjeWNsaW5nKSB7XHJcbiAgICAgICAgaWYgKGlzU3RhdGVmdWxDb21wb25lbnQkJDEpIHtcclxuICAgICAgICAgICAgaWYgKCFpbnN0YW5jZS5fdW5tb3VudGVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWlzTnVsbChvcHRpb25zLmJlZm9yZVVubW91bnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5iZWZvcmVVbm1vdW50KHZOb2RlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghaXNVbmRlZmluZWQoaW5zdGFuY2UuY29tcG9uZW50V2lsbFVubW91bnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuY29tcG9uZW50V2lsbFVubW91bnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZWYgJiYgIWlzUmVjeWNsaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVmKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuX3VubW91bnRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5maW5kRE9NTm9kZUVuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRUb0RPTU5vZGVNYXAuZGVsZXRlKGluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHVubW91bnQoaW5zdGFuY2UuX2xhc3RJbnB1dCwgbnVsbCwgaW5zdGFuY2UuX2xpZmVjeWNsZSwgZmFsc2UsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmKHJlZikpIHtcclxuICAgICAgICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZihyZWYub25Db21wb25lbnRXaWxsVW5tb3VudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWYub25Db21wb25lbnRXaWxsVW5tb3VudChkb20sIHByb3BzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB1bm1vdW50KGluc3RhbmNlLCBudWxsLCBsaWZlY3ljbGUsIGZhbHNlLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHBhcmVudERvbSkge1xyXG4gICAgICAgIHJlbW92ZUNoaWxkKHBhcmVudERvbSwgZG9tKTtcclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLnJlY3ljbGluZ0VuYWJsZWQgJiZcclxuICAgICAgICAhaXNTdGF0ZWZ1bENvbXBvbmVudCQkMSAmJlxyXG4gICAgICAgIChwYXJlbnREb20gfHwgY2FuUmVjeWNsZSkpIHtcclxuICAgICAgICBwb29sQ29tcG9uZW50KHZOb2RlKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB1bm1vdW50RWxlbWVudCh2Tm9kZSwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNhblJlY3ljbGUsIGlzUmVjeWNsaW5nKSB7XHJcbiAgICB2YXIgZG9tID0gdk5vZGUuZG9tO1xyXG4gICAgdmFyIHJlZiA9IHZOb2RlLnJlZjtcclxuICAgIHZhciBwcm9wcyA9IHZOb2RlLnByb3BzO1xyXG4gICAgaWYgKHJlZiAmJiAhaXNSZWN5Y2xpbmcpIHtcclxuICAgICAgICB1bm1vdW50UmVmKHJlZik7XHJcbiAgICB9XHJcbiAgICB2YXIgY2hpbGRyZW4gPSB2Tm9kZS5jaGlsZHJlbjtcclxuICAgIGlmICghaXNOdWxsT3JVbmRlZihjaGlsZHJlbikpIHtcclxuICAgICAgICB1bm1vdW50Q2hpbGRyZW4kMShjaGlsZHJlbiwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZyk7XHJcbiAgICB9XHJcbiAgICBpZiAoIWlzTnVsbChwcm9wcykpIHtcclxuICAgICAgICBmb3IgKHZhciBuYW1lIGluIHByb3BzKSB7XHJcbiAgICAgICAgICAgIC8vIGRvIG5vdCBhZGQgYSBoYXNPd25Qcm9wZXJ0eSBjaGVjayBoZXJlLCBpdCBhZmZlY3RzIHBlcmZvcm1hbmNlXHJcbiAgICAgICAgICAgIGlmIChwcm9wc1tuYW1lXSAhPT0gbnVsbCAmJiBpc0F0dHJBbkV2ZW50KG5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICBwYXRjaEV2ZW50KG5hbWUsIHByb3BzW25hbWVdLCBudWxsLCBkb20pO1xyXG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBzZXQgdGhpcyBudWxsLCBiZWNhdXNlIHNhbWUgcHJvcHMgb3RoZXJ3aXNlIGNvbWUgYmFjayBpZiBTQ1UgcmV0dXJucyBmYWxzZSBhbmQgd2UgYXJlIHJlY3lsaW5nXHJcbiAgICAgICAgICAgICAgICBwcm9wc1tuYW1lXSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIWlzTnVsbChwYXJlbnREb20pKSB7XHJcbiAgICAgICAgcmVtb3ZlQ2hpbGQocGFyZW50RG9tLCBkb20pO1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMucmVjeWNsaW5nRW5hYmxlZCAmJiAocGFyZW50RG9tIHx8IGNhblJlY3ljbGUpKSB7XHJcbiAgICAgICAgcG9vbEVsZW1lbnQodk5vZGUpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHVubW91bnRDaGlsZHJlbiQxKGNoaWxkcmVuLCBsaWZlY3ljbGUsIGlzUmVjeWNsaW5nKSB7XHJcbiAgICBpZiAoaXNBcnJheShjaGlsZHJlbikpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07XHJcbiAgICAgICAgICAgIGlmICghaXNJbnZhbGlkKGNoaWxkKSAmJiBpc09iamVjdChjaGlsZCkpIHtcclxuICAgICAgICAgICAgICAgIHVubW91bnQoY2hpbGQsIG51bGwsIGxpZmVjeWNsZSwgZmFsc2UsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzT2JqZWN0KGNoaWxkcmVuKSkge1xyXG4gICAgICAgIHVubW91bnQoY2hpbGRyZW4sIG51bGwsIGxpZmVjeWNsZSwgZmFsc2UsIGlzUmVjeWNsaW5nKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB1bm1vdW50UmVmKHJlZikge1xyXG4gICAgaWYgKGlzRnVuY3Rpb24ocmVmKSkge1xyXG4gICAgICAgIHJlZihudWxsKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChpc0ludmFsaWQocmVmKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcclxuICAgICAgICAgICAgdGhyb3dFcnJvcignc3RyaW5nIFwicmVmc1wiIGFyZSBub3Qgc3VwcG9ydGVkIGluIEluZmVybm8gMS4wLiBVc2UgY2FsbGJhY2sgXCJyZWZzXCIgaW5zdGVhZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3dFcnJvcigpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbW9kdWxlIEluZmVybm9cclxuICovIC8qKiBUeXBlRG9jIENvbW1lbnQgKi9cclxuLy8gcmF0aGVyIHRoYW4gdXNlIGEgTWFwLCBsaWtlIHdlIGRpZCBiZWZvcmUsIHdlIGNhbiB1c2UgYW4gYXJyYXkgaGVyZVxyXG4vLyBnaXZlbiB0aGVyZSBzaG91bGRuJ3QgYmUgVEhBVCBtYW55IHJvb3RzIG9uIHRoZSBwYWdlLCB0aGUgZGlmZmVyZW5jZVxyXG4vLyBpbiBwZXJmb3JtYW5jZSBpcyBodWdlOiBodHRwczovL2VzYmVuY2guY29tL2JlbmNoLzU4MDJhNjkxMzMwYWIwOTkwMGExYTJkYVxyXG52YXIgY29tcG9uZW50VG9ET01Ob2RlTWFwID0gbmV3IE1hcCgpO1xyXG52YXIgcm9vdHMgPSBvcHRpb25zLnJvb3RzO1xyXG4vKipcclxuICogV2hlbiBpbmZlcm5vLm9wdGlvbnMuZmluZERPTU5PZGVFbmFibGVkIGlzIHRydWUsIHRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4gRE9NIE5vZGUgYnkgY29tcG9uZW50IGluc3RhbmNlXHJcbiAqIEBwYXJhbSByZWYgQ29tcG9uZW50IGluc3RhbmNlXHJcbiAqIEByZXR1cm5zIHsqfG51bGx9IHJldHVybnMgZG9tIG5vZGVcclxuICovXHJcbmZ1bmN0aW9uIGZpbmRET01Ob2RlKHJlZikge1xyXG4gICAgaWYgKCFvcHRpb25zLmZpbmRET01Ob2RlRW5hYmxlZCkge1xyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcclxuICAgICAgICAgICAgdGhyb3dFcnJvcihcImZpbmRET01Ob2RlKCkgaGFzIGJlZW4gZGlzYWJsZWQsIHVzZSBJbmZlcm5vLm9wdGlvbnMuZmluZERPTU5vZGVFbmFibGVkID0gdHJ1ZTsgZW5hYmxlZCBmaW5kRE9NTm9kZSgpLiBXYXJuaW5nIHRoaXMgY2FuIHNpZ25pZmljYW50bHkgaW1wYWN0IHBlcmZvcm1hbmNlIVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3dFcnJvcigpO1xyXG4gICAgfVxyXG4gICAgdmFyIGRvbSA9IHJlZiAmJiByZWYubm9kZVR5cGUgPyByZWYgOiBudWxsO1xyXG4gICAgcmV0dXJuIGNvbXBvbmVudFRvRE9NTm9kZU1hcC5nZXQocmVmKSB8fCBkb207XHJcbn1cclxuZnVuY3Rpb24gZ2V0Um9vdChkb20pIHtcclxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSByb290cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgIHZhciByb290ID0gcm9vdHNbaV07XHJcbiAgICAgICAgaWYgKHJvb3QuZG9tID09PSBkb20pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJvb3Q7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn1cclxuZnVuY3Rpb24gc2V0Um9vdChkb20sIGlucHV0LCBsaWZlY3ljbGUpIHtcclxuICAgIHZhciByb290ID0ge1xyXG4gICAgICAgIGRvbTogZG9tLFxyXG4gICAgICAgIGlucHV0OiBpbnB1dCxcclxuICAgICAgICBsaWZlY3ljbGU6IGxpZmVjeWNsZVxyXG4gICAgfTtcclxuICAgIHJvb3RzLnB1c2gocm9vdCk7XHJcbiAgICByZXR1cm4gcm9vdDtcclxufVxyXG5mdW5jdGlvbiByZW1vdmVSb290KHJvb3QpIHtcclxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSByb290cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgIGlmIChyb290c1tpXSA9PT0gcm9vdCkge1xyXG4gICAgICAgICAgICByb290cy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgaWYgKGlzQnJvd3NlciAmJiBkb2N1bWVudC5ib2R5ID09PSBudWxsKSB7XHJcbiAgICAgICAgd2FybmluZygnSW5mZXJubyB3YXJuaW5nOiB5b3UgY2Fubm90IGluaXRpYWxpemUgaW5mZXJubyB3aXRob3V0IFwiZG9jdW1lbnQuYm9keVwiLiBXYWl0IG9uIFwiRE9NQ29udGVudExvYWRlZFwiIGV2ZW50LCBhZGQgc2NyaXB0IHRvIGJvdHRvbSBvZiBib2R5LCBvciB1c2UgYXN5bmMvZGVmZXIgYXR0cmlidXRlcyBvbiBzY3JpcHQgdGFnLicpO1xyXG4gICAgfVxyXG59XHJcbnZhciBkb2N1bWVudEJvZHkgPSBpc0Jyb3dzZXIgPyBkb2N1bWVudC5ib2R5IDogbnVsbDtcclxuLyoqXHJcbiAqIFJlbmRlcnMgdmlydHVhbCBub2RlIHRyZWUgaW50byBwYXJlbnQgbm9kZS5cclxuICogQHBhcmFtIHtWTm9kZSB8IG51bGwgfCBzdHJpbmcgfCBudW1iZXJ9IGlucHV0IHZOb2RlIHRvIGJlIHJlbmRlcmVkXHJcbiAqIEBwYXJhbSBwYXJlbnREb20gRE9NIG5vZGUgd2hpY2ggY29udGVudCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZpcnR1YWwgbm9kZVxyXG4gKiBAcmV0dXJucyB7SW5mZXJub0NoaWxkcmVufSByZW5kZXJlZCB2aXJ0dWFsIG5vZGVcclxuICovXHJcbmZ1bmN0aW9uIHJlbmRlcihpbnB1dCwgcGFyZW50RG9tKSB7XHJcbiAgICBpZiAoZG9jdW1lbnRCb2R5ID09PSBwYXJlbnREb20pIHtcclxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XHJcbiAgICAgICAgICAgIHRocm93RXJyb3IoJ3lvdSBjYW5ub3QgcmVuZGVyKCkgdG8gdGhlIFwiZG9jdW1lbnQuYm9keVwiLiBVc2UgYW4gZW1wdHkgZWxlbWVudCBhcyBhIGNvbnRhaW5lciBpbnN0ZWFkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvd0Vycm9yKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoaW5wdXQgPT09IE5PX09QKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIHJvb3QgPSBnZXRSb290KHBhcmVudERvbSk7XHJcbiAgICBpZiAoaXNOdWxsKHJvb3QpKSB7XHJcbiAgICAgICAgdmFyIGxpZmVjeWNsZSA9IG5ldyBMaWZlY3ljbGUoKTtcclxuICAgICAgICBpZiAoIWlzSW52YWxpZChpbnB1dCkpIHtcclxuICAgICAgICAgICAgaWYgKGlucHV0LmRvbSkge1xyXG4gICAgICAgICAgICAgICAgaW5wdXQgPSBkaXJlY3RDbG9uZShpbnB1dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFoeWRyYXRlUm9vdChpbnB1dCwgcGFyZW50RG9tLCBsaWZlY3ljbGUpKSB7XHJcbiAgICAgICAgICAgICAgICBtb3VudChpbnB1dCwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIEVNUFRZX09CSiwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJvb3QgPSBzZXRSb290KHBhcmVudERvbSwgaW5wdXQsIGxpZmVjeWNsZSk7XHJcbiAgICAgICAgICAgIGxpZmVjeWNsZS50cmlnZ2VyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgdmFyIGxpZmVjeWNsZSQxID0gcm9vdC5saWZlY3ljbGU7XHJcbiAgICAgICAgbGlmZWN5Y2xlJDEubGlzdGVuZXJzID0gW107XHJcbiAgICAgICAgaWYgKGlzTnVsbE9yVW5kZWYoaW5wdXQpKSB7XHJcbiAgICAgICAgICAgIHVubW91bnQocm9vdC5pbnB1dCwgcGFyZW50RG9tLCBsaWZlY3ljbGUkMSwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICAgICAgcmVtb3ZlUm9vdChyb290KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChpbnB1dC5kb20pIHtcclxuICAgICAgICAgICAgICAgIGlucHV0ID0gZGlyZWN0Q2xvbmUoaW5wdXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBhdGNoKHJvb3QuaW5wdXQsIGlucHV0LCBwYXJlbnREb20sIGxpZmVjeWNsZSQxLCBFTVBUWV9PQkosIGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJvb3QuaW5wdXQgPSBpbnB1dDtcclxuICAgICAgICBsaWZlY3ljbGUkMS50cmlnZ2VyKCk7XHJcbiAgICB9XHJcbiAgICBpZiAocm9vdCkge1xyXG4gICAgICAgIHZhciByb290SW5wdXQgPSByb290LmlucHV0O1xyXG4gICAgICAgIGlmIChyb290SW5wdXQgJiYgcm9vdElucHV0LmZsYWdzICYgMjggLyogQ29tcG9uZW50ICovKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByb290SW5wdXQuY2hpbGRyZW47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZVJlbmRlcmVyKHBhcmVudERvbSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIHJlbmRlcmVyKGxhc3RJbnB1dCwgbmV4dElucHV0KSB7XHJcbiAgICAgICAgaWYgKCFwYXJlbnREb20pIHtcclxuICAgICAgICAgICAgcGFyZW50RG9tID0gbGFzdElucHV0O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW5kZXIobmV4dElucHV0LCBwYXJlbnREb20pO1xyXG4gICAgfTtcclxufVxuXG4vKipcclxuICogQG1vZHVsZSBJbmZlcm5vXHJcbiAqLyAvKiogVHlwZURvYyBDb21tZW50ICovXHJcbmZ1bmN0aW9uIHBhdGNoKGxhc3RWTm9kZSwgbmV4dFZOb2RlLCBwYXJlbnREb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcsIGlzUmVjeWNsaW5nKSB7XHJcbiAgICBpZiAobGFzdFZOb2RlICE9PSBuZXh0Vk5vZGUpIHtcclxuICAgICAgICB2YXIgbGFzdEZsYWdzID0gbGFzdFZOb2RlLmZsYWdzO1xyXG4gICAgICAgIHZhciBuZXh0RmxhZ3MgPSBuZXh0Vk5vZGUuZmxhZ3M7XHJcbiAgICAgICAgaWYgKG5leHRGbGFncyAmIDI4IC8qIENvbXBvbmVudCAqLykge1xyXG4gICAgICAgICAgICB2YXIgaXNDbGFzcyA9IChuZXh0RmxhZ3MgJiA0IC8qIENvbXBvbmVudENsYXNzICovKSA+IDA7XHJcbiAgICAgICAgICAgIGlmIChsYXN0RmxhZ3MgJiAyOCAvKiBDb21wb25lbnQgKi8pIHtcclxuICAgICAgICAgICAgICAgIHBhdGNoQ29tcG9uZW50KGxhc3RWTm9kZSwgbmV4dFZOb2RlLCBwYXJlbnREb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcsIGlzQ2xhc3MsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlcGxhY2VWTm9kZShwYXJlbnREb20sIG1vdW50Q29tcG9uZW50KG5leHRWTm9kZSwgbnVsbCwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNDbGFzcyksIGxhc3RWTm9kZSwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAobmV4dEZsYWdzICYgMzk3MCAvKiBFbGVtZW50ICovKSB7XHJcbiAgICAgICAgICAgIGlmIChsYXN0RmxhZ3MgJiAzOTcwIC8qIEVsZW1lbnQgKi8pIHtcclxuICAgICAgICAgICAgICAgIHBhdGNoRWxlbWVudChsYXN0Vk5vZGUsIG5leHRWTm9kZSwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXBsYWNlVk5vZGUocGFyZW50RG9tLCBtb3VudEVsZW1lbnQobmV4dFZOb2RlLCBudWxsLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSwgbGFzdFZOb2RlLCBsaWZlY3ljbGUsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChuZXh0RmxhZ3MgJiAxIC8qIFRleHQgKi8pIHtcclxuICAgICAgICAgICAgaWYgKGxhc3RGbGFncyAmIDEgLyogVGV4dCAqLykge1xyXG4gICAgICAgICAgICAgICAgcGF0Y2hUZXh0KGxhc3RWTm9kZSwgbmV4dFZOb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlcGxhY2VWTm9kZShwYXJlbnREb20sIG1vdW50VGV4dChuZXh0Vk5vZGUsIG51bGwpLCBsYXN0Vk5vZGUsIGxpZmVjeWNsZSwgaXNSZWN5Y2xpbmcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG5leHRGbGFncyAmIDQwOTYgLyogVm9pZCAqLykge1xyXG4gICAgICAgICAgICBpZiAobGFzdEZsYWdzICYgNDA5NiAvKiBWb2lkICovKSB7XHJcbiAgICAgICAgICAgICAgICBwYXRjaFZvaWQobGFzdFZOb2RlLCBuZXh0Vk5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVwbGFjZVZOb2RlKHBhcmVudERvbSwgbW91bnRWb2lkKG5leHRWTm9kZSwgbnVsbCksIGxhc3RWTm9kZSwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEVycm9yIGNhc2U6IG1vdW50IG5ldyBvbmUgcmVwbGFjaW5nIG9sZCBvbmVcclxuICAgICAgICAgICAgcmVwbGFjZUxhc3RDaGlsZEFuZFVubW91bnQobGFzdFZOb2RlLCBuZXh0Vk5vZGUsIHBhcmVudERvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNSZWN5Y2xpbmcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB1bm1vdW50Q2hpbGRyZW4oY2hpbGRyZW4sIGRvbSwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZykge1xyXG4gICAgaWYgKGlzVk5vZGUoY2hpbGRyZW4pKSB7XHJcbiAgICAgICAgdW5tb3VudChjaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIHRydWUsIGlzUmVjeWNsaW5nKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzQXJyYXkoY2hpbGRyZW4pKSB7XHJcbiAgICAgICAgcmVtb3ZlQWxsQ2hpbGRyZW4oZG9tLCBjaGlsZHJlbiwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBkb20udGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHBhdGNoRWxlbWVudChsYXN0Vk5vZGUsIG5leHRWTm9kZSwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZykge1xyXG4gICAgdmFyIG5leHRUYWcgPSBuZXh0Vk5vZGUudHlwZTtcclxuICAgIHZhciBsYXN0VGFnID0gbGFzdFZOb2RlLnR5cGU7XHJcbiAgICBpZiAobGFzdFRhZyAhPT0gbmV4dFRhZykge1xyXG4gICAgICAgIHJlcGxhY2VXaXRoTmV3Tm9kZShsYXN0Vk5vZGUsIG5leHRWTm9kZSwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB2YXIgZG9tID0gbGFzdFZOb2RlLmRvbTtcclxuICAgICAgICB2YXIgbGFzdFByb3BzID0gbGFzdFZOb2RlLnByb3BzO1xyXG4gICAgICAgIHZhciBuZXh0UHJvcHMgPSBuZXh0Vk5vZGUucHJvcHM7XHJcbiAgICAgICAgdmFyIGxhc3RDaGlsZHJlbiA9IGxhc3RWTm9kZS5jaGlsZHJlbjtcclxuICAgICAgICB2YXIgbmV4dENoaWxkcmVuID0gbmV4dFZOb2RlLmNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBsYXN0RmxhZ3MgPSBsYXN0Vk5vZGUuZmxhZ3M7XHJcbiAgICAgICAgdmFyIG5leHRGbGFncyA9IG5leHRWTm9kZS5mbGFncztcclxuICAgICAgICB2YXIgbmV4dFJlZiA9IG5leHRWTm9kZS5yZWY7XHJcbiAgICAgICAgdmFyIGxhc3RDbGFzc05hbWUgPSBsYXN0Vk5vZGUuY2xhc3NOYW1lO1xyXG4gICAgICAgIHZhciBuZXh0Q2xhc3NOYW1lID0gbmV4dFZOb2RlLmNsYXNzTmFtZTtcclxuICAgICAgICBuZXh0Vk5vZGUuZG9tID0gZG9tO1xyXG4gICAgICAgIGlzU1ZHID0gaXNTVkcgfHwgKG5leHRGbGFncyAmIDEyOCAvKiBTdmdFbGVtZW50ICovKSA+IDA7XHJcbiAgICAgICAgaWYgKGxhc3RDaGlsZHJlbiAhPT0gbmV4dENoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbklzU1ZHID0gaXNTVkcgPT09IHRydWUgJiYgbmV4dFZOb2RlLnR5cGUgIT09IFwiZm9yZWlnbk9iamVjdFwiO1xyXG4gICAgICAgICAgICBwYXRjaENoaWxkcmVuKGxhc3RGbGFncywgbmV4dEZsYWdzLCBsYXN0Q2hpbGRyZW4sIG5leHRDaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGNoaWxkcmVuSXNTVkcsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaW5saW5lZCBwYXRjaFByb3BzICAtLSBzdGFydHMgLS1cclxuICAgICAgICBpZiAobGFzdFByb3BzICE9PSBuZXh0UHJvcHMpIHtcclxuICAgICAgICAgICAgdmFyIGxhc3RQcm9wc09yRW1wdHkgPSBsYXN0UHJvcHMgfHwgRU1QVFlfT0JKO1xyXG4gICAgICAgICAgICB2YXIgbmV4dFByb3BzT3JFbXB0eSA9IG5leHRQcm9wcyB8fCBFTVBUWV9PQko7XHJcbiAgICAgICAgICAgIHZhciBoYXNDb250cm9sbGVkVmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKG5leHRQcm9wc09yRW1wdHkgIT09IEVNUFRZX09CSikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlzRm9ybUVsZW1lbnQgPSAobmV4dEZsYWdzICYgMzU4NCAvKiBGb3JtRWxlbWVudCAqLykgPiAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzRm9ybUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBoYXNDb250cm9sbGVkVmFsdWUgPSBpc0NvbnRyb2xsZWRGb3JtRWxlbWVudChuZXh0UHJvcHNPckVtcHR5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gbmV4dFByb3BzT3JFbXB0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdCBhZGQgYSBoYXNPd25Qcm9wZXJ0eSBjaGVjayBoZXJlLCBpdCBhZmZlY3RzIHBlcmZvcm1hbmNlXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRWYWx1ZSA9IG5leHRQcm9wc09yRW1wdHlbcHJvcF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RWYWx1ZSA9IGxhc3RQcm9wc09yRW1wdHlbcHJvcF07XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0Y2hQcm9wKHByb3AsIGxhc3RWYWx1ZSwgbmV4dFZhbHVlLCBkb20sIGlzU1ZHLCBoYXNDb250cm9sbGVkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGlzRm9ybUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIGluZmVybm8gaXMgcmVjeWNsaW5nIGZvcm0gZWxlbWVudCwgd2UgbmVlZCB0byBwcm9jZXNzIGl0IGxpa2UgaXQgd291bGQgYmUgbW91bnRpbmdcclxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRWxlbWVudChuZXh0RmxhZ3MsIG5leHRWTm9kZSwgZG9tLCBuZXh0UHJvcHNPckVtcHR5LCBpc1JlY3ljbGluZywgaGFzQ29udHJvbGxlZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobGFzdFByb3BzT3JFbXB0eSAhPT0gRU1QVFlfT0JKKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wJDEgaW4gbGFzdFByb3BzT3JFbXB0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdCBhZGQgYSBoYXNPd25Qcm9wZXJ0eSBjaGVjayBoZXJlLCBpdCBhZmZlY3RzIHBlcmZvcm1hbmNlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTnVsbE9yVW5kZWYobmV4dFByb3BzT3JFbXB0eVtwcm9wJDFdKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAhaXNOdWxsT3JVbmRlZihsYXN0UHJvcHNPckVtcHR5W3Byb3AkMV0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZVByb3AocHJvcCQxLCBsYXN0UHJvcHNPckVtcHR5W3Byb3AkMV0sIGRvbSwgbmV4dEZsYWdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaW5saW5lZCBwYXRjaFByb3BzICAtLSBlbmRzIC0tXHJcbiAgICAgICAgaWYgKGxhc3RDbGFzc05hbWUgIT09IG5leHRDbGFzc05hbWUpIHtcclxuICAgICAgICAgICAgaWYgKGlzTnVsbE9yVW5kZWYobmV4dENsYXNzTmFtZSkpIHtcclxuICAgICAgICAgICAgICAgIGRvbS5yZW1vdmVBdHRyaWJ1dGUoXCJjbGFzc1wiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1NWRykge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvbS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBuZXh0Q2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvbS5jbGFzc05hbWUgPSBuZXh0Q2xhc3NOYW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZXh0UmVmKSB7XHJcbiAgICAgICAgICAgIGlmIChsYXN0Vk5vZGUucmVmICE9PSBuZXh0UmVmIHx8IGlzUmVjeWNsaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBtb3VudFJlZihkb20sIG5leHRSZWYsIGxpZmVjeWNsZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcGF0Y2hDaGlsZHJlbihsYXN0RmxhZ3MsIG5leHRGbGFncywgbGFzdENoaWxkcmVuLCBuZXh0Q2hpbGRyZW4sIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNSZWN5Y2xpbmcpIHtcclxuICAgIHZhciBwYXRjaEFycmF5ID0gZmFsc2U7XHJcbiAgICB2YXIgcGF0Y2hLZXllZCA9IGZhbHNlO1xyXG4gICAgaWYgKG5leHRGbGFncyAmIDY0IC8qIEhhc05vbktleWVkQ2hpbGRyZW4gKi8pIHtcclxuICAgICAgICBwYXRjaEFycmF5ID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKChsYXN0RmxhZ3MgJiAzMiAvKiBIYXNLZXllZENoaWxkcmVuICovKSA+IDAgJiZcclxuICAgICAgICAobmV4dEZsYWdzICYgMzIgLyogSGFzS2V5ZWRDaGlsZHJlbiAqLykgPiAwKSB7XHJcbiAgICAgICAgcGF0Y2hLZXllZCA9IHRydWU7XHJcbiAgICAgICAgcGF0Y2hBcnJheSA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChpc0ludmFsaWQobmV4dENoaWxkcmVuKSkge1xyXG4gICAgICAgIHVubW91bnRDaGlsZHJlbihsYXN0Q2hpbGRyZW4sIGRvbSwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChpc0ludmFsaWQobGFzdENoaWxkcmVuKSkge1xyXG4gICAgICAgIGlmIChpc1N0cmluZ09yTnVtYmVyKG5leHRDaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgc2V0VGV4dENvbnRlbnQoZG9tLCBuZXh0Q2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGlzQXJyYXkobmV4dENoaWxkcmVuKSkge1xyXG4gICAgICAgICAgICAgICAgbW91bnRBcnJheUNoaWxkcmVuKG5leHRDaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG1vdW50KG5leHRDaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzU3RyaW5nT3JOdW1iZXIobmV4dENoaWxkcmVuKSkge1xyXG4gICAgICAgIGlmIChpc1N0cmluZ09yTnVtYmVyKGxhc3RDaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgdXBkYXRlVGV4dENvbnRlbnQoZG9tLCBuZXh0Q2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdW5tb3VudENoaWxkcmVuKGxhc3RDaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICAgICAgc2V0VGV4dENvbnRlbnQoZG9tLCBuZXh0Q2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzQXJyYXkobmV4dENoaWxkcmVuKSkge1xyXG4gICAgICAgIGlmIChpc0FycmF5KGxhc3RDaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgcGF0Y2hBcnJheSA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChpc0tleWVkKGxhc3RDaGlsZHJlbiwgbmV4dENoaWxkcmVuKSkge1xyXG4gICAgICAgICAgICAgICAgcGF0Y2hLZXllZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHVubW91bnRDaGlsZHJlbihsYXN0Q2hpbGRyZW4sIGRvbSwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgIG1vdW50QXJyYXlDaGlsZHJlbihuZXh0Q2hpbGRyZW4sIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoaXNBcnJheShsYXN0Q2hpbGRyZW4pKSB7XHJcbiAgICAgICAgcmVtb3ZlQWxsQ2hpbGRyZW4oZG9tLCBsYXN0Q2hpbGRyZW4sIGxpZmVjeWNsZSwgaXNSZWN5Y2xpbmcpO1xyXG4gICAgICAgIG1vdW50KG5leHRDaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzVk5vZGUobmV4dENoaWxkcmVuKSkge1xyXG4gICAgICAgIGlmIChpc1ZOb2RlKGxhc3RDaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgcGF0Y2gobGFzdENoaWxkcmVuLCBuZXh0Q2hpbGRyZW4sIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNSZWN5Y2xpbmcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdW5tb3VudENoaWxkcmVuKGxhc3RDaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICAgICAgbW91bnQobmV4dENoaWxkcmVuLCBkb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChwYXRjaEFycmF5KSB7XHJcbiAgICAgICAgaWYgKHBhdGNoS2V5ZWQpIHtcclxuICAgICAgICAgICAgcGF0Y2hLZXllZENoaWxkcmVuKGxhc3RDaGlsZHJlbiwgbmV4dENoaWxkcmVuLCBkb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHBhdGNoTm9uS2V5ZWRDaGlsZHJlbihsYXN0Q2hpbGRyZW4sIG5leHRDaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHBhdGNoQ29tcG9uZW50KGxhc3RWTm9kZSwgbmV4dFZOb2RlLCBwYXJlbnREb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcsIGlzQ2xhc3MsIGlzUmVjeWNsaW5nKSB7XHJcbiAgICB2YXIgbGFzdFR5cGUgPSBsYXN0Vk5vZGUudHlwZTtcclxuICAgIHZhciBuZXh0VHlwZSA9IG5leHRWTm9kZS50eXBlO1xyXG4gICAgdmFyIGxhc3RLZXkgPSBsYXN0Vk5vZGUua2V5O1xyXG4gICAgdmFyIG5leHRLZXkgPSBuZXh0Vk5vZGUua2V5O1xyXG4gICAgaWYgKGxhc3RUeXBlICE9PSBuZXh0VHlwZSB8fCBsYXN0S2V5ICE9PSBuZXh0S2V5KSB7XHJcbiAgICAgICAgcmVwbGFjZVdpdGhOZXdOb2RlKGxhc3RWTm9kZSwgbmV4dFZOb2RlLCBwYXJlbnREb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB2YXIgbmV4dFByb3BzID0gbmV4dFZOb2RlLnByb3BzIHx8IEVNUFRZX09CSjtcclxuICAgICAgICBpZiAoaXNDbGFzcykge1xyXG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSBsYXN0Vk5vZGUuY2hpbGRyZW47XHJcbiAgICAgICAgICAgIGluc3RhbmNlLl91cGRhdGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChpbnN0YW5jZS5fdW5tb3VudGVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOdWxsKHBhcmVudERvbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlcGxhY2VDaGlsZChwYXJlbnREb20sIG1vdW50Q29tcG9uZW50KG5leHRWTm9kZSwgbnVsbCwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgKG5leHRWTm9kZS5mbGFncyAmIDQgLyogQ29tcG9uZW50Q2xhc3MgKi8pID4gMCksIGxhc3RWTm9kZS5kb20pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGhhc0NvbXBvbmVudERpZFVwZGF0ZSA9ICFpc1VuZGVmaW5lZChpbnN0YW5jZS5jb21wb25lbnREaWRVcGRhdGUpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5leHRTdGF0ZSA9IGluc3RhbmNlLnN0YXRlO1xyXG4gICAgICAgICAgICAgICAgLy8gV2hlbiBjb21wb25lbnQgaGFzIGNvbXBvbmVudERpZFVwZGF0ZSBob29rLCB3ZSBuZWVkIHRvIGNsb25lIGxhc3RTdGF0ZSBvciB3aWxsIGJlIG1vZGlmaWVkIGJ5IHJlZmVyZW5jZSBkdXJpbmcgdXBkYXRlXHJcbiAgICAgICAgICAgICAgICB2YXIgbGFzdFN0YXRlID0gaGFzQ29tcG9uZW50RGlkVXBkYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgPyBjb21iaW5lRnJvbShuZXh0U3RhdGUsIG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgOiBuZXh0U3RhdGU7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGFzdFByb3BzID0gaW5zdGFuY2UucHJvcHM7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGRDb250ZXh0O1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmKGluc3RhbmNlLmdldENoaWxkQ29udGV4dCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZENvbnRleHQgPSBpbnN0YW5jZS5nZXRDaGlsZENvbnRleHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG5leHRWTm9kZS5jaGlsZHJlbiA9IGluc3RhbmNlO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuX2lzU1ZHID0gaXNTVkc7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOdWxsT3JVbmRlZihjaGlsZENvbnRleHQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRDb250ZXh0ID0gY29udGV4dDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkQ29udGV4dCA9IGNvbWJpbmVGcm9tKGNvbnRleHQsIGNoaWxkQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgbGFzdElucHV0ID0gaW5zdGFuY2UuX2xhc3RJbnB1dDtcclxuICAgICAgICAgICAgICAgIHZhciBuZXh0SW5wdXQgPSBpbnN0YW5jZS5fdXBkYXRlQ29tcG9uZW50KGxhc3RTdGF0ZSwgbmV4dFN0YXRlLCBsYXN0UHJvcHMsIG5leHRQcm9wcywgY29udGV4dCwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHZhciBkaWRVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuX2NoaWxkQ29udGV4dCA9IGNoaWxkQ29udGV4dDtcclxuICAgICAgICAgICAgICAgIGlmIChpc0ludmFsaWQobmV4dElucHV0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRJbnB1dCA9IGNyZWF0ZVZvaWRWTm9kZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobmV4dElucHV0ID09PSBOT19PUCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRJbnB1dCA9IGxhc3RJbnB1dDtcclxuICAgICAgICAgICAgICAgICAgICBkaWRVcGRhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzU3RyaW5nT3JOdW1iZXIobmV4dElucHV0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRJbnB1dCA9IGNyZWF0ZVRleHRWTm9kZShuZXh0SW5wdXQsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNBcnJheShuZXh0SW5wdXQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKFwiYSB2YWxpZCBJbmZlcm5vIFZOb2RlIChvciBudWxsKSBtdXN0IGJlIHJldHVybmVkIGZyb20gYSBjb21wb25lbnQgcmVuZGVyLiBZb3UgbWF5IGhhdmUgcmV0dXJuZWQgYW4gYXJyYXkgb3IgYW4gaW52YWxpZCBvYmplY3QuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChpc09iamVjdChuZXh0SW5wdXQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc051bGwobmV4dElucHV0LmRvbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dElucHV0ID0gZGlyZWN0Q2xvbmUobmV4dElucHV0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dElucHV0LmZsYWdzICYgMjggLyogQ29tcG9uZW50ICovKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dElucHV0LnBhcmVudFZOb2RlID0gbmV4dFZOb2RlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobGFzdElucHV0LmZsYWdzICYgMjggLyogQ29tcG9uZW50ICovKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFzdElucHV0LnBhcmVudFZOb2RlID0gbmV4dFZOb2RlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuX2xhc3RJbnB1dCA9IG5leHRJbnB1dDtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLl92Tm9kZSA9IG5leHRWTm9kZTtcclxuICAgICAgICAgICAgICAgIGlmIChkaWRVcGRhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXRjaChsYXN0SW5wdXQsIG5leHRJbnB1dCwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNoaWxkQ29udGV4dCwgaXNTVkcsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ29tcG9uZW50RGlkVXBkYXRlICYmIGluc3RhbmNlLmNvbXBvbmVudERpZFVwZGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5jb21wb25lbnREaWRVcGRhdGUobGFzdFByb3BzLCBsYXN0U3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTnVsbChvcHRpb25zLmFmdGVyVXBkYXRlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFmdGVyVXBkYXRlKG5leHRWTm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmZpbmRET01Ob2RlRW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRUb0RPTU5vZGVNYXAuc2V0KGluc3RhbmNlLCBuZXh0SW5wdXQuZG9tKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBuZXh0Vk5vZGUuZG9tID0gbmV4dElucHV0LmRvbTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnN0YW5jZS5fdXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBzaG91bGRVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB2YXIgbGFzdFByb3BzJDEgPSBsYXN0Vk5vZGUucHJvcHM7XHJcbiAgICAgICAgICAgIHZhciBuZXh0SG9va3MgPSBuZXh0Vk5vZGUucmVmO1xyXG4gICAgICAgICAgICB2YXIgbmV4dEhvb2tzRGVmaW5lZCA9ICFpc051bGxPclVuZGVmKG5leHRIb29rcyk7XHJcbiAgICAgICAgICAgIHZhciBsYXN0SW5wdXQkMSA9IGxhc3RWTm9kZS5jaGlsZHJlbjtcclxuICAgICAgICAgICAgdmFyIG5leHRJbnB1dCQxID0gbGFzdElucHV0JDE7XHJcbiAgICAgICAgICAgIG5leHRWTm9kZS5kb20gPSBsYXN0Vk5vZGUuZG9tO1xyXG4gICAgICAgICAgICBuZXh0Vk5vZGUuY2hpbGRyZW4gPSBsYXN0SW5wdXQkMTtcclxuICAgICAgICAgICAgaWYgKGxhc3RLZXkgIT09IG5leHRLZXkpIHtcclxuICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dEhvb2tzRGVmaW5lZCAmJlxyXG4gICAgICAgICAgICAgICAgICAgICFpc051bGxPclVuZGVmKG5leHRIb29rcy5vbkNvbXBvbmVudFNob3VsZFVwZGF0ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaG91bGRVcGRhdGUgPSBuZXh0SG9va3Mub25Db21wb25lbnRTaG91bGRVcGRhdGUobGFzdFByb3BzJDEsIG5leHRQcm9wcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNob3VsZFVwZGF0ZSAhPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0SG9va3NEZWZpbmVkICYmXHJcbiAgICAgICAgICAgICAgICAgICAgIWlzTnVsbE9yVW5kZWYobmV4dEhvb2tzLm9uQ29tcG9uZW50V2lsbFVwZGF0ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0SG9va3Mub25Db21wb25lbnRXaWxsVXBkYXRlKGxhc3RQcm9wcyQxLCBuZXh0UHJvcHMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbmV4dElucHV0JDEgPSBuZXh0VHlwZShuZXh0UHJvcHMsIGNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzSW52YWxpZChuZXh0SW5wdXQkMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0SW5wdXQkMSA9IGNyZWF0ZVZvaWRWTm9kZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNTdHJpbmdPck51bWJlcihuZXh0SW5wdXQkMSkgJiYgbmV4dElucHV0JDEgIT09IE5PX09QKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dElucHV0JDEgPSBjcmVhdGVUZXh0Vk5vZGUobmV4dElucHV0JDEsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNBcnJheShuZXh0SW5wdXQkMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoXCJhIHZhbGlkIEluZmVybm8gVk5vZGUgKG9yIG51bGwpIG11c3QgYmUgcmV0dXJuZWQgZnJvbSBhIGNvbXBvbmVudCByZW5kZXIuIFlvdSBtYXkgaGF2ZSByZXR1cm5lZCBhbiBhcnJheSBvciBhbiBpbnZhbGlkIG9iamVjdC5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzT2JqZWN0KG5leHRJbnB1dCQxKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNOdWxsKG5leHRJbnB1dCQxLmRvbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dElucHV0JDEgPSBkaXJlY3RDbG9uZShuZXh0SW5wdXQkMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG5leHRJbnB1dCQxICE9PSBOT19PUCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGNoKGxhc3RJbnB1dCQxLCBuZXh0SW5wdXQkMSwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFZOb2RlLmNoaWxkcmVuID0gbmV4dElucHV0JDE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRIb29rc0RlZmluZWQgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgIWlzTnVsbE9yVW5kZWYobmV4dEhvb2tzLm9uQ29tcG9uZW50RGlkVXBkYXRlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0SG9va3Mub25Db21wb25lbnREaWRVcGRhdGUobGFzdFByb3BzJDEsIG5leHRQcm9wcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG5leHRWTm9kZS5kb20gPSBuZXh0SW5wdXQkMS5kb207XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5leHRJbnB1dCQxLmZsYWdzICYgMjggLyogQ29tcG9uZW50ICovKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0SW5wdXQkMS5wYXJlbnRWTm9kZSA9IG5leHRWTm9kZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChsYXN0SW5wdXQkMS5mbGFncyAmIDI4IC8qIENvbXBvbmVudCAqLykge1xyXG4gICAgICAgICAgICAgICAgbGFzdElucHV0JDEucGFyZW50Vk5vZGUgPSBuZXh0Vk5vZGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuZnVuY3Rpb24gcGF0Y2hUZXh0KGxhc3RWTm9kZSwgbmV4dFZOb2RlKSB7XHJcbiAgICB2YXIgbmV4dFRleHQgPSBuZXh0Vk5vZGUuY2hpbGRyZW47XHJcbiAgICB2YXIgZG9tID0gbGFzdFZOb2RlLmRvbTtcclxuICAgIG5leHRWTm9kZS5kb20gPSBkb207XHJcbiAgICBpZiAobGFzdFZOb2RlLmNoaWxkcmVuICE9PSBuZXh0VGV4dCkge1xyXG4gICAgICAgIGRvbS5ub2RlVmFsdWUgPSBuZXh0VGV4dDtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBwYXRjaFZvaWQobGFzdFZOb2RlLCBuZXh0Vk5vZGUpIHtcclxuICAgIG5leHRWTm9kZS5kb20gPSBsYXN0Vk5vZGUuZG9tO1xyXG59XHJcbmZ1bmN0aW9uIHBhdGNoTm9uS2V5ZWRDaGlsZHJlbihsYXN0Q2hpbGRyZW4sIG5leHRDaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZykge1xyXG4gICAgdmFyIGxhc3RDaGlsZHJlbkxlbmd0aCA9IGxhc3RDaGlsZHJlbi5sZW5ndGg7XHJcbiAgICB2YXIgbmV4dENoaWxkcmVuTGVuZ3RoID0gbmV4dENoaWxkcmVuLmxlbmd0aDtcclxuICAgIHZhciBjb21tb25MZW5ndGggPSBsYXN0Q2hpbGRyZW5MZW5ndGggPiBuZXh0Q2hpbGRyZW5MZW5ndGhcclxuICAgICAgICA/IG5leHRDaGlsZHJlbkxlbmd0aFxyXG4gICAgICAgIDogbGFzdENoaWxkcmVuTGVuZ3RoO1xyXG4gICAgdmFyIGkgPSAwO1xyXG4gICAgZm9yICg7IGkgPCBjb21tb25MZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhciBuZXh0Q2hpbGQgPSBuZXh0Q2hpbGRyZW5baV07XHJcbiAgICAgICAgaWYgKG5leHRDaGlsZC5kb20pIHtcclxuICAgICAgICAgICAgbmV4dENoaWxkID0gbmV4dENoaWxkcmVuW2ldID0gZGlyZWN0Q2xvbmUobmV4dENoaWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGF0Y2gobGFzdENoaWxkcmVuW2ldLCBuZXh0Q2hpbGQsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNSZWN5Y2xpbmcpO1xyXG4gICAgfVxyXG4gICAgaWYgKGxhc3RDaGlsZHJlbkxlbmd0aCA8IG5leHRDaGlsZHJlbkxlbmd0aCkge1xyXG4gICAgICAgIGZvciAoaSA9IGNvbW1vbkxlbmd0aDsgaSA8IG5leHRDaGlsZHJlbkxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBuZXh0Q2hpbGQkMSA9IG5leHRDaGlsZHJlbltpXTtcclxuICAgICAgICAgICAgaWYgKG5leHRDaGlsZCQxLmRvbSkge1xyXG4gICAgICAgICAgICAgICAgbmV4dENoaWxkJDEgPSBuZXh0Q2hpbGRyZW5baV0gPSBkaXJlY3RDbG9uZShuZXh0Q2hpbGQkMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXBwZW5kQ2hpbGQoZG9tLCBtb3VudChuZXh0Q2hpbGQkMSwgbnVsbCwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRykpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKG5leHRDaGlsZHJlbkxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJlbW92ZUFsbENoaWxkcmVuKGRvbSwgbGFzdENoaWxkcmVuLCBsaWZlY3ljbGUsIGlzUmVjeWNsaW5nKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGxhc3RDaGlsZHJlbkxlbmd0aCA+IG5leHRDaGlsZHJlbkxlbmd0aCkge1xyXG4gICAgICAgIGZvciAoaSA9IGNvbW1vbkxlbmd0aDsgaSA8IGxhc3RDaGlsZHJlbkxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHVubW91bnQobGFzdENoaWxkcmVuW2ldLCBkb20sIGxpZmVjeWNsZSwgZmFsc2UsIGlzUmVjeWNsaW5nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcGF0Y2hLZXllZENoaWxkcmVuKGEsIGIsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNSZWN5Y2xpbmcpIHtcclxuICAgIHZhciBhTGVuZ3RoID0gYS5sZW5ndGg7XHJcbiAgICB2YXIgYkxlbmd0aCA9IGIubGVuZ3RoO1xyXG4gICAgdmFyIGFFbmQgPSBhTGVuZ3RoIC0gMTtcclxuICAgIHZhciBiRW5kID0gYkxlbmd0aCAtIDE7XHJcbiAgICB2YXIgYVN0YXJ0ID0gMDtcclxuICAgIHZhciBiU3RhcnQgPSAwO1xyXG4gICAgdmFyIGk7XHJcbiAgICB2YXIgajtcclxuICAgIHZhciBhTm9kZTtcclxuICAgIHZhciBiTm9kZTtcclxuICAgIHZhciBuZXh0Tm9kZTtcclxuICAgIHZhciBuZXh0UG9zO1xyXG4gICAgdmFyIG5vZGU7XHJcbiAgICBpZiAoYUxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGlmIChiTGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBtb3VudEFycmF5Q2hpbGRyZW4oYiwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoYkxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJlbW92ZUFsbENoaWxkcmVuKGRvbSwgYSwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGFTdGFydE5vZGUgPSBhW2FTdGFydF07XHJcbiAgICB2YXIgYlN0YXJ0Tm9kZSA9IGJbYlN0YXJ0XTtcclxuICAgIHZhciBhRW5kTm9kZSA9IGFbYUVuZF07XHJcbiAgICB2YXIgYkVuZE5vZGUgPSBiW2JFbmRdO1xyXG4gICAgaWYgKGJTdGFydE5vZGUuZG9tKSB7XHJcbiAgICAgICAgYltiU3RhcnRdID0gYlN0YXJ0Tm9kZSA9IGRpcmVjdENsb25lKGJTdGFydE5vZGUpO1xyXG4gICAgfVxyXG4gICAgaWYgKGJFbmROb2RlLmRvbSkge1xyXG4gICAgICAgIGJbYkVuZF0gPSBiRW5kTm9kZSA9IGRpcmVjdENsb25lKGJFbmROb2RlKTtcclxuICAgIH1cclxuICAgIC8vIFN0ZXAgMVxyXG4gICAgLyogZXNsaW50IG5vLWNvbnN0YW50LWNvbmRpdGlvbjogMCAqL1xyXG4gICAgb3V0ZXI6IHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgLy8gU3luYyBub2RlcyB3aXRoIHRoZSBzYW1lIGtleSBhdCB0aGUgYmVnaW5uaW5nLlxyXG4gICAgICAgIHdoaWxlIChhU3RhcnROb2RlLmtleSA9PT0gYlN0YXJ0Tm9kZS5rZXkpIHtcclxuICAgICAgICAgICAgcGF0Y2goYVN0YXJ0Tm9kZSwgYlN0YXJ0Tm9kZSwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgIGFTdGFydCsrO1xyXG4gICAgICAgICAgICBiU3RhcnQrKztcclxuICAgICAgICAgICAgaWYgKGFTdGFydCA+IGFFbmQgfHwgYlN0YXJ0ID4gYkVuZCkge1xyXG4gICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYVN0YXJ0Tm9kZSA9IGFbYVN0YXJ0XTtcclxuICAgICAgICAgICAgYlN0YXJ0Tm9kZSA9IGJbYlN0YXJ0XTtcclxuICAgICAgICAgICAgaWYgKGJTdGFydE5vZGUuZG9tKSB7XHJcbiAgICAgICAgICAgICAgICBiW2JTdGFydF0gPSBiU3RhcnROb2RlID0gZGlyZWN0Q2xvbmUoYlN0YXJ0Tm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU3luYyBub2RlcyB3aXRoIHRoZSBzYW1lIGtleSBhdCB0aGUgZW5kLlxyXG4gICAgICAgIHdoaWxlIChhRW5kTm9kZS5rZXkgPT09IGJFbmROb2RlLmtleSkge1xyXG4gICAgICAgICAgICBwYXRjaChhRW5kTm9kZSwgYkVuZE5vZGUsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNSZWN5Y2xpbmcpO1xyXG4gICAgICAgICAgICBhRW5kLS07XHJcbiAgICAgICAgICAgIGJFbmQtLTtcclxuICAgICAgICAgICAgaWYgKGFTdGFydCA+IGFFbmQgfHwgYlN0YXJ0ID4gYkVuZCkge1xyXG4gICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYUVuZE5vZGUgPSBhW2FFbmRdO1xyXG4gICAgICAgICAgICBiRW5kTm9kZSA9IGJbYkVuZF07XHJcbiAgICAgICAgICAgIGlmIChiRW5kTm9kZS5kb20pIHtcclxuICAgICAgICAgICAgICAgIGJbYkVuZF0gPSBiRW5kTm9kZSA9IGRpcmVjdENsb25lKGJFbmROb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBNb3ZlIGFuZCBzeW5jIG5vZGVzIGZyb20gcmlnaHQgdG8gbGVmdC5cclxuICAgICAgICBpZiAoYUVuZE5vZGUua2V5ID09PSBiU3RhcnROb2RlLmtleSkge1xyXG4gICAgICAgICAgICBwYXRjaChhRW5kTm9kZSwgYlN0YXJ0Tm9kZSwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgIGluc2VydE9yQXBwZW5kKGRvbSwgYlN0YXJ0Tm9kZS5kb20sIGFTdGFydE5vZGUuZG9tKTtcclxuICAgICAgICAgICAgYUVuZC0tO1xyXG4gICAgICAgICAgICBiU3RhcnQrKztcclxuICAgICAgICAgICAgYUVuZE5vZGUgPSBhW2FFbmRdO1xyXG4gICAgICAgICAgICBiU3RhcnROb2RlID0gYltiU3RhcnRdO1xyXG4gICAgICAgICAgICBpZiAoYlN0YXJ0Tm9kZS5kb20pIHtcclxuICAgICAgICAgICAgICAgIGJbYlN0YXJ0XSA9IGJTdGFydE5vZGUgPSBkaXJlY3RDbG9uZShiU3RhcnROb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gTW92ZSBhbmQgc3luYyBub2RlcyBmcm9tIGxlZnQgdG8gcmlnaHQuXHJcbiAgICAgICAgaWYgKGFTdGFydE5vZGUua2V5ID09PSBiRW5kTm9kZS5rZXkpIHtcclxuICAgICAgICAgICAgcGF0Y2goYVN0YXJ0Tm9kZSwgYkVuZE5vZGUsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNSZWN5Y2xpbmcpO1xyXG4gICAgICAgICAgICBuZXh0UG9zID0gYkVuZCArIDE7XHJcbiAgICAgICAgICAgIG5leHROb2RlID0gbmV4dFBvcyA8IGIubGVuZ3RoID8gYltuZXh0UG9zXS5kb20gOiBudWxsO1xyXG4gICAgICAgICAgICBpbnNlcnRPckFwcGVuZChkb20sIGJFbmROb2RlLmRvbSwgbmV4dE5vZGUpO1xyXG4gICAgICAgICAgICBhU3RhcnQrKztcclxuICAgICAgICAgICAgYkVuZC0tO1xyXG4gICAgICAgICAgICBhU3RhcnROb2RlID0gYVthU3RhcnRdO1xyXG4gICAgICAgICAgICBiRW5kTm9kZSA9IGJbYkVuZF07XHJcbiAgICAgICAgICAgIGlmIChiRW5kTm9kZS5kb20pIHtcclxuICAgICAgICAgICAgICAgIGJbYkVuZF0gPSBiRW5kTm9kZSA9IGRpcmVjdENsb25lKGJFbmROb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICBpZiAoYVN0YXJ0ID4gYUVuZCkge1xyXG4gICAgICAgIGlmIChiU3RhcnQgPD0gYkVuZCkge1xyXG4gICAgICAgICAgICBuZXh0UG9zID0gYkVuZCArIDE7XHJcbiAgICAgICAgICAgIG5leHROb2RlID0gbmV4dFBvcyA8IGIubGVuZ3RoID8gYltuZXh0UG9zXS5kb20gOiBudWxsO1xyXG4gICAgICAgICAgICB3aGlsZSAoYlN0YXJ0IDw9IGJFbmQpIHtcclxuICAgICAgICAgICAgICAgIG5vZGUgPSBiW2JTdGFydF07XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5kb20pIHtcclxuICAgICAgICAgICAgICAgICAgICBiW2JTdGFydF0gPSBub2RlID0gZGlyZWN0Q2xvbmUobm9kZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBiU3RhcnQrKztcclxuICAgICAgICAgICAgICAgIGluc2VydE9yQXBwZW5kKGRvbSwgbW91bnQobm9kZSwgbnVsbCwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRyksIG5leHROb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGJTdGFydCA+IGJFbmQpIHtcclxuICAgICAgICB3aGlsZSAoYVN0YXJ0IDw9IGFFbmQpIHtcclxuICAgICAgICAgICAgdW5tb3VudChhW2FTdGFydCsrXSwgZG9tLCBsaWZlY3ljbGUsIGZhbHNlLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgYUxlbmd0aCA9IGFFbmQgLSBhU3RhcnQgKyAxO1xyXG4gICAgICAgIGJMZW5ndGggPSBiRW5kIC0gYlN0YXJ0ICsgMTtcclxuICAgICAgICB2YXIgc291cmNlcyA9IG5ldyBBcnJheShiTGVuZ3RoKTtcclxuICAgICAgICAvLyBNYXJrIGFsbCBub2RlcyBhcyBpbnNlcnRlZC5cclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYkxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHNvdXJjZXNbaV0gPSAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG1vdmVkID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIHBvcyA9IDA7XHJcbiAgICAgICAgdmFyIHBhdGNoZWQgPSAwO1xyXG4gICAgICAgIC8vIFdoZW4gc2l6ZXMgYXJlIHNtYWxsLCBqdXN0IGxvb3AgdGhlbSB0aHJvdWdoXHJcbiAgICAgICAgaWYgKGJMZW5ndGggPD0gNCB8fCBhTGVuZ3RoICogYkxlbmd0aCA8PSAxNikge1xyXG4gICAgICAgICAgICBmb3IgKGkgPSBhU3RhcnQ7IGkgPD0gYUVuZDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBhTm9kZSA9IGFbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAocGF0Y2hlZCA8IGJMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSBiU3RhcnQ7IGogPD0gYkVuZDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJOb2RlID0gYltqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFOb2RlLmtleSA9PT0gYk5vZGUua2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2ogLSBiU3RhcnRdID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3MgPiBqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gajtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiTm9kZS5kb20pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiW2pdID0gYk5vZGUgPSBkaXJlY3RDbG9uZShiTm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRjaChhTm9kZSwgYk5vZGUsIGRvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNSZWN5Y2xpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0Y2hlZCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYVtpXSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGtleUluZGV4ID0gbmV3IE1hcCgpO1xyXG4gICAgICAgICAgICAvLyBNYXAga2V5cyBieSB0aGVpciBpbmRleCBpbiBhcnJheVxyXG4gICAgICAgICAgICBmb3IgKGkgPSBiU3RhcnQ7IGkgPD0gYkVuZDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBrZXlJbmRleC5zZXQoYltpXS5rZXksIGkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFRyeSB0byBwYXRjaCBzYW1lIGtleXNcclxuICAgICAgICAgICAgZm9yIChpID0gYVN0YXJ0OyBpIDw9IGFFbmQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgYU5vZGUgPSBhW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhdGNoZWQgPCBiTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaiA9IGtleUluZGV4LmdldChhTm9kZS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNVbmRlZmluZWQoaikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYk5vZGUgPSBiW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VzW2ogLSBiU3RhcnRdID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvcyA+IGopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IGo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJOb2RlLmRvbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYltqXSA9IGJOb2RlID0gZGlyZWN0Q2xvbmUoYk5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGNoKGFOb2RlLCBiTm9kZSwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGNoZWQrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYVtpXSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGZhc3QtcGF0aDogaWYgbm90aGluZyBwYXRjaGVkIHJlbW92ZSBhbGwgb2xkIGFuZCBhZGQgYWxsIG5ld1xyXG4gICAgICAgIGlmIChhTGVuZ3RoID09PSBhLmxlbmd0aCAmJiBwYXRjaGVkID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJlbW92ZUFsbENoaWxkcmVuKGRvbSwgYSwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgICAgIHdoaWxlIChiU3RhcnQgPCBiTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlID0gYltiU3RhcnRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuZG9tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYltiU3RhcnRdID0gbm9kZSA9IGRpcmVjdENsb25lKG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYlN0YXJ0Kys7XHJcbiAgICAgICAgICAgICAgICBpbnNlcnRPckFwcGVuZChkb20sIG1vdW50KG5vZGUsIG51bGwsIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcpLCBudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaSA9IGFMZW5ndGggLSBwYXRjaGVkO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA+IDApIHtcclxuICAgICAgICAgICAgICAgIGFOb2RlID0gYVthU3RhcnQrK107XHJcbiAgICAgICAgICAgICAgICBpZiAoIWlzTnVsbChhTm9kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB1bm1vdW50KGFOb2RlLCBkb20sIGxpZmVjeWNsZSwgdHJ1ZSwgaXNSZWN5Y2xpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobW92ZWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZXEgPSBsaXNfYWxnb3JpdGhtKHNvdXJjZXMpO1xyXG4gICAgICAgICAgICAgICAgaiA9IHNlcS5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gYkxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbaV0gPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IGkgKyBiU3RhcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBiW3Bvc107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRvbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYltwb3NdID0gbm9kZSA9IGRpcmVjdENsb25lKG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRQb3MgPSBwb3MgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0Tm9kZSA9IG5leHRQb3MgPCBiLmxlbmd0aCA/IGJbbmV4dFBvc10uZG9tIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0T3JBcHBlbmQoZG9tLCBtb3VudChub2RlLCBudWxsLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSwgbmV4dE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogPCAwIHx8IGkgIT09IHNlcVtqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gaSArIGJTdGFydDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBiW3Bvc107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0UG9zID0gcG9zICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHROb2RlID0gbmV4dFBvcyA8IGIubGVuZ3RoID8gYltuZXh0UG9zXS5kb20gOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0T3JBcHBlbmQoZG9tLCBub2RlLmRvbSwgbmV4dE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgai0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHBhdGNoZWQgIT09IGJMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIC8vIHdoZW4gcGF0Y2hlZCBjb3VudCBkb2Vzbid0IG1hdGNoIGIgbGVuZ3RoIHdlIG5lZWQgdG8gaW5zZXJ0IHRob3NlIG5ldyBvbmVzXHJcbiAgICAgICAgICAgICAgICAvLyBsb29wIGJhY2t3YXJkcyBzbyB3ZSBjYW4gdXNlIGluc2VydEJlZm9yZVxyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gYkxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZXNbaV0gPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IGkgKyBiU3RhcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBiW3Bvc107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRvbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYltwb3NdID0gbm9kZSA9IGRpcmVjdENsb25lKG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRQb3MgPSBwb3MgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0Tm9kZSA9IG5leHRQb3MgPCBiLmxlbmd0aCA/IGJbbmV4dFBvc10uZG9tIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0T3JBcHBlbmQoZG9tLCBtb3VudChub2RlLCBudWxsLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSwgbmV4dE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vLyAvLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Mb25nZXN0X2luY3JlYXNpbmdfc3Vic2VxdWVuY2VcclxuZnVuY3Rpb24gbGlzX2FsZ29yaXRobShhcnIpIHtcclxuICAgIHZhciBwID0gYXJyLnNsaWNlKDApO1xyXG4gICAgdmFyIHJlc3VsdCA9IFswXTtcclxuICAgIHZhciBpO1xyXG4gICAgdmFyIGo7XHJcbiAgICB2YXIgdTtcclxuICAgIHZhciB2O1xyXG4gICAgdmFyIGM7XHJcbiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDtcclxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgIHZhciBhcnJJID0gYXJyW2ldO1xyXG4gICAgICAgIGlmIChhcnJJID09PSAtMSkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaiA9IHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgaWYgKGFycltqXSA8IGFyckkpIHtcclxuICAgICAgICAgICAgcFtpXSA9IGo7XHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGkpO1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdSA9IDA7XHJcbiAgICAgICAgdiA9IHJlc3VsdC5sZW5ndGggLSAxO1xyXG4gICAgICAgIHdoaWxlICh1IDwgdikge1xyXG4gICAgICAgICAgICBjID0gKCh1ICsgdikgLyAyKSB8IDA7XHJcbiAgICAgICAgICAgIGlmIChhcnJbcmVzdWx0W2NdXSA8IGFyckkpIHtcclxuICAgICAgICAgICAgICAgIHUgPSBjICsgMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHYgPSBjO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhcnJJIDwgYXJyW3Jlc3VsdFt1XV0pIHtcclxuICAgICAgICAgICAgaWYgKHUgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBwW2ldID0gcmVzdWx0W3UgLSAxXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXN1bHRbdV0gPSBpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHUgPSByZXN1bHQubGVuZ3RoO1xyXG4gICAgdiA9IHJlc3VsdFt1IC0gMV07XHJcbiAgICB3aGlsZSAodS0tID4gMCkge1xyXG4gICAgICAgIHJlc3VsdFt1XSA9IHY7XHJcbiAgICAgICAgdiA9IHBbdl07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcbmZ1bmN0aW9uIGlzQXR0ckFuRXZlbnQoYXR0cikge1xyXG4gICAgcmV0dXJuIGF0dHJbMF0gPT09IFwib1wiICYmIGF0dHJbMV0gPT09IFwiblwiO1xyXG59XHJcbmZ1bmN0aW9uIHBhdGNoUHJvcChwcm9wLCBsYXN0VmFsdWUsIG5leHRWYWx1ZSwgZG9tLCBpc1NWRywgaGFzQ29udHJvbGxlZFZhbHVlKSB7XHJcbiAgICBpZiAobGFzdFZhbHVlICE9PSBuZXh0VmFsdWUpIHtcclxuICAgICAgICBpZiAoc2tpcFByb3BzLmhhcyhwcm9wKSB8fCAoaGFzQ29udHJvbGxlZFZhbHVlICYmIHByb3AgPT09IFwidmFsdWVcIikpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChib29sZWFuUHJvcHMuaGFzKHByb3ApKSB7XHJcbiAgICAgICAgICAgIHByb3AgPSBwcm9wID09PSBcImF1dG9Gb2N1c1wiID8gcHJvcC50b0xvd2VyQ2FzZSgpIDogcHJvcDtcclxuICAgICAgICAgICAgZG9tW3Byb3BdID0gISFuZXh0VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHN0cmljdFByb3BzLmhhcyhwcm9wKSkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBpc051bGxPclVuZGVmKG5leHRWYWx1ZSkgPyBcIlwiIDogbmV4dFZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoZG9tW3Byb3BdICE9PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgZG9tW3Byb3BdID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoaXNBdHRyQW5FdmVudChwcm9wKSkge1xyXG4gICAgICAgICAgICBwYXRjaEV2ZW50KHByb3AsIGxhc3RWYWx1ZSwgbmV4dFZhbHVlLCBkb20pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChpc051bGxPclVuZGVmKG5leHRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgZG9tLnJlbW92ZUF0dHJpYnV0ZShwcm9wKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocHJvcCA9PT0gXCJzdHlsZVwiKSB7XHJcbiAgICAgICAgICAgIHBhdGNoU3R5bGUobGFzdFZhbHVlLCBuZXh0VmFsdWUsIGRvbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHByb3AgPT09IFwiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUxcIikge1xyXG4gICAgICAgICAgICB2YXIgbGFzdEh0bWwgPSBsYXN0VmFsdWUgJiYgbGFzdFZhbHVlLl9faHRtbDtcclxuICAgICAgICAgICAgdmFyIG5leHRIdG1sID0gbmV4dFZhbHVlICYmIG5leHRWYWx1ZS5fX2h0bWw7XHJcbiAgICAgICAgICAgIGlmIChsYXN0SHRtbCAhPT0gbmV4dEh0bWwpIHtcclxuICAgICAgICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZihuZXh0SHRtbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb20uaW5uZXJIVE1MID0gbmV4dEh0bWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFdlIG9wdGltaXplIGZvciBOUyBiZWluZyBib29sZWFuLiBJdHMgOTkuOSUgdGltZSBmYWxzZVxyXG4gICAgICAgICAgICBpZiAoaXNTVkcgJiYgbmFtZXNwYWNlcy5oYXMocHJvcCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIHdlIGVuZCB1cCBpbiB0aGlzIHBhdGggd2UgY2FuIHJlYWQgcHJvcGVydHkgYWdhaW5cclxuICAgICAgICAgICAgICAgIGRvbS5zZXRBdHRyaWJ1dGVOUyhuYW1lc3BhY2VzLmdldChwcm9wKSwgcHJvcCwgbmV4dFZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRvbS5zZXRBdHRyaWJ1dGUocHJvcCwgbmV4dFZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBwYXRjaEV2ZW50KG5hbWUsIGxhc3RWYWx1ZSwgbmV4dFZhbHVlLCBkb20pIHtcclxuICAgIGlmIChsYXN0VmFsdWUgIT09IG5leHRWYWx1ZSkge1xyXG4gICAgICAgIGlmIChkZWxlZ2F0ZWRFdmVudHMuaGFzKG5hbWUpKSB7XHJcbiAgICAgICAgICAgIGhhbmRsZUV2ZW50KG5hbWUsIGxhc3RWYWx1ZSwgbmV4dFZhbHVlLCBkb20pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIG5hbWVMb3dlckNhc2UgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIHZhciBkb21FdmVudCA9IGRvbVtuYW1lTG93ZXJDYXNlXTtcclxuICAgICAgICAgICAgLy8gaWYgdGhlIGZ1bmN0aW9uIGlzIHdyYXBwZWQsIHRoYXQgbWVhbnMgaXQncyBiZWVuIGNvbnRyb2xsZWQgYnkgYSB3cmFwcGVyXHJcbiAgICAgICAgICAgIGlmIChkb21FdmVudCAmJiBkb21FdmVudC53cmFwcGVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFpc0Z1bmN0aW9uKG5leHRWYWx1ZSkgJiYgIWlzTnVsbE9yVW5kZWYobmV4dFZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxpbmtFdmVudCA9IG5leHRWYWx1ZS5ldmVudDtcclxuICAgICAgICAgICAgICAgIGlmIChsaW5rRXZlbnQgJiYgaXNGdW5jdGlvbihsaW5rRXZlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9tW25hbWVMb3dlckNhc2VdID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlua0V2ZW50KG5leHRWYWx1ZS5kYXRhLCBlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKChcImFuIGV2ZW50IG9uIGEgVk5vZGUgXFxcIlwiICsgbmFtZSArIFwiXFxcIi4gd2FzIG5vdCBhIGZ1bmN0aW9uIG9yIGEgdmFsaWQgbGlua0V2ZW50LlwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRvbVtuYW1lTG93ZXJDYXNlXSA9IG5leHRWYWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vLyBXZSBhcmUgYXNzdW1pbmcgaGVyZSB0aGF0IHdlIGNvbWUgZnJvbSBwYXRjaFByb3Agcm91dGluZVxyXG4vLyAtbmV4dEF0dHJWYWx1ZSBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWRcclxuZnVuY3Rpb24gcGF0Y2hTdHlsZShsYXN0QXR0clZhbHVlLCBuZXh0QXR0clZhbHVlLCBkb20pIHtcclxuICAgIHZhciBkb21TdHlsZSA9IGRvbS5zdHlsZTtcclxuICAgIHZhciBzdHlsZTtcclxuICAgIHZhciB2YWx1ZTtcclxuICAgIGlmIChpc1N0cmluZyhuZXh0QXR0clZhbHVlKSkge1xyXG4gICAgICAgIGRvbVN0eWxlLmNzc1RleHQgPSBuZXh0QXR0clZhbHVlO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghaXNOdWxsT3JVbmRlZihsYXN0QXR0clZhbHVlKSAmJiAhaXNTdHJpbmcobGFzdEF0dHJWYWx1ZSkpIHtcclxuICAgICAgICBmb3IgKHN0eWxlIGluIG5leHRBdHRyVmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gZG8gbm90IGFkZCBhIGhhc093blByb3BlcnR5IGNoZWNrIGhlcmUsIGl0IGFmZmVjdHMgcGVyZm9ybWFuY2VcclxuICAgICAgICAgICAgdmFsdWUgPSBuZXh0QXR0clZhbHVlW3N0eWxlXTtcclxuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSBsYXN0QXR0clZhbHVlW3N0eWxlXSkge1xyXG4gICAgICAgICAgICAgICAgZG9tU3R5bGVbc3R5bGVdID1cclxuICAgICAgICAgICAgICAgICAgICAhaXNOdW1iZXIodmFsdWUpIHx8IGlzVW5pdGxlc3NOdW1iZXIuaGFzKHN0eWxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdmFsdWUgKyBcInB4XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChzdHlsZSBpbiBsYXN0QXR0clZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmIChpc051bGxPclVuZGVmKG5leHRBdHRyVmFsdWVbc3R5bGVdKSkge1xyXG4gICAgICAgICAgICAgICAgZG9tU3R5bGVbc3R5bGVdID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGZvciAoc3R5bGUgaW4gbmV4dEF0dHJWYWx1ZSkge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IG5leHRBdHRyVmFsdWVbc3R5bGVdO1xyXG4gICAgICAgICAgICBkb21TdHlsZVtzdHlsZV0gPVxyXG4gICAgICAgICAgICAgICAgIWlzTnVtYmVyKHZhbHVlKSB8fCBpc1VuaXRsZXNzTnVtYmVyLmhhcyhzdHlsZSkgPyB2YWx1ZSA6IHZhbHVlICsgXCJweFwiO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZW1vdmVQcm9wKHByb3AsIGxhc3RWYWx1ZSwgZG9tLCBuZXh0RmxhZ3MpIHtcclxuICAgIGlmIChwcm9wID09PSBcInZhbHVlXCIpIHtcclxuICAgICAgICAvLyBXaGVuIHJlbW92aW5nIHZhbHVlIG9mIHNlbGVjdCBlbGVtZW50LCBpdCBuZWVkcyB0byBiZSBzZXQgdG8gbnVsbCBpbnN0ZWFkIGVtcHR5IHN0cmluZywgYmVjYXVzZSBlbXB0eSBzdHJpbmcgaXMgdmFsaWQgdmFsdWUgZm9yIG9wdGlvbiB3aGljaCBtYWtlcyB0aGF0IG9wdGlvbiBzZWxlY3RlZFxyXG4gICAgICAgIC8vIE1TIElFL0VkZ2UgZG9uJ3QgZm9sbG93IGh0bWwgc3BlYyBmb3IgdGV4dEFyZWEgYW5kIGlucHV0IGVsZW1lbnRzIGFuZCB3ZSBuZWVkIHRvIHNldCBlbXB0eSBzdHJpbmcgdG8gdmFsdWUgaW4gdGhvc2UgY2FzZXMgdG8gYXZvaWQgXCJudWxsXCIgYW5kIFwidW5kZWZpbmVkXCIgdGV4dHNcclxuICAgICAgICBkb20udmFsdWUgPSBuZXh0RmxhZ3MgJiAyMDQ4IC8qIFNlbGVjdEVsZW1lbnQgKi8gPyBudWxsIDogXCJcIjtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHByb3AgPT09IFwic3R5bGVcIikge1xyXG4gICAgICAgIGRvbS5yZW1vdmVBdHRyaWJ1dGUoXCJzdHlsZVwiKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzQXR0ckFuRXZlbnQocHJvcCkpIHtcclxuICAgICAgICBoYW5kbGVFdmVudChwcm9wLCBsYXN0VmFsdWUsIG51bGwsIGRvbSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBkb20ucmVtb3ZlQXR0cmlidXRlKHByb3ApO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbW9kdWxlIEluZmVybm9cclxuICovIC8qKiBUeXBlRG9jIENvbW1lbnQgKi9cclxuZnVuY3Rpb24gbW91bnQodk5vZGUsIHBhcmVudERvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRykge1xyXG4gICAgdmFyIGZsYWdzID0gdk5vZGUuZmxhZ3M7XHJcbiAgICBpZiAoZmxhZ3MgJiAzOTcwIC8qIEVsZW1lbnQgKi8pIHtcclxuICAgICAgICByZXR1cm4gbW91bnRFbGVtZW50KHZOb2RlLCBwYXJlbnREb20sIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoZmxhZ3MgJiAyOCAvKiBDb21wb25lbnQgKi8pIHtcclxuICAgICAgICByZXR1cm4gbW91bnRDb21wb25lbnQodk5vZGUsIHBhcmVudERvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgKGZsYWdzICYgNCAvKiBDb21wb25lbnRDbGFzcyAqLykgPiAwKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGZsYWdzICYgNDA5NiAvKiBWb2lkICovKSB7XHJcbiAgICAgICAgcmV0dXJuIG1vdW50Vm9pZCh2Tm9kZSwgcGFyZW50RG9tKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGZsYWdzICYgMSAvKiBUZXh0ICovKSB7XHJcbiAgICAgICAgcmV0dXJuIG1vdW50VGV4dCh2Tm9kZSwgcGFyZW50RG9tKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2Tm9kZSA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3dFcnJvcigoXCJtb3VudCgpIHJlY2VpdmVkIGFuIG9iamVjdCB0aGF0J3Mgbm90IGEgdmFsaWQgVk5vZGUsIHlvdSBzaG91bGQgc3RyaW5naWZ5IGl0IGZpcnN0LiBPYmplY3Q6IFxcXCJcIiArIChKU09OLnN0cmluZ2lmeSh2Tm9kZSkpICsgXCJcXFwiLlwiKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKChcIm1vdW50KCkgZXhwZWN0cyBhIHZhbGlkIFZOb2RlLCBpbnN0ZWFkIGl0IHJlY2VpdmVkIGFuIG9iamVjdCB3aXRoIHRoZSB0eXBlIFxcXCJcIiArICh0eXBlb2Ygdk5vZGUpICsgXCJcXFwiLlwiKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3dFcnJvcigpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG1vdW50VGV4dCh2Tm9kZSwgcGFyZW50RG9tKSB7XHJcbiAgICB2YXIgZG9tID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodk5vZGUuY2hpbGRyZW4pO1xyXG4gICAgdk5vZGUuZG9tID0gZG9tO1xyXG4gICAgaWYgKCFpc051bGwocGFyZW50RG9tKSkge1xyXG4gICAgICAgIGFwcGVuZENoaWxkKHBhcmVudERvbSwgZG9tKTtcclxuICAgIH1cclxuICAgIHJldHVybiBkb207XHJcbn1cclxuZnVuY3Rpb24gbW91bnRWb2lkKHZOb2RlLCBwYXJlbnREb20pIHtcclxuICAgIHZhciBkb20gPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcIlwiKTtcclxuICAgIHZOb2RlLmRvbSA9IGRvbTtcclxuICAgIGlmICghaXNOdWxsKHBhcmVudERvbSkpIHtcclxuICAgICAgICBhcHBlbmRDaGlsZChwYXJlbnREb20sIGRvbSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZG9tO1xyXG59XHJcbmZ1bmN0aW9uIG1vdW50RWxlbWVudCh2Tm9kZSwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSB7XHJcbiAgICB2YXIgZG9tO1xyXG4gICAgaWYgKG9wdGlvbnMucmVjeWNsaW5nRW5hYmxlZCkge1xyXG4gICAgICAgIGRvbSA9IHJlY3ljbGVFbGVtZW50KHZOb2RlLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICBpZiAoIWlzTnVsbChkb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNOdWxsKHBhcmVudERvbSkpIHtcclxuICAgICAgICAgICAgICAgIGFwcGVuZENoaWxkKHBhcmVudERvbSwgZG9tKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZG9tO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHZhciBmbGFncyA9IHZOb2RlLmZsYWdzO1xyXG4gICAgaXNTVkcgPSBpc1NWRyB8fCAoZmxhZ3MgJiAxMjggLyogU3ZnRWxlbWVudCAqLykgPiAwO1xyXG4gICAgZG9tID0gZG9jdW1lbnRDcmVhdGVFbGVtZW50KHZOb2RlLnR5cGUsIGlzU1ZHKTtcclxuICAgIHZhciBjaGlsZHJlbiA9IHZOb2RlLmNoaWxkcmVuO1xyXG4gICAgdmFyIHByb3BzID0gdk5vZGUucHJvcHM7XHJcbiAgICB2YXIgY2xhc3NOYW1lID0gdk5vZGUuY2xhc3NOYW1lO1xyXG4gICAgdmFyIHJlZiA9IHZOb2RlLnJlZjtcclxuICAgIHZOb2RlLmRvbSA9IGRvbTtcclxuICAgIGlmICghaXNJbnZhbGlkKGNoaWxkcmVuKSkge1xyXG4gICAgICAgIGlmIChpc1N0cmluZ09yTnVtYmVyKGNoaWxkcmVuKSkge1xyXG4gICAgICAgICAgICBzZXRUZXh0Q29udGVudChkb20sIGNoaWxkcmVuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbklzU1ZHID0gaXNTVkcgPT09IHRydWUgJiYgdk5vZGUudHlwZSAhPT0gXCJmb3JlaWduT2JqZWN0XCI7XHJcbiAgICAgICAgICAgIGlmIChpc0FycmF5KGNoaWxkcmVuKSkge1xyXG4gICAgICAgICAgICAgICAgbW91bnRBcnJheUNoaWxkcmVuKGNoaWxkcmVuLCBkb20sIGxpZmVjeWNsZSwgY29udGV4dCwgY2hpbGRyZW5Jc1NWRyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoaXNWTm9kZShjaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgICAgIG1vdW50KGNoaWxkcmVuLCBkb20sIGxpZmVjeWNsZSwgY29udGV4dCwgY2hpbGRyZW5Jc1NWRyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIWlzTnVsbChwcm9wcykpIHtcclxuICAgICAgICB2YXIgaGFzQ29udHJvbGxlZFZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGlzRm9ybUVsZW1lbnQgPSAoZmxhZ3MgJiAzNTg0IC8qIEZvcm1FbGVtZW50ICovKSA+IDA7XHJcbiAgICAgICAgaWYgKGlzRm9ybUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaGFzQ29udHJvbGxlZFZhbHVlID0gaXNDb250cm9sbGVkRm9ybUVsZW1lbnQocHJvcHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBwcm9wIGluIHByb3BzKSB7XHJcbiAgICAgICAgICAgIC8vIGRvIG5vdCBhZGQgYSBoYXNPd25Qcm9wZXJ0eSBjaGVjayBoZXJlLCBpdCBhZmZlY3RzIHBlcmZvcm1hbmNlXHJcbiAgICAgICAgICAgIHBhdGNoUHJvcChwcm9wLCBudWxsLCBwcm9wc1twcm9wXSwgZG9tLCBpc1NWRywgaGFzQ29udHJvbGxlZFZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzRm9ybUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcHJvY2Vzc0VsZW1lbnQoZmxhZ3MsIHZOb2RlLCBkb20sIHByb3BzLCB0cnVlLCBoYXNDb250cm9sbGVkVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChjbGFzc05hbWUgIT09IG51bGwpIHtcclxuICAgICAgICBpZiAoaXNTVkcpIHtcclxuICAgICAgICAgICAgZG9tLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIGNsYXNzTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBkb20uY2xhc3NOYW1lID0gY2xhc3NOYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICghaXNOdWxsKHJlZikpIHtcclxuICAgICAgICBtb3VudFJlZihkb20sIHJlZiwgbGlmZWN5Y2xlKTtcclxuICAgIH1cclxuICAgIGlmICghaXNOdWxsKHBhcmVudERvbSkpIHtcclxuICAgICAgICBhcHBlbmRDaGlsZChwYXJlbnREb20sIGRvbSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZG9tO1xyXG59XHJcbmZ1bmN0aW9uIG1vdW50QXJyYXlDaGlsZHJlbihjaGlsZHJlbiwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSB7XHJcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTtcclxuICAgICAgICAvLyBWZXJpZnkgY2FuIHN0cmluZy9udW1iZXIgYmUgaGVyZS4gbWlnaHQgY2F1c2UgZGUtb3B0LiAtIE5vcm1hbGl6YXRpb24gdGFrZXMgY2FyZSBvZiBpdC5cclxuICAgICAgICBpZiAoIWlzSW52YWxpZChjaGlsZCkpIHtcclxuICAgICAgICAgICAgaWYgKGNoaWxkLmRvbSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW5baV0gPSBjaGlsZCA9IGRpcmVjdENsb25lKGNoaWxkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtb3VudChjaGlsZHJlbltpXSwgZG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gbW91bnRDb21wb25lbnQodk5vZGUsIHBhcmVudERvbSwgbGlmZWN5Y2xlLCBjb250ZXh0LCBpc1NWRywgaXNDbGFzcykge1xyXG4gICAgdmFyIGRvbTtcclxuICAgIGlmIChvcHRpb25zLnJlY3ljbGluZ0VuYWJsZWQpIHtcclxuICAgICAgICBkb20gPSByZWN5Y2xlQ29tcG9uZW50KHZOb2RlLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICBpZiAoIWlzTnVsbChkb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNOdWxsKHBhcmVudERvbSkpIHtcclxuICAgICAgICAgICAgICAgIGFwcGVuZENoaWxkKHBhcmVudERvbSwgZG9tKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZG9tO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHZhciB0eXBlID0gdk5vZGUudHlwZTtcclxuICAgIHZhciBwcm9wcyA9IHZOb2RlLnByb3BzIHx8IEVNUFRZX09CSjtcclxuICAgIHZhciByZWYgPSB2Tm9kZS5yZWY7XHJcbiAgICBpZiAoaXNDbGFzcykge1xyXG4gICAgICAgIHZhciBpbnN0YW5jZSA9IGNyZWF0ZUNsYXNzQ29tcG9uZW50SW5zdGFuY2Uodk5vZGUsIHR5cGUsIHByb3BzLCBjb250ZXh0LCBpc1NWRywgbGlmZWN5Y2xlKTtcclxuICAgICAgICB2YXIgaW5wdXQgPSBpbnN0YW5jZS5fbGFzdElucHV0O1xyXG4gICAgICAgIGluc3RhbmNlLl92Tm9kZSA9IHZOb2RlO1xyXG4gICAgICAgIHZOb2RlLmRvbSA9IGRvbSA9IG1vdW50KGlucHV0LCBudWxsLCBsaWZlY3ljbGUsIGluc3RhbmNlLl9jaGlsZENvbnRleHQsIGlzU1ZHKTtcclxuICAgICAgICBpZiAoIWlzTnVsbChwYXJlbnREb20pKSB7XHJcbiAgICAgICAgICAgIGFwcGVuZENoaWxkKHBhcmVudERvbSwgZG9tKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbW91bnRDbGFzc0NvbXBvbmVudENhbGxiYWNrcyh2Tm9kZSwgcmVmLCBpbnN0YW5jZSwgbGlmZWN5Y2xlKTtcclxuICAgICAgICBpbnN0YW5jZS5fdXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICBpZiAob3B0aW9ucy5maW5kRE9NTm9kZUVuYWJsZWQpIHtcclxuICAgICAgICAgICAgY29tcG9uZW50VG9ET01Ob2RlTWFwLnNldChpbnN0YW5jZSwgZG9tKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB2YXIgaW5wdXQkMSA9IGNyZWF0ZUZ1bmN0aW9uYWxDb21wb25lbnRJbnB1dCh2Tm9kZSwgdHlwZSwgcHJvcHMsIGNvbnRleHQpO1xyXG4gICAgICAgIHZOb2RlLmRvbSA9IGRvbSA9IG1vdW50KGlucHV0JDEsIG51bGwsIGxpZmVjeWNsZSwgY29udGV4dCwgaXNTVkcpO1xyXG4gICAgICAgIHZOb2RlLmNoaWxkcmVuID0gaW5wdXQkMTtcclxuICAgICAgICBtb3VudEZ1bmN0aW9uYWxDb21wb25lbnRDYWxsYmFja3MocHJvcHMsIHJlZiwgZG9tLCBsaWZlY3ljbGUpO1xyXG4gICAgICAgIGlmICghaXNOdWxsKHBhcmVudERvbSkpIHtcclxuICAgICAgICAgICAgYXBwZW5kQ2hpbGQocGFyZW50RG9tLCBkb20pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBkb207XHJcbn1cclxuZnVuY3Rpb24gbW91bnRDbGFzc0NvbXBvbmVudENhbGxiYWNrcyh2Tm9kZSwgcmVmLCBpbnN0YW5jZSwgbGlmZWN5Y2xlKSB7XHJcbiAgICBpZiAocmVmKSB7XHJcbiAgICAgICAgaWYgKGlzRnVuY3Rpb24ocmVmKSkge1xyXG4gICAgICAgICAgICByZWYoaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzU3RyaW5nT3JOdW1iZXIocmVmKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoJ3N0cmluZyBcInJlZnNcIiBhcmUgbm90IHN1cHBvcnRlZCBpbiBJbmZlcm5vIDEuMC4gVXNlIGNhbGxiYWNrIFwicmVmc1wiIGluc3RlYWQuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChpc09iamVjdChyZWYpICYmIHZOb2RlLmZsYWdzICYgNCAvKiBDb21wb25lbnRDbGFzcyAqLykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoXCJmdW5jdGlvbmFsIGNvbXBvbmVudCBsaWZlY3ljbGUgZXZlbnRzIGFyZSBub3Qgc3VwcG9ydGVkIG9uIEVTMjAxNSBjbGFzcyBjb21wb25lbnRzLlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoKFwiYSBiYWQgdmFsdWUgZm9yIFxcXCJyZWZcXFwiIHdhcyB1c2VkIG9uIGNvbXBvbmVudDogXFxcIlwiICsgKEpTT04uc3RyaW5naWZ5KHJlZikpICsgXCJcXFwiXCIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aHJvd0Vycm9yKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdmFyIGhhc0RpZE1vdW50ID0gIWlzVW5kZWZpbmVkKGluc3RhbmNlLmNvbXBvbmVudERpZE1vdW50KTtcclxuICAgIHZhciBhZnRlck1vdW50ID0gb3B0aW9ucy5hZnRlck1vdW50O1xyXG4gICAgaWYgKGhhc0RpZE1vdW50IHx8ICFpc051bGwoYWZ0ZXJNb3VudCkpIHtcclxuICAgICAgICBsaWZlY3ljbGUuYWRkTGlzdGVuZXIoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaW5zdGFuY2UuX3VwZGF0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKGFmdGVyTW91bnQpIHtcclxuICAgICAgICAgICAgICAgIGFmdGVyTW91bnQodk5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChoYXNEaWRNb3VudCkge1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuY29tcG9uZW50RGlkTW91bnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnN0YW5jZS5fdXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gbW91bnRGdW5jdGlvbmFsQ29tcG9uZW50Q2FsbGJhY2tzKHByb3BzLCByZWYsIGRvbSwgbGlmZWN5Y2xlKSB7XHJcbiAgICBpZiAocmVmKSB7XHJcbiAgICAgICAgaWYgKCFpc051bGxPclVuZGVmKHJlZi5vbkNvbXBvbmVudFdpbGxNb3VudCkpIHtcclxuICAgICAgICAgICAgcmVmLm9uQ29tcG9uZW50V2lsbE1vdW50KHByb3BzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFpc051bGxPclVuZGVmKHJlZi5vbkNvbXBvbmVudERpZE1vdW50KSkge1xyXG4gICAgICAgICAgICBsaWZlY3ljbGUuYWRkTGlzdGVuZXIoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlZi5vbkNvbXBvbmVudERpZE1vdW50KGRvbSwgcHJvcHMpOyB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG1vdW50UmVmKGRvbSwgdmFsdWUsIGxpZmVjeWNsZSkge1xyXG4gICAgaWYgKGlzRnVuY3Rpb24odmFsdWUpKSB7XHJcbiAgICAgICAgbGlmZWN5Y2xlLmFkZExpc3RlbmVyKChmdW5jdGlvbiAoKSB7IHJldHVybiB2YWx1ZShkb20pOyB9KSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBpZiAoaXNJbnZhbGlkKHZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcclxuICAgICAgICAgICAgdGhyb3dFcnJvcignc3RyaW5nIFwicmVmc1wiIGFyZSBub3Qgc3VwcG9ydGVkIGluIEluZmVybm8gMS4wLiBVc2UgY2FsbGJhY2sgXCJyZWZzXCIgaW5zdGVhZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3dFcnJvcigpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbW9kdWxlIEluZmVybm9cclxuICovIC8qKiBUeXBlRG9jIENvbW1lbnQgKi9cclxuLy8gV2UgbmVlZCBFTVBUWV9PQkogZGVmaW5lZCBpbiBvbmUgcGxhY2UuXHJcbi8vIEl0cyB1c2VkIGZvciBjb21wYXJpc29uIHNvIHdlIGNhbnQgaW5saW5lIGl0IGludG8gc2hhcmVkXHJcbnZhciBFTVBUWV9PQkogPSB7fTtcclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgT2JqZWN0LmZyZWV6ZShFTVBUWV9PQkopO1xyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZUNsYXNzQ29tcG9uZW50SW5zdGFuY2Uodk5vZGUsIENvbXBvbmVudCwgcHJvcHMsIGNvbnRleHQsIGlzU1ZHLCBsaWZlY3ljbGUpIHtcclxuICAgIGlmIChpc1VuZGVmaW5lZChjb250ZXh0KSkge1xyXG4gICAgICAgIGNvbnRleHQgPSBFTVBUWV9PQko7IC8vIENvbnRleHQgc2hvdWxkIG5vdCBiZSBtdXRhYmxlXHJcbiAgICB9XHJcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgQ29tcG9uZW50KHByb3BzLCBjb250ZXh0KTtcclxuICAgIHZOb2RlLmNoaWxkcmVuID0gaW5zdGFuY2U7XHJcbiAgICBpbnN0YW5jZS5fYmxvY2tTZXRTdGF0ZSA9IGZhbHNlO1xyXG4gICAgaW5zdGFuY2UuY29udGV4dCA9IGNvbnRleHQ7XHJcbiAgICBpZiAoaW5zdGFuY2UucHJvcHMgPT09IEVNUFRZX09CSikge1xyXG4gICAgICAgIGluc3RhbmNlLnByb3BzID0gcHJvcHM7XHJcbiAgICB9XHJcbiAgICAvLyBzZXRTdGF0ZSBjYWxsYmFja3MgbXVzdCBmaXJlIGFmdGVyIHJlbmRlciBpcyBkb25lIHdoZW4gY2FsbGVkIGZyb20gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyBvciBjb21wb25lbnRXaWxsTW91bnRcclxuICAgIGluc3RhbmNlLl9saWZlY3ljbGUgPSBsaWZlY3ljbGU7XHJcbiAgICBpbnN0YW5jZS5fdW5tb3VudGVkID0gZmFsc2U7XHJcbiAgICBpbnN0YW5jZS5fcGVuZGluZ1NldFN0YXRlID0gdHJ1ZTtcclxuICAgIGluc3RhbmNlLl9pc1NWRyA9IGlzU1ZHO1xyXG4gICAgaWYgKCFpc051bGxPclVuZGVmKGluc3RhbmNlLmNvbXBvbmVudFdpbGxNb3VudCkpIHtcclxuICAgICAgICBpbnN0YW5jZS5fYmxvY2tSZW5kZXIgPSB0cnVlO1xyXG4gICAgICAgIGluc3RhbmNlLmNvbXBvbmVudFdpbGxNb3VudCgpO1xyXG4gICAgICAgIGluc3RhbmNlLl9ibG9ja1JlbmRlciA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgdmFyIGNoaWxkQ29udGV4dDtcclxuICAgIGlmICghaXNOdWxsT3JVbmRlZihpbnN0YW5jZS5nZXRDaGlsZENvbnRleHQpKSB7XHJcbiAgICAgICAgY2hpbGRDb250ZXh0ID0gaW5zdGFuY2UuZ2V0Q2hpbGRDb250ZXh0KCk7XHJcbiAgICB9XHJcbiAgICBpZiAoaXNOdWxsT3JVbmRlZihjaGlsZENvbnRleHQpKSB7XHJcbiAgICAgICAgaW5zdGFuY2UuX2NoaWxkQ29udGV4dCA9IGNvbnRleHQ7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBpbnN0YW5jZS5fY2hpbGRDb250ZXh0ID0gY29tYmluZUZyb20oY29udGV4dCwgY2hpbGRDb250ZXh0KTtcclxuICAgIH1cclxuICAgIGlmICghaXNOdWxsKG9wdGlvbnMuYmVmb3JlUmVuZGVyKSkge1xyXG4gICAgICAgIG9wdGlvbnMuYmVmb3JlUmVuZGVyKGluc3RhbmNlKTtcclxuICAgIH1cclxuICAgIHZhciBpbnB1dCA9IGluc3RhbmNlLnJlbmRlcihwcm9wcywgaW5zdGFuY2Uuc3RhdGUsIGNvbnRleHQpO1xyXG4gICAgaWYgKCFpc051bGwob3B0aW9ucy5hZnRlclJlbmRlcikpIHtcclxuICAgICAgICBvcHRpb25zLmFmdGVyUmVuZGVyKGluc3RhbmNlKTtcclxuICAgIH1cclxuICAgIGlmIChpc0FycmF5KGlucHV0KSkge1xyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcclxuICAgICAgICAgICAgdGhyb3dFcnJvcihcImEgdmFsaWQgSW5mZXJubyBWTm9kZSAob3IgbnVsbCkgbXVzdCBiZSByZXR1cm5lZCBmcm9tIGEgY29tcG9uZW50IHJlbmRlci4gWW91IG1heSBoYXZlIHJldHVybmVkIGFuIGFycmF5IG9yIGFuIGludmFsaWQgb2JqZWN0LlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3dFcnJvcigpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoaXNJbnZhbGlkKGlucHV0KSkge1xyXG4gICAgICAgIGlucHV0ID0gY3JlYXRlVm9pZFZOb2RlKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChpc1N0cmluZ09yTnVtYmVyKGlucHV0KSkge1xyXG4gICAgICAgIGlucHV0ID0gY3JlYXRlVGV4dFZOb2RlKGlucHV0LCBudWxsKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChpbnB1dC5kb20pIHtcclxuICAgICAgICAgICAgaW5wdXQgPSBkaXJlY3RDbG9uZShpbnB1dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbnB1dC5mbGFncyAmIDI4IC8qIENvbXBvbmVudCAqLykge1xyXG4gICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIGFuIGlucHV0IHRoYXQgaXMgYWxzbyBhIGNvbXBvbmVudCwgd2UgcnVuIGludG8gYSB0cmlja3kgc2l0dWF0aW9uXHJcbiAgICAgICAgICAgIC8vIHdoZXJlIHRoZSByb290IHZOb2RlIG5lZWRzIHRvIGFsd2F5cyBoYXZlIHRoZSBjb3JyZWN0IERPTSBlbnRyeVxyXG4gICAgICAgICAgICAvLyBzbyB3ZSBicmVhayBtb25vbW9ycGhpc20gb24gb3VyIGlucHV0IGFuZCBzdXBwbHkgaXQgb3VyIHZOb2RlIGFzIHBhcmVudFZOb2RlXHJcbiAgICAgICAgICAgIC8vIHdlIGNhbiBvcHRpbWlzZSB0aGlzIGluIHRoZSBmdXR1cmUsIGJ1dCB0aGlzIGdldHMgdXMgb3V0IG9mIGEgbG90IG9mIGlzc3Vlc1xyXG4gICAgICAgICAgICBpbnB1dC5wYXJlbnRWTm9kZSA9IHZOb2RlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGluc3RhbmNlLl9wZW5kaW5nU2V0U3RhdGUgPSBmYWxzZTtcclxuICAgIGluc3RhbmNlLl9sYXN0SW5wdXQgPSBpbnB1dDtcclxuICAgIHJldHVybiBpbnN0YW5jZTtcclxufVxyXG5mdW5jdGlvbiByZXBsYWNlTGFzdENoaWxkQW5kVW5tb3VudChsYXN0SW5wdXQsIG5leHRJbnB1dCwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZykge1xyXG4gICAgcmVwbGFjZVZOb2RlKHBhcmVudERvbSwgbW91bnQobmV4dElucHV0LCBudWxsLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKSwgbGFzdElucHV0LCBsaWZlY3ljbGUsIGlzUmVjeWNsaW5nKTtcclxufVxyXG5mdW5jdGlvbiByZXBsYWNlVk5vZGUocGFyZW50RG9tLCBkb20sIHZOb2RlLCBsaWZlY3ljbGUsIGlzUmVjeWNsaW5nKSB7XHJcbiAgICB1bm1vdW50KHZOb2RlLCBudWxsLCBsaWZlY3ljbGUsIGZhbHNlLCBpc1JlY3ljbGluZyk7XHJcbiAgICByZXBsYWNlQ2hpbGQocGFyZW50RG9tLCBkb20sIHZOb2RlLmRvbSk7XHJcbn1cclxuZnVuY3Rpb24gY3JlYXRlRnVuY3Rpb25hbENvbXBvbmVudElucHV0KHZOb2RlLCBjb21wb25lbnQsIHByb3BzLCBjb250ZXh0KSB7XHJcbiAgICB2YXIgaW5wdXQgPSBjb21wb25lbnQocHJvcHMsIGNvbnRleHQpO1xyXG4gICAgaWYgKGlzQXJyYXkoaW5wdXQpKSB7XHJcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgICAgICAgICB0aHJvd0Vycm9yKFwiYSB2YWxpZCBJbmZlcm5vIFZOb2RlIChvciBudWxsKSBtdXN0IGJlIHJldHVybmVkIGZyb20gYSBjb21wb25lbnQgcmVuZGVyLiBZb3UgbWF5IGhhdmUgcmV0dXJuZWQgYW4gYXJyYXkgb3IgYW4gaW52YWxpZCBvYmplY3QuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvd0Vycm9yKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChpc0ludmFsaWQoaW5wdXQpKSB7XHJcbiAgICAgICAgaW5wdXQgPSBjcmVhdGVWb2lkVk5vZGUoKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzU3RyaW5nT3JOdW1iZXIoaW5wdXQpKSB7XHJcbiAgICAgICAgaW5wdXQgPSBjcmVhdGVUZXh0Vk5vZGUoaW5wdXQsIG51bGwpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgaWYgKGlucHV0LmRvbSkge1xyXG4gICAgICAgICAgICBpbnB1dCA9IGRpcmVjdENsb25lKGlucHV0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlucHV0LmZsYWdzICYgMjggLyogQ29tcG9uZW50ICovKSB7XHJcbiAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgYW4gaW5wdXQgdGhhdCBpcyBhbHNvIGEgY29tcG9uZW50LCB3ZSBydW4gaW50byBhIHRyaWNreSBzaXR1YXRpb25cclxuICAgICAgICAgICAgLy8gd2hlcmUgdGhlIHJvb3Qgdk5vZGUgbmVlZHMgdG8gYWx3YXlzIGhhdmUgdGhlIGNvcnJlY3QgRE9NIGVudHJ5XHJcbiAgICAgICAgICAgIC8vIHNvIHdlIGJyZWFrIG1vbm9tb3JwaGlzbSBvbiBvdXIgaW5wdXQgYW5kIHN1cHBseSBpdCBvdXIgdk5vZGUgYXMgcGFyZW50Vk5vZGVcclxuICAgICAgICAgICAgLy8gd2UgY2FuIG9wdGltaXNlIHRoaXMgaW4gdGhlIGZ1dHVyZSwgYnV0IHRoaXMgZ2V0cyB1cyBvdXQgb2YgYSBsb3Qgb2YgaXNzdWVzXHJcbiAgICAgICAgICAgIGlucHV0LnBhcmVudFZOb2RlID0gdk5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGlucHV0O1xyXG59XHJcbmZ1bmN0aW9uIHNldFRleHRDb250ZW50KGRvbSwgdGV4dCkge1xyXG4gICAgaWYgKHRleHQgIT09IFwiXCIpIHtcclxuICAgICAgICBkb20udGV4dENvbnRlbnQgPSB0ZXh0O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgZG9tLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwiXCIpKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB1cGRhdGVUZXh0Q29udGVudChkb20sIHRleHQpIHtcclxuICAgIGRvbS5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IHRleHQ7XHJcbn1cclxuZnVuY3Rpb24gYXBwZW5kQ2hpbGQocGFyZW50RG9tLCBkb20pIHtcclxuICAgIHBhcmVudERvbS5hcHBlbmRDaGlsZChkb20pO1xyXG59XHJcbmZ1bmN0aW9uIGluc2VydE9yQXBwZW5kKHBhcmVudERvbSwgbmV3Tm9kZSwgbmV4dE5vZGUpIHtcclxuICAgIGlmIChpc051bGxPclVuZGVmKG5leHROb2RlKSkge1xyXG4gICAgICAgIGFwcGVuZENoaWxkKHBhcmVudERvbSwgbmV3Tm9kZSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBwYXJlbnREb20uaW5zZXJ0QmVmb3JlKG5ld05vZGUsIG5leHROb2RlKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBkb2N1bWVudENyZWF0ZUVsZW1lbnQodGFnLCBpc1NWRykge1xyXG4gICAgaWYgKGlzU1ZHID09PSB0cnVlKSB7XHJcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywgdGFnKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcmVwbGFjZVdpdGhOZXdOb2RlKGxhc3ROb2RlLCBuZXh0Tm9kZSwgcGFyZW50RG9tLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHLCBpc1JlY3ljbGluZykge1xyXG4gICAgdW5tb3VudChsYXN0Tm9kZSwgbnVsbCwgbGlmZWN5Y2xlLCBmYWxzZSwgaXNSZWN5Y2xpbmcpO1xyXG4gICAgdmFyIGRvbSA9IG1vdW50KG5leHROb2RlLCBudWxsLCBsaWZlY3ljbGUsIGNvbnRleHQsIGlzU1ZHKTtcclxuICAgIG5leHROb2RlLmRvbSA9IGRvbTtcclxuICAgIHJlcGxhY2VDaGlsZChwYXJlbnREb20sIGRvbSwgbGFzdE5vZGUuZG9tKTtcclxufVxyXG5mdW5jdGlvbiByZXBsYWNlQ2hpbGQocGFyZW50RG9tLCBuZXh0RG9tLCBsYXN0RG9tKSB7XHJcbiAgICBpZiAoIXBhcmVudERvbSkge1xyXG4gICAgICAgIHBhcmVudERvbSA9IGxhc3REb20ucGFyZW50Tm9kZTtcclxuICAgIH1cclxuICAgIHBhcmVudERvbS5yZXBsYWNlQ2hpbGQobmV4dERvbSwgbGFzdERvbSk7XHJcbn1cclxuZnVuY3Rpb24gcmVtb3ZlQ2hpbGQocGFyZW50RG9tLCBkb20pIHtcclxuICAgIHBhcmVudERvbS5yZW1vdmVDaGlsZChkb20pO1xyXG59XHJcbmZ1bmN0aW9uIHJlbW92ZUFsbENoaWxkcmVuKGRvbSwgY2hpbGRyZW4sIGxpZmVjeWNsZSwgaXNSZWN5Y2xpbmcpIHtcclxuICAgIGlmICghb3B0aW9ucy5yZWN5Y2xpbmdFbmFibGVkIHx8IChvcHRpb25zLnJlY3ljbGluZ0VuYWJsZWQgJiYgIWlzUmVjeWNsaW5nKSkge1xyXG4gICAgICAgIHJlbW92ZUNoaWxkcmVuKG51bGwsIGNoaWxkcmVuLCBsaWZlY3ljbGUsIGlzUmVjeWNsaW5nKTtcclxuICAgIH1cclxuICAgIGRvbS50ZXh0Q29udGVudCA9IFwiXCI7XHJcbn1cclxuZnVuY3Rpb24gcmVtb3ZlQ2hpbGRyZW4oZG9tLCBjaGlsZHJlbiwgbGlmZWN5Y2xlLCBpc1JlY3ljbGluZykge1xyXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07XHJcbiAgICAgICAgaWYgKCFpc0ludmFsaWQoY2hpbGQpKSB7XHJcbiAgICAgICAgICAgIHVubW91bnQoY2hpbGQsIGRvbSwgbGlmZWN5Y2xlLCB0cnVlLCBpc1JlY3ljbGluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGlzS2V5ZWQobGFzdENoaWxkcmVuLCBuZXh0Q2hpbGRyZW4pIHtcclxuICAgIHJldHVybiAobmV4dENoaWxkcmVuLmxlbmd0aCA+IDAgJiZcclxuICAgICAgICAhaXNOdWxsT3JVbmRlZihuZXh0Q2hpbGRyZW5bMF0pICYmXHJcbiAgICAgICAgIWlzTnVsbE9yVW5kZWYobmV4dENoaWxkcmVuWzBdLmtleSkgJiZcclxuICAgICAgICBsYXN0Q2hpbGRyZW4ubGVuZ3RoID4gMCAmJlxyXG4gICAgICAgICFpc051bGxPclVuZGVmKGxhc3RDaGlsZHJlblswXSkgJiZcclxuICAgICAgICAhaXNOdWxsT3JVbmRlZihsYXN0Q2hpbGRyZW5bMF0ua2V5KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBtb2R1bGUgSW5mZXJub1xyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG5mdW5jdGlvbiBWTm9kZShjaGlsZHJlbiwgY2xhc3NOYW1lLCBmbGFncywga2V5LCBwcm9wcywgcmVmLCB0eXBlKSB7XHJcbiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47XHJcbiAgICB0aGlzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcclxuICAgIHRoaXMuZG9tID0gbnVsbDtcclxuICAgIHRoaXMuZmxhZ3MgPSBmbGFncztcclxuICAgIHRoaXMua2V5ID0ga2V5O1xyXG4gICAgdGhpcy5wcm9wcyA9IHByb3BzO1xyXG4gICAgdGhpcy5yZWYgPSByZWY7XHJcbiAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG59XHJcbi8qKlxyXG4gKiBDcmVhdGVzIHZpcnR1YWwgbm9kZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gZmxhZ3NcclxuICogQHBhcmFtIHtzdHJpbmd8RnVuY3Rpb258bnVsbH0gdHlwZVxyXG4gKiBAcGFyYW0ge3N0cmluZ3xudWxsPX0gY2xhc3NOYW1lXHJcbiAqIEBwYXJhbSB7b2JqZWN0PX0gY2hpbGRyZW5cclxuICogQHBhcmFtIHtvYmplY3Q9fSBwcm9wc1xyXG4gKiBAcGFyYW0geyo9fSBrZXlcclxuICogQHBhcmFtIHtvYmplY3R8RnVuY3Rpb249fSByZWZcclxuICogQHBhcmFtIHtib29sZWFuPX0gbm9Ob3JtYWxpc2VcclxuICogQHJldHVybnMge1ZOb2RlfSByZXR1cm5zIG5ldyB2aXJ0dWFsIG5vZGVcclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZVZOb2RlKGZsYWdzLCB0eXBlLCBjbGFzc05hbWUsIGNoaWxkcmVuLCBwcm9wcywga2V5LCByZWYsIG5vTm9ybWFsaXNlKSB7XHJcbiAgICBpZiAoZmxhZ3MgJiAxNiAvKiBDb21wb25lbnRVbmtub3duICovKSB7XHJcbiAgICAgICAgZmxhZ3MgPSBpc1N0YXRlZnVsQ29tcG9uZW50KHR5cGUpXHJcbiAgICAgICAgICAgID8gNCAvKiBDb21wb25lbnRDbGFzcyAqL1xyXG4gICAgICAgICAgICA6IDggLyogQ29tcG9uZW50RnVuY3Rpb24gKi87XHJcbiAgICB9XHJcbiAgICB2YXIgdk5vZGUgPSBuZXcgVk5vZGUoY2hpbGRyZW4gPT09IHZvaWQgMCA/IG51bGwgOiBjaGlsZHJlbiwgY2xhc3NOYW1lID09PSB2b2lkIDAgPyBudWxsIDogY2xhc3NOYW1lLCBmbGFncywga2V5ID09PSB2b2lkIDAgPyBudWxsIDoga2V5LCBwcm9wcyA9PT0gdm9pZCAwID8gbnVsbCA6IHByb3BzLCByZWYgPT09IHZvaWQgMCA/IG51bGwgOiByZWYsIHR5cGUpO1xyXG4gICAgaWYgKG5vTm9ybWFsaXNlICE9PSB0cnVlKSB7XHJcbiAgICAgICAgbm9ybWFsaXplKHZOb2RlKTtcclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLmNyZWF0ZVZOb2RlICE9PSBudWxsKSB7XHJcbiAgICAgICAgb3B0aW9ucy5jcmVhdGVWTm9kZSh2Tm9kZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdk5vZGU7XHJcbn1cclxuZnVuY3Rpb24gZGlyZWN0Q2xvbmUodk5vZGVUb0Nsb25lKSB7XHJcbiAgICB2YXIgbmV3Vk5vZGU7XHJcbiAgICB2YXIgZmxhZ3MgPSB2Tm9kZVRvQ2xvbmUuZmxhZ3M7XHJcbiAgICBpZiAoZmxhZ3MgJiAyOCAvKiBDb21wb25lbnQgKi8pIHtcclxuICAgICAgICB2YXIgcHJvcHM7XHJcbiAgICAgICAgdmFyIHByb3BzVG9DbG9uZSA9IHZOb2RlVG9DbG9uZS5wcm9wcztcclxuICAgICAgICBpZiAoaXNOdWxsKHByb3BzVG9DbG9uZSkpIHtcclxuICAgICAgICAgICAgcHJvcHMgPSBFTVBUWV9PQko7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBwcm9wcyA9IHt9O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHNUb0Nsb25lKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9wc1trZXldID0gcHJvcHNUb0Nsb25lW2tleV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbmV3Vk5vZGUgPSBjcmVhdGVWTm9kZShmbGFncywgdk5vZGVUb0Nsb25lLnR5cGUsIG51bGwsIG51bGwsIHByb3BzLCB2Tm9kZVRvQ2xvbmUua2V5LCB2Tm9kZVRvQ2xvbmUucmVmLCB0cnVlKTtcclxuICAgICAgICB2YXIgbmV3UHJvcHMgPSBuZXdWTm9kZS5wcm9wcztcclxuICAgICAgICB2YXIgbmV3Q2hpbGRyZW4gPSBuZXdQcm9wcy5jaGlsZHJlbjtcclxuICAgICAgICAvLyB3ZSBuZWVkIHRvIGFsc28gY2xvbmUgY29tcG9uZW50IGNoaWxkcmVuIHRoYXQgYXJlIGluIHByb3BzXHJcbiAgICAgICAgLy8gYXMgdGhlIGNoaWxkcmVuIG1heSBhbHNvIGhhdmUgYmVlbiBob2lzdGVkXHJcbiAgICAgICAgaWYgKG5ld0NoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgIGlmIChpc0FycmF5KG5ld0NoaWxkcmVuKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxlbiA9IG5ld0NoaWxkcmVuLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGlmIChsZW4gPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRtcEFycmF5ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBuZXdDaGlsZHJlbltpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3RyaW5nT3JOdW1iZXIoY2hpbGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBBcnJheS5wdXNoKGNoaWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghaXNJbnZhbGlkKGNoaWxkKSAmJiBpc1ZOb2RlKGNoaWxkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wQXJyYXkucHVzaChkaXJlY3RDbG9uZShjaGlsZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1Byb3BzLmNoaWxkcmVuID0gdG1wQXJyYXk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoaXNWTm9kZShuZXdDaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgICAgIG5ld1Byb3BzLmNoaWxkcmVuID0gZGlyZWN0Q2xvbmUobmV3Q2hpbGRyZW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5ld1ZOb2RlLmNoaWxkcmVuID0gbnVsbDtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGZsYWdzICYgMzk3MCAvKiBFbGVtZW50ICovKSB7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdk5vZGVUb0Nsb25lLmNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBwcm9wcyQxO1xyXG4gICAgICAgIHZhciBwcm9wc1RvQ2xvbmUkMSA9IHZOb2RlVG9DbG9uZS5wcm9wcztcclxuICAgICAgICBpZiAocHJvcHNUb0Nsb25lJDEgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcHJvcHMkMSA9IEVNUFRZX09CSjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHByb3BzJDEgPSB7fTtcclxuICAgICAgICAgICAgZm9yICh2YXIga2V5JDEgaW4gcHJvcHNUb0Nsb25lJDEpIHtcclxuICAgICAgICAgICAgICAgIHByb3BzJDFba2V5JDFdID0gcHJvcHNUb0Nsb25lJDFba2V5JDFdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5ld1ZOb2RlID0gY3JlYXRlVk5vZGUoZmxhZ3MsIHZOb2RlVG9DbG9uZS50eXBlLCB2Tm9kZVRvQ2xvbmUuY2xhc3NOYW1lLCBjaGlsZHJlbiwgcHJvcHMkMSwgdk5vZGVUb0Nsb25lLmtleSwgdk5vZGVUb0Nsb25lLnJlZiwgIWNoaWxkcmVuKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGZsYWdzICYgMSAvKiBUZXh0ICovKSB7XHJcbiAgICAgICAgbmV3Vk5vZGUgPSBjcmVhdGVUZXh0Vk5vZGUodk5vZGVUb0Nsb25lLmNoaWxkcmVuLCB2Tm9kZVRvQ2xvbmUua2V5KTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXdWTm9kZTtcclxufVxyXG4vKlxyXG4gZGlyZWN0Q2xvbmUgaXMgcHJlZmVycmVkIG92ZXIgY2xvbmVWTm9kZSBhbmQgdXNlZCBpbnRlcm5hbGx5IGFsc28uXHJcbiBUaGlzIGZ1bmN0aW9uIG1ha2VzIEluZmVybm8gYmFja3dhcmRzIGNvbXBhdGlibGUuXHJcbiBBbmQgY2FuIGJlIHRyZWUtc2hha2VkIGJ5IG1vZGVybiBidW5kbGVyc1xyXG5cbiBXb3VsZCBiZSBuaWNlIHRvIGNvbWJpbmUgdGhpcyB3aXRoIGRpcmVjdENsb25lIGJ1dCBjb3VsZCBub3QgZG8gaXQgd2l0aG91dCBicmVha2luZyBjaGFuZ2VcclxuICovXHJcbi8qKlxyXG4gKiBDbG9uZXMgZ2l2ZW4gdmlydHVhbCBub2RlIGJ5IGNyZWF0aW5nIG5ldyBpbnN0YW5jZSBvZiBpdFxyXG4gKiBAcGFyYW0ge1ZOb2RlfSB2Tm9kZVRvQ2xvbmUgdmlydHVhbCBub2RlIHRvIGJlIGNsb25lZFxyXG4gKiBAcGFyYW0ge1Byb3BzPX0gcHJvcHMgYWRkaXRpb25hbCBwcm9wcyBmb3IgbmV3IHZpcnR1YWwgbm9kZVxyXG4gKiBAcGFyYW0gey4uLip9IF9jaGlsZHJlbiBuZXcgY2hpbGRyZW4gZm9yIG5ldyB2aXJ0dWFsIG5vZGVcclxuICogQHJldHVybnMge1ZOb2RlfSBuZXcgdmlydHVhbCBub2RlXHJcbiAqL1xyXG5mdW5jdGlvbiBjbG9uZVZOb2RlKHZOb2RlVG9DbG9uZSwgcHJvcHMpIHtcbiAgICB2YXIgX2NoaWxkcmVuID0gW10sIGxlbiQyID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7XG4gICAgd2hpbGUgKCBsZW4kMi0tID4gMCApIF9jaGlsZHJlblsgbGVuJDIgXSA9IGFyZ3VtZW50c1sgbGVuJDIgKyAyIF07XG5cclxuICAgIHZhciBjaGlsZHJlbiA9IF9jaGlsZHJlbjtcclxuICAgIHZhciBjaGlsZHJlbkxlbiA9IF9jaGlsZHJlbi5sZW5ndGg7XHJcbiAgICBpZiAoY2hpbGRyZW5MZW4gPiAwICYmICFpc1VuZGVmaW5lZChfY2hpbGRyZW5bMF0pKSB7XHJcbiAgICAgICAgaWYgKCFwcm9wcykge1xyXG4gICAgICAgICAgICBwcm9wcyA9IHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2hpbGRyZW5MZW4gPT09IDEpIHtcclxuICAgICAgICAgICAgY2hpbGRyZW4gPSBfY2hpbGRyZW5bMF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaXNVbmRlZmluZWQoY2hpbGRyZW4pKSB7XHJcbiAgICAgICAgICAgIHByb3BzLmNoaWxkcmVuID0gY2hpbGRyZW47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdmFyIG5ld1ZOb2RlO1xyXG4gICAgaWYgKGlzQXJyYXkodk5vZGVUb0Nsb25lKSkge1xyXG4gICAgICAgIHZhciB0bXBBcnJheSA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2Tm9kZVRvQ2xvbmUubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgdG1wQXJyYXkucHVzaChkaXJlY3RDbG9uZSh2Tm9kZVRvQ2xvbmVbaV0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbmV3Vk5vZGUgPSB0bXBBcnJheTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHZhciBmbGFncyA9IHZOb2RlVG9DbG9uZS5mbGFncztcclxuICAgICAgICB2YXIgY2xhc3NOYW1lID0gdk5vZGVUb0Nsb25lLmNsYXNzTmFtZTtcclxuICAgICAgICB2YXIga2V5ID0gdk5vZGVUb0Nsb25lLmtleTtcclxuICAgICAgICB2YXIgcmVmID0gdk5vZGVUb0Nsb25lLnJlZjtcclxuICAgICAgICBpZiAocHJvcHMpIHtcclxuICAgICAgICAgICAgaWYgKHByb3BzLmhhc093blByb3BlcnR5KFwiY2xhc3NOYW1lXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBwcm9wcy5jbGFzc05hbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHByb3BzLmhhc093blByb3BlcnR5KFwicmVmXCIpKSB7XHJcbiAgICAgICAgICAgICAgICByZWYgPSBwcm9wcy5yZWY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHByb3BzLmhhc093blByb3BlcnR5KFwia2V5XCIpKSB7XHJcbiAgICAgICAgICAgICAgICBrZXkgPSBwcm9wcy5rZXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZsYWdzICYgMjggLyogQ29tcG9uZW50ICovKSB7XHJcbiAgICAgICAgICAgIG5ld1ZOb2RlID0gY3JlYXRlVk5vZGUoZmxhZ3MsIHZOb2RlVG9DbG9uZS50eXBlLCBjbGFzc05hbWUsIG51bGwsICF2Tm9kZVRvQ2xvbmUucHJvcHMgJiYgIXByb3BzXHJcbiAgICAgICAgICAgICAgICA/IEVNUFRZX09CSlxyXG4gICAgICAgICAgICAgICAgOiBjb21iaW5lRnJvbSh2Tm9kZVRvQ2xvbmUucHJvcHMsIHByb3BzKSwga2V5LCByZWYsIHRydWUpO1xyXG4gICAgICAgICAgICB2YXIgbmV3UHJvcHMgPSBuZXdWTm9kZS5wcm9wcztcclxuICAgICAgICAgICAgaWYgKG5ld1Byb3BzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3Q2hpbGRyZW4gPSBuZXdQcm9wcy5jaGlsZHJlbjtcclxuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gYWxzbyBjbG9uZSBjb21wb25lbnQgY2hpbGRyZW4gdGhhdCBhcmUgaW4gcHJvcHNcclxuICAgICAgICAgICAgICAgIC8vIGFzIHRoZSBjaGlsZHJlbiBtYXkgYWxzbyBoYXZlIGJlZW4gaG9pc3RlZFxyXG4gICAgICAgICAgICAgICAgaWYgKG5ld0NoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQXJyYXkobmV3Q2hpbGRyZW4pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZW4kMSA9IG5ld0NoaWxkcmVuLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlbiQxID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcEFycmF5JDEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGxlbiQxOyBpJDErKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IG5ld0NoaWxkcmVuW2kkMV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3RyaW5nT3JOdW1iZXIoY2hpbGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcEFycmF5JDEucHVzaChjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFpc0ludmFsaWQoY2hpbGQpICYmIGlzVk5vZGUoY2hpbGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcEFycmF5JDEucHVzaChkaXJlY3RDbG9uZShjaGlsZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Byb3BzLmNoaWxkcmVuID0gdG1wQXJyYXkkMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpc1ZOb2RlKG5ld0NoaWxkcmVuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdQcm9wcy5jaGlsZHJlbiA9IGRpcmVjdENsb25lKG5ld0NoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmV3Vk5vZGUuY2hpbGRyZW4gPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChmbGFncyAmIDM5NzAgLyogRWxlbWVudCAqLykge1xyXG4gICAgICAgICAgICBjaGlsZHJlbiA9XHJcbiAgICAgICAgICAgICAgICBwcm9wcyAmJiAhaXNVbmRlZmluZWQocHJvcHMuY2hpbGRyZW4pXHJcbiAgICAgICAgICAgICAgICAgICAgPyBwcm9wcy5jaGlsZHJlblxyXG4gICAgICAgICAgICAgICAgICAgIDogdk5vZGVUb0Nsb25lLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICBuZXdWTm9kZSA9IGNyZWF0ZVZOb2RlKGZsYWdzLCB2Tm9kZVRvQ2xvbmUudHlwZSwgY2xhc3NOYW1lLCBjaGlsZHJlbiwgIXZOb2RlVG9DbG9uZS5wcm9wcyAmJiAhcHJvcHNcclxuICAgICAgICAgICAgICAgID8gRU1QVFlfT0JKXHJcbiAgICAgICAgICAgICAgICA6IGNvbWJpbmVGcm9tKHZOb2RlVG9DbG9uZS5wcm9wcywgcHJvcHMpLCBrZXksIHJlZiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChmbGFncyAmIDEgLyogVGV4dCAqLykge1xyXG4gICAgICAgICAgICBuZXdWTm9kZSA9IGNyZWF0ZVRleHRWTm9kZSh2Tm9kZVRvQ2xvbmUuY2hpbGRyZW4sIGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ld1ZOb2RlO1xyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZVZvaWRWTm9kZSgpIHtcclxuICAgIHJldHVybiBjcmVhdGVWTm9kZSg0MDk2IC8qIFZvaWQgKi8sIG51bGwpO1xyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZVRleHRWTm9kZSh0ZXh0LCBrZXkpIHtcclxuICAgIHJldHVybiBjcmVhdGVWTm9kZSgxIC8qIFRleHQgKi8sIG51bGwsIG51bGwsIHRleHQsIG51bGwsIGtleSk7XHJcbn1cclxuZnVuY3Rpb24gaXNWTm9kZShvKSB7XHJcbiAgICByZXR1cm4gISFvLmZsYWdzO1xyXG59XG5cbi8qKlxyXG4gKiBAbW9kdWxlIEluZmVybm9cclxuICovIC8qKiBUeXBlRG9jIENvbW1lbnQgKi9cclxuZnVuY3Rpb24gYXBwbHlLZXkoa2V5LCB2Tm9kZSkge1xyXG4gICAgdk5vZGUua2V5ID0ga2V5O1xyXG4gICAgcmV0dXJuIHZOb2RlO1xyXG59XHJcbmZ1bmN0aW9uIGFwcGx5S2V5SWZNaXNzaW5nKGtleSwgdk5vZGUpIHtcclxuICAgIGlmIChpc051bWJlcihrZXkpKSB7XHJcbiAgICAgICAga2V5ID0gXCIuXCIgKyBrZXk7XHJcbiAgICB9XHJcbiAgICBpZiAoaXNOdWxsKHZOb2RlLmtleSkgfHwgdk5vZGUua2V5WzBdID09PSBcIi5cIikge1xyXG4gICAgICAgIHJldHVybiBhcHBseUtleShrZXksIHZOb2RlKTtcclxuICAgIH1cclxuICAgIHJldHVybiB2Tm9kZTtcclxufVxyXG5mdW5jdGlvbiBhcHBseUtleVByZWZpeChrZXksIHZOb2RlKSB7XHJcbiAgICB2Tm9kZS5rZXkgPSBrZXkgKyB2Tm9kZS5rZXk7XHJcbiAgICByZXR1cm4gdk5vZGU7XHJcbn1cclxuZnVuY3Rpb24gX25vcm1hbGl6ZVZOb2Rlcyhub2RlcywgcmVzdWx0LCBpbmRleCwgY3VycmVudEtleSkge1xyXG4gICAgZm9yICh2YXIgbGVuID0gbm9kZXMubGVuZ3RoOyBpbmRleCA8IGxlbjsgaW5kZXgrKykge1xyXG4gICAgICAgIHZhciBuID0gbm9kZXNbaW5kZXhdO1xyXG4gICAgICAgIHZhciBrZXkgPSBjdXJyZW50S2V5ICsgXCIuXCIgKyBpbmRleDtcclxuICAgICAgICBpZiAoIWlzSW52YWxpZChuKSkge1xyXG4gICAgICAgICAgICBpZiAoaXNBcnJheShuKSkge1xyXG4gICAgICAgICAgICAgICAgX25vcm1hbGl6ZVZOb2RlcyhuLCByZXN1bHQsIDAsIGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNTdHJpbmdPck51bWJlcihuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG4gPSBjcmVhdGVUZXh0Vk5vZGUobiwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICgoaXNWTm9kZShuKSAmJiBuLmRvbSkgfHwgKG4ua2V5ICYmIG4ua2V5WzBdID09PSBcIi5cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBuID0gZGlyZWN0Q2xvbmUobik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOdWxsKG4ua2V5KSB8fCBuLmtleVswXSA9PT0gXCIuXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBuID0gYXBwbHlLZXkoa2V5LCBuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG4gPSBhcHBseUtleVByZWZpeChjdXJyZW50S2V5LCBuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG5vcm1hbGl6ZVZOb2Rlcyhub2Rlcykge1xyXG4gICAgdmFyIG5ld05vZGVzO1xyXG4gICAgLy8gd2UgYXNzaWduICQgd2hpY2ggYmFzaWNhbGx5IG1lYW5zIHdlJ3ZlIGZsYWdnZWQgdGhpcyBhcnJheSBmb3IgZnV0dXJlIG5vdGVcclxuICAgIC8vIGlmIGl0IGNvbWVzIGJhY2sgYWdhaW4sIHdlIG5lZWQgdG8gY2xvbmUgaXQsIGFzIHBlb3BsZSBhcmUgdXNpbmcgaXRcclxuICAgIC8vIGluIGFuIGltbXV0YWJsZSB3YXlcclxuICAgIC8vIHRzbGludDpkaXNhYmxlXHJcbiAgICBpZiAobm9kZXNbXCIkXCJdID09PSB0cnVlKSB7XHJcbiAgICAgICAgbm9kZXMgPSBub2Rlcy5zbGljZSgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgbm9kZXNbXCIkXCJdID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIC8vIHRzbGludDplbmFibGVcclxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBub2Rlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgIHZhciBuID0gbm9kZXNbaV07XHJcbiAgICAgICAgaWYgKGlzSW52YWxpZChuKSB8fCBpc0FycmF5KG4pKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAobmV3Tm9kZXMgfHwgbm9kZXMpLnNsaWNlKDAsIGkpO1xyXG4gICAgICAgICAgICBfbm9ybWFsaXplVk5vZGVzKG5vZGVzLCByZXN1bHQsIGksIFwiXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChpc1N0cmluZ09yTnVtYmVyKG4pKSB7XHJcbiAgICAgICAgICAgIGlmICghbmV3Tm9kZXMpIHtcclxuICAgICAgICAgICAgICAgIG5ld05vZGVzID0gbm9kZXMuc2xpY2UoMCwgaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmV3Tm9kZXMucHVzaChhcHBseUtleUlmTWlzc2luZyhpLCBjcmVhdGVUZXh0Vk5vZGUobiwgbnVsbCkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoKGlzVk5vZGUobikgJiYgbi5kb20gIT09IG51bGwpIHx8XHJcbiAgICAgICAgICAgIChpc051bGwobi5rZXkpICYmIChuLmZsYWdzICYgNjQgLyogSGFzTm9uS2V5ZWRDaGlsZHJlbiAqLykgPT09IDApKSB7XHJcbiAgICAgICAgICAgIGlmICghbmV3Tm9kZXMpIHtcclxuICAgICAgICAgICAgICAgIG5ld05vZGVzID0gbm9kZXMuc2xpY2UoMCwgaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmV3Tm9kZXMucHVzaChhcHBseUtleUlmTWlzc2luZyhpLCBkaXJlY3RDbG9uZShuKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChuZXdOb2Rlcykge1xyXG4gICAgICAgICAgICBuZXdOb2Rlcy5wdXNoKGFwcGx5S2V5SWZNaXNzaW5nKGksIGRpcmVjdENsb25lKG4pKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ld05vZGVzIHx8IG5vZGVzO1xyXG59XHJcbmZ1bmN0aW9uIG5vcm1hbGl6ZUNoaWxkcmVuKGNoaWxkcmVuKSB7XHJcbiAgICBpZiAoaXNBcnJheShjaGlsZHJlbikpIHtcclxuICAgICAgICByZXR1cm4gbm9ybWFsaXplVk5vZGVzKGNoaWxkcmVuKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGlzVk5vZGUoY2hpbGRyZW4pICYmIGNoaWxkcmVuLmRvbSAhPT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiBkaXJlY3RDbG9uZShjaGlsZHJlbik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2hpbGRyZW47XHJcbn1cclxuZnVuY3Rpb24gbm9ybWFsaXplUHJvcHModk5vZGUsIHByb3BzLCBjaGlsZHJlbikge1xyXG4gICAgaWYgKHZOb2RlLmZsYWdzICYgMzk3MCAvKiBFbGVtZW50ICovKSB7XHJcbiAgICAgICAgaWYgKGlzTnVsbE9yVW5kZWYoY2hpbGRyZW4pICYmIHByb3BzLmhhc093blByb3BlcnR5KFwiY2hpbGRyZW5cIikpIHtcclxuICAgICAgICAgICAgdk5vZGUuY2hpbGRyZW4gPSBwcm9wcy5jaGlsZHJlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHByb3BzLmhhc093blByb3BlcnR5KFwiY2xhc3NOYW1lXCIpKSB7XHJcbiAgICAgICAgICAgIHZOb2RlLmNsYXNzTmFtZSA9IHByb3BzLmNsYXNzTmFtZSB8fCBudWxsO1xyXG4gICAgICAgICAgICBkZWxldGUgcHJvcHMuY2xhc3NOYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChwcm9wcy5oYXNPd25Qcm9wZXJ0eShcInJlZlwiKSkge1xyXG4gICAgICAgIHZOb2RlLnJlZiA9IHByb3BzLnJlZjtcclxuICAgICAgICBkZWxldGUgcHJvcHMucmVmO1xyXG4gICAgfVxyXG4gICAgaWYgKHByb3BzLmhhc093blByb3BlcnR5KFwia2V5XCIpKSB7XHJcbiAgICAgICAgdk5vZGUua2V5ID0gcHJvcHMua2V5O1xyXG4gICAgICAgIGRlbGV0ZSBwcm9wcy5rZXk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0RmxhZ3NGb3JFbGVtZW50Vm5vZGUodHlwZSkge1xyXG4gICAgaWYgKHR5cGUgPT09IFwic3ZnXCIpIHtcclxuICAgICAgICByZXR1cm4gMTI4IC8qIFN2Z0VsZW1lbnQgKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh0eXBlID09PSBcImlucHV0XCIpIHtcclxuICAgICAgICByZXR1cm4gNTEyIC8qIElucHV0RWxlbWVudCAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHR5cGUgPT09IFwic2VsZWN0XCIpIHtcclxuICAgICAgICByZXR1cm4gMjA0OCAvKiBTZWxlY3RFbGVtZW50ICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAodHlwZSA9PT0gXCJ0ZXh0YXJlYVwiKSB7XHJcbiAgICAgICAgcmV0dXJuIDEwMjQgLyogVGV4dGFyZWFFbGVtZW50ICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAodHlwZSA9PT0gXCJtZWRpYVwiKSB7XHJcbiAgICAgICAgcmV0dXJuIDI1NiAvKiBNZWRpYUVsZW1lbnQgKi87XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMiAvKiBIdG1sRWxlbWVudCAqLztcclxufVxyXG5mdW5jdGlvbiBub3JtYWxpemUodk5vZGUpIHtcclxuICAgIHZhciBwcm9wcyA9IHZOb2RlLnByb3BzO1xyXG4gICAgdmFyIGNoaWxkcmVuID0gdk5vZGUuY2hpbGRyZW47XHJcbiAgICAvLyBjb252ZXJ0IGEgd3JvbmdseSBjcmVhdGVkIHR5cGUgYmFjayB0byBlbGVtZW50XHJcbiAgICAvLyBQcmltaXRpdmUgbm9kZSBkb2Vzbid0IGhhdmUgZGVmYXVsdFByb3BzLCBvbmx5IENvbXBvbmVudFxyXG4gICAgaWYgKHZOb2RlLmZsYWdzICYgMjggLyogQ29tcG9uZW50ICovKSB7XHJcbiAgICAgICAgLy8gc2V0IGRlZmF1bHQgcHJvcHNcclxuICAgICAgICB2YXIgdHlwZSA9IHZOb2RlLnR5cGU7XHJcbiAgICAgICAgdmFyIGRlZmF1bHRQcm9wcyA9IHR5cGUuZGVmYXVsdFByb3BzO1xyXG4gICAgICAgIGlmICghaXNOdWxsT3JVbmRlZihkZWZhdWx0UHJvcHMpKSB7XHJcbiAgICAgICAgICAgIGlmICghcHJvcHMpIHtcclxuICAgICAgICAgICAgICAgIHByb3BzID0gdk5vZGUucHJvcHMgPSBkZWZhdWx0UHJvcHM7IC8vIENyZWF0ZSBuZXcgb2JqZWN0IGlmIG9ubHkgZGVmYXVsdFByb3BzIGdpdmVuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGRlZmF1bHRQcm9wcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1VuZGVmaW5lZChwcm9wc1twcm9wXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHNbcHJvcF0gPSBkZWZhdWx0UHJvcHNbcHJvcF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc1N0cmluZyh0eXBlKSkge1xyXG4gICAgICAgICAgICB2Tm9kZS5mbGFncyA9IGdldEZsYWdzRm9yRWxlbWVudFZub2RlKHR5cGUpO1xyXG4gICAgICAgICAgICBpZiAocHJvcHMgJiYgcHJvcHMuY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgIHZOb2RlLmNoaWxkcmVuID0gcHJvcHMuY2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IHByb3BzLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHByb3BzKSB7XHJcbiAgICAgICAgbm9ybWFsaXplUHJvcHModk5vZGUsIHByb3BzLCBjaGlsZHJlbik7XHJcbiAgICAgICAgaWYgKCFpc0ludmFsaWQocHJvcHMuY2hpbGRyZW4pKSB7XHJcbiAgICAgICAgICAgIHByb3BzLmNoaWxkcmVuID0gbm9ybWFsaXplQ2hpbGRyZW4ocHJvcHMuY2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICghaXNJbnZhbGlkKGNoaWxkcmVuKSkge1xyXG4gICAgICAgIHZOb2RlLmNoaWxkcmVuID0gbm9ybWFsaXplQ2hpbGRyZW4oY2hpbGRyZW4pO1xyXG4gICAgfVxyXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgICAgIC8vIFRoaXMgY29kZSB3aWxsIGJlIHN0cmlwcGVkIG91dCBmcm9tIHByb2R1Y3Rpb24gQ09ERVxyXG4gICAgICAgIC8vIEl0IGhlbHBzIHVzZXJzIHRvIHRyYWNrIGVycm9ycyBpbiB0aGVpciBhcHBsaWNhdGlvbnMuXHJcbiAgICAgICAgdmFyIHZlcmlmeUtleXMgPSBmdW5jdGlvbiAodk5vZGVzKSB7XHJcbiAgICAgICAgICAgIHZhciBrZXlWYWx1ZXMgPSB2Tm9kZXMubWFwKChmdW5jdGlvbiAodm5vZGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2bm9kZS5rZXk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAga2V5VmFsdWVzLnNvbWUoKGZ1bmN0aW9uIChpdGVtLCBpZHgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBoYXNEdXBsaWNhdGUgPSBrZXlWYWx1ZXMuaW5kZXhPZihpdGVtKSAhPT0gaWR4O1xyXG4gICAgICAgICAgICAgICAgaWYgKGhhc0R1cGxpY2F0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdhcm5pbmcoXCJJbmZlcm5vIG5vcm1hbGlzYXRpb24oLi4uKTogRW5jb3VudGVyZWQgdHdvIGNoaWxkcmVuIHdpdGggc2FtZSBrZXksIGFsbCBrZXlzIG11c3QgYmUgdW5pcXVlIHdpdGhpbiBpdHMgc2libGluZ3MuIER1cGxpY2F0ZWQga2V5IGlzOlwiICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFzRHVwbGljYXRlO1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAodk5vZGUuY2hpbGRyZW4gJiYgQXJyYXkuaXNBcnJheSh2Tm9kZS5jaGlsZHJlbikpIHtcclxuICAgICAgICAgICAgdmVyaWZ5S2V5cyh2Tm9kZS5jaGlsZHJlbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbW9kdWxlIEluZmVybm9cclxuICovIC8qKiBUeXBlRG9jIENvbW1lbnQgKi9cclxuLyoqXHJcbiAqIExpbmtzIGdpdmVuIGRhdGEgdG8gZXZlbnQgYXMgZmlyc3QgcGFyYW1ldGVyXHJcbiAqIEBwYXJhbSB7Kn0gZGF0YSBkYXRhIHRvIGJlIGxpbmtlZCwgaXQgd2lsbCBiZSBhdmFpbGFibGUgaW4gZnVuY3Rpb24gYXMgZmlyc3QgcGFyYW1ldGVyXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGV2ZW50IEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIGV2ZW50IG9jY3Vyc1xyXG4gKiBAcmV0dXJucyB7e2RhdGE6ICosIGV2ZW50OiBGdW5jdGlvbn19XHJcbiAqL1xyXG5mdW5jdGlvbiBsaW5rRXZlbnQoZGF0YSwgZXZlbnQpIHtcclxuICAgIGlmIChpc0Z1bmN0aW9uKGV2ZW50KSkge1xyXG4gICAgICAgIHJldHVybiB7IGRhdGE6IGRhdGEsIGV2ZW50OiBldmVudCB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7IC8vIFJldHVybiBudWxsIHdoZW4gZXZlbnQgaXMgaW52YWxpZCwgdG8gYXZvaWQgY3JlYXRpbmcgdW5uZWNlc3NhcnkgZXZlbnQgaGFuZGxlcnNcclxufVxuXG4vKipcclxuICogQG1vZHVsZSBJbmZlcm5vXHJcbiAqLyAvKiogVHlwZURvYyBDb21tZW50ICovXHJcbi8qIHRzbGludDpkaXNhYmxlOm9iamVjdC1saXRlcmFsLXNvcnQta2V5cyAqL1xyXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XHJcbiAgICAvKiB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tZW1wdHkgKi9cclxuICAgIHZhciB0ZXN0RnVuYyA9IGZ1bmN0aW9uIHRlc3RGbigpIHsgfTtcclxuICAgIGlmICgodGVzdEZ1bmMubmFtZSB8fCB0ZXN0RnVuYy50b1N0cmluZygpKS5pbmRleE9mKFwidGVzdEZuXCIpID09PVxyXG4gICAgICAgIC0xKSB7XHJcbiAgICAgICAgd2FybmluZyhcIkl0IGxvb2tzIGxpa2UgeW91J3JlIHVzaW5nIGEgbWluaWZpZWQgY29weSBvZiB0aGUgZGV2ZWxvcG1lbnQgYnVpbGQgXCIgK1xyXG4gICAgICAgICAgICBcIm9mIEluZmVybm8uIFdoZW4gZGVwbG95aW5nIEluZmVybm8gYXBwcyB0byBwcm9kdWN0aW9uLCBtYWtlIHN1cmUgdG8gdXNlIFwiICtcclxuICAgICAgICAgICAgXCJ0aGUgcHJvZHVjdGlvbiBidWlsZCB3aGljaCBza2lwcyBkZXZlbG9wbWVudCB3YXJuaW5ncyBhbmQgaXMgZmFzdGVyLiBcIiArXHJcbiAgICAgICAgICAgIFwiU2VlIGh0dHA6Ly9pbmZlcm5vanMub3JnIGZvciBtb3JlIGRldGFpbHMuXCIpO1xyXG4gICAgfVxyXG59XHJcbnZhciB2ZXJzaW9uID0gXCIzLjcuMVwiO1xyXG4vLyB3ZSBkdXBsaWNhdGUgaXQgc28gaXQgcGxheXMgbmljZWx5IHdpdGggZGlmZmVyZW50IG1vZHVsZSBsb2FkaW5nIHN5c3RlbXNcclxudmFyIGluZGV4ID0ge1xyXG4gICAgRU1QVFlfT0JKOiBFTVBUWV9PQkosXHJcbiAgICBOT19PUDogTk9fT1AsXHJcbiAgICBjbG9uZVZOb2RlOiBjbG9uZVZOb2RlLFxyXG4gICAgY3JlYXRlUmVuZGVyZXI6IGNyZWF0ZVJlbmRlcmVyLFxyXG4gICAgY3JlYXRlVk5vZGU6IGNyZWF0ZVZOb2RlLFxyXG4gICAgZmluZERPTU5vZGU6IGZpbmRET01Ob2RlLFxyXG4gICAgZ2V0RmxhZ3NGb3JFbGVtZW50Vm5vZGU6IGdldEZsYWdzRm9yRWxlbWVudFZub2RlLFxyXG4gICAgaW50ZXJuYWxfRE9NTm9kZU1hcDogY29tcG9uZW50VG9ET01Ob2RlTWFwLFxyXG4gICAgaW50ZXJuYWxfaXNVbml0bGVzc051bWJlcjogaXNVbml0bGVzc051bWJlcixcclxuICAgIGludGVybmFsX25vcm1hbGl6ZTogbm9ybWFsaXplLFxyXG4gICAgaW50ZXJuYWxfcGF0Y2g6IHBhdGNoLFxyXG4gICAgbGlua0V2ZW50OiBsaW5rRXZlbnQsXHJcbiAgICBvcHRpb25zOiBvcHRpb25zLFxyXG4gICAgcmVuZGVyOiByZW5kZXIsXHJcbiAgICB2ZXJzaW9uOiB2ZXJzaW9uXHJcbn07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IGluZGV4O1xuZXhwb3J0cy5FTVBUWV9PQkogPSBFTVBUWV9PQko7XG5leHBvcnRzLk5PX09QID0gTk9fT1A7XG5leHBvcnRzLmNsb25lVk5vZGUgPSBjbG9uZVZOb2RlO1xuZXhwb3J0cy5jcmVhdGVSZW5kZXJlciA9IGNyZWF0ZVJlbmRlcmVyO1xuZXhwb3J0cy5jcmVhdGVWTm9kZSA9IGNyZWF0ZVZOb2RlO1xuZXhwb3J0cy5maW5kRE9NTm9kZSA9IGZpbmRET01Ob2RlO1xuZXhwb3J0cy5nZXRGbGFnc0ZvckVsZW1lbnRWbm9kZSA9IGdldEZsYWdzRm9yRWxlbWVudFZub2RlO1xuZXhwb3J0cy5pbnRlcm5hbF9ET01Ob2RlTWFwID0gY29tcG9uZW50VG9ET01Ob2RlTWFwO1xuZXhwb3J0cy5pbnRlcm5hbF9pc1VuaXRsZXNzTnVtYmVyID0gaXNVbml0bGVzc051bWJlcjtcbmV4cG9ydHMuaW50ZXJuYWxfbm9ybWFsaXplID0gbm9ybWFsaXplO1xuZXhwb3J0cy5pbnRlcm5hbF9wYXRjaCA9IHBhdGNoO1xuZXhwb3J0cy5saW5rRXZlbnQgPSBsaW5rRXZlbnQ7XG5leHBvcnRzLm9wdGlvbnMgPSBvcHRpb25zO1xuZXhwb3J0cy5yZW5kZXIgPSByZW5kZXI7XG5leHBvcnRzLnZlcnNpb24gPSB2ZXJzaW9uO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9ub2RlX21vZHVsZXMvaW5mZXJuby9kaXN0L2luZGV4LmpzXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImltcG9ydCBJbmZlcm5vIGZyb20gJ2luZmVybm8nXG5pbXBvcnQgQ29tcG9uZW50IGZyb20gJ2luZmVybm8tY29tcG9uZW50J1xuXG5jbGFzcyBGdXp6eUdhbWVPZkxpZmUgZXh0ZW5kcyBDb21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKVxuXG4gICAgY29uc3QgZmllbGQgPSBbXVxuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgcHJvcHMuaGVpZ2h0OyArK3kpIHtcbiAgICAgIGNvbnN0IHJvdyA9IFtdXG4gICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHByb3BzLndpZHRoOyArK3gpIHtcbiAgICAgICAgcm93LnB1c2goTWF0aC5yYW5kb20oKSlcbiAgICAgIH1cbiAgICAgIGZpZWxkLnB1c2gocm93KVxuICAgIH1cblxuICAgIHRoaXMuc3RhdGUgPSB7IGZpZWxkIH1cbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy50aWNrKCkpXG4gIH1cblxuICB0aWNrKCkge1xuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IHsgZmllbGQgfSA9IHRoaXMuc3RhdGVcbiAgICBjb25zdCBuZXh0RmllbGQgPSBbXVxuXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLnByb3BzLmhlaWdodDsgKyt5KSB7XG4gICAgICBjb25zdCBuZXh0Um93ID0gW11cbiAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy5wcm9wcy53aWR0aDsgKyt4KSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDZWxsID0gZmllbGRbeV1beF1cbiAgICAgICAgbGV0IG5leHRDZWxsID0gMFxuXG4gICAgICAgIGNvbnN0IG5laWdoYm9ycyA9IGZpZWxkWyh5K2hlaWdodC0xKSVoZWlnaHRdWyh4K3dpZHRoLTEpJXdpZHRoXVxuICAgICAgICAgICAgICAgICAgICAgICAgKyBmaWVsZFsoeStoZWlnaHQtMSklaGVpZ2h0XVt4ICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICsgZmllbGRbKHkraGVpZ2h0LTEpJWhlaWdodF1bKHgrMSkld2lkdGggICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICArIGZpZWxkW3kgICAgICAgICAgICAgICAgICBdWyh4K3dpZHRoLTEpJXdpZHRoXVxuICAgICAgICAgICAgICAgICAgICAgICAgKyBmaWVsZFt5ICAgICAgICAgICAgICAgICAgXVsoeCsxKSV3aWR0aCAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICsgZmllbGRbKHkrMSklaGVpZ2h0ICAgICAgIF1bKHgrd2lkdGgtMSkld2lkdGhdXG4gICAgICAgICAgICAgICAgICAgICAgICArIGZpZWxkWyh5KzEpJWhlaWdodCAgICAgICBdW3ggICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgKyBmaWVsZFsoeSsxKSVoZWlnaHQgICAgICAgXVsoeCsxKSV3aWR0aCAgICAgIF1cblxuICAgICAgICBpZiAobmVpZ2hib3JzIDw9IDEpIG5leHRDZWxsID0gMFxuICAgICAgICBlbHNlIGlmICgxIDwgbmVpZ2hib3JzICYmIG5laWdoYm9ycyA8PSAyKSBuZXh0Q2VsbCA9IChuZWlnaGJvcnMgLSAxKSAqIGN1cnJlbnRDZWxsXG4gICAgICAgIGVsc2UgaWYgKDIgPCBuZWlnaGJvcnMgJiYgbmVpZ2hib3JzIDw9IDMpIG5leHRDZWxsID0gY3VycmVudENlbGwgKyAobmVpZ2hib3JzIC0gMikgKiAoMSAtIGN1cnJlbnRDZWxsKVxuICAgICAgICBlbHNlIGlmICgzIDwgbmVpZ2hib3JzICYmIG5laWdoYm9ycyA8PSA0KSBuZXh0Q2VsbCA9IDQgLSBuZWlnaGJvcnNcbiAgICAgICAgZWxzZSBpZiAoNCA8IG5laWdoYm9ycykgbmV4dENlbGwgPSAwXG5cbiAgICAgICAgbmV4dFJvdy5wdXNoKG5leHRDZWxsKVxuICAgICAgfVxuICAgICAgbmV4dEZpZWxkLnB1c2gobmV4dFJvdylcbiAgICB9XG5cbiAgICB0aGlzLnNldFN0YXRlKHsgZmllbGQ6IG5leHRGaWVsZCB9KVxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy50aWNrKCkpXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBzdHlsZSB9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IHsgZmllbGQgfSA9IHRoaXMuc3RhdGVcblxuICAgIHJldHVybiAoXG4gICAgICA8c3ZnIHZpZXdCb3g9eyBgMCAwICR7IHdpZHRoIH0gJHsgaGVpZ2h0IH1gIH0gc3R5bGU9eyBzdHlsZSB9PlxuICAgICAgICB7IHRoaXMuc3RhdGUuZmllbGQubWFwKChyb3csIHkpID0+IHJvdy5tYXAoKGNlbGwsIHgpID0+IDxyZWN0IHg9eyB4IH0geT17IHkgfSB3aWR0aD17IDEgfSBoZWlnaHQ9eyAxIH0gZmlsbD17IGByZ2JhKDAsMCwwLCR7IGNlbGwgfSlgIH0gLz4pKSB9XG4gICAgICA8L3N2Zz5cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRnV6enlHYW1lT2ZMaWZlXG4vLyB2aW06IHNldCB0cz0yIHN3PTIgZXQ6XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvRnV6enlHYW1lT2ZMaWZlLmpzIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL2Rpc3QnKS5kZWZhdWx0O1xubW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL25vZGVfbW9kdWxlcy9pbmZlcm5vLWNvbXBvbmVudC9pbmRleC5qc1xuLy8gbW9kdWxlIGlkID0gNFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG5cbnZhciBpbmZlcm5vID0gcmVxdWlyZSgnaW5mZXJubycpO1xuXG4vKipcclxuICogQG1vZHVsZSBJbmZlcm5vLVNoYXJlZFxyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG52YXIgTk9fT1AgPSBcIiROT19PUFwiO1xyXG52YXIgRVJST1JfTVNHID0gXCJhIHJ1bnRpbWUgZXJyb3Igb2NjdXJlZCEgVXNlIEluZmVybm8gaW4gZGV2ZWxvcG1lbnQgZW52aXJvbm1lbnQgdG8gZmluZCB0aGUgZXJyb3IuXCI7XHJcbi8vIFRoaXMgc2hvdWxkIGJlIGJvb2xlYW4gYW5kIG5vdCByZWZlcmVuY2UgdG8gd2luZG93LmRvY3VtZW50XHJcbnZhciBpc0Jyb3dzZXIgPSAhISh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvdy5kb2N1bWVudCk7XHJcbi8vIHRoaXMgaXMgTVVDSCBmYXN0ZXIgdGhhbiAuY29uc3RydWN0b3IgPT09IEFycmF5IGFuZCBpbnN0YW5jZW9mIEFycmF5XHJcbi8vIGluIE5vZGUgNyBhbmQgdGhlIGxhdGVyIHZlcnNpb25zIG9mIFY4LCBzbG93ZXIgaW4gb2xkZXIgdmVyc2lvbnMgdGhvdWdoXHJcbnZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheTtcclxuZnVuY3Rpb24gaXNTdHJpbmdPck51bWJlcihvKSB7XHJcbiAgICB2YXIgdHlwZSA9IHR5cGVvZiBvO1xyXG4gICAgcmV0dXJuIHR5cGUgPT09IFwic3RyaW5nXCIgfHwgdHlwZSA9PT0gXCJudW1iZXJcIjtcclxufVxyXG5mdW5jdGlvbiBpc051bGxPclVuZGVmKG8pIHtcclxuICAgIHJldHVybiBpc1VuZGVmaW5lZChvKSB8fCBpc051bGwobyk7XHJcbn1cclxuZnVuY3Rpb24gaXNJbnZhbGlkKG8pIHtcclxuICAgIHJldHVybiBpc051bGwobykgfHwgbyA9PT0gZmFsc2UgfHwgaXNUcnVlKG8pIHx8IGlzVW5kZWZpbmVkKG8pO1xyXG59XHJcbmZ1bmN0aW9uIGlzRnVuY3Rpb24obykge1xyXG4gICAgcmV0dXJuIHR5cGVvZiBvID09PSBcImZ1bmN0aW9uXCI7XHJcbn1cclxuZnVuY3Rpb24gaXNOdWxsKG8pIHtcclxuICAgIHJldHVybiBvID09PSBudWxsO1xyXG59XHJcbmZ1bmN0aW9uIGlzVHJ1ZShvKSB7XHJcbiAgICByZXR1cm4gbyA9PT0gdHJ1ZTtcclxufVxyXG5mdW5jdGlvbiBpc1VuZGVmaW5lZChvKSB7XHJcbiAgICByZXR1cm4gbyA9PT0gdm9pZCAwO1xyXG59XHJcbmZ1bmN0aW9uIHRocm93RXJyb3IobWVzc2FnZSkge1xyXG4gICAgaWYgKCFtZXNzYWdlKSB7XHJcbiAgICAgICAgbWVzc2FnZSA9IEVSUk9SX01TRztcclxuICAgIH1cclxuICAgIHRocm93IG5ldyBFcnJvcigoXCJJbmZlcm5vIEVycm9yOiBcIiArIG1lc3NhZ2UpKTtcclxufVxyXG5mdW5jdGlvbiBjb21iaW5lRnJvbShmaXJzdCwgc2Vjb25kKSB7XHJcbiAgICB2YXIgb3V0ID0ge307XHJcbiAgICBpZiAoZmlyc3QpIHtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gZmlyc3QpIHtcclxuICAgICAgICAgICAgb3V0W2tleV0gPSBmaXJzdFtrZXldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChzZWNvbmQpIHtcclxuICAgICAgICBmb3IgKHZhciBrZXkkMSBpbiBzZWNvbmQpIHtcclxuICAgICAgICAgICAgb3V0W2tleSQxXSA9IHNlY29uZFtrZXkkMV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dDtcclxufVxuXG4vKipcclxuICogQG1vZHVsZSBJbmZlcm5vLUNvbXBvbmVudFxyXG4gKi8gLyoqIFR5cGVEb2MgQ29tbWVudCAqL1xyXG4vLyBNYWtlIHN1cmUgdSB1c2UgRU1QVFlfT0JKIGZyb20gJ2luZmVybm8nLCBvdGhlcndpc2UgaXQnbGwgYmUgYSBkaWZmZXJlbnQgcmVmZXJlbmNlXHJcbnZhciBub09wID0gRVJST1JfTVNHO1xyXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XHJcbiAgICBub09wID1cclxuICAgICAgICBcIkluZmVybm8gRXJyb3I6IENhbiBvbmx5IHVwZGF0ZSBhIG1vdW50ZWQgb3IgbW91bnRpbmcgY29tcG9uZW50LiBUaGlzIHVzdWFsbHkgbWVhbnMgeW91IGNhbGxlZCBzZXRTdGF0ZSgpIG9yIGZvcmNlVXBkYXRlKCkgb24gYW4gdW5tb3VudGVkIGNvbXBvbmVudC4gVGhpcyBpcyBhIG5vLW9wLlwiO1xyXG59XHJcbnZhciBjb21wb25lbnRDYWxsYmFja1F1ZXVlID0gbmV3IE1hcCgpO1xyXG4vLyB3aGVuIGEgY29tcG9uZW50cyByb290IFZOb2RlIGlzIGFsc28gYSBjb21wb25lbnQsIHdlIGNhbiBydW4gaW50byBpc3N1ZXNcclxuLy8gdGhpcyB3aWxsIHJlY3Vyc2l2ZWx5IGxvb2sgZm9yIHZOb2RlLnBhcmVudE5vZGUgaWYgdGhlIFZOb2RlIGlzIGEgY29tcG9uZW50XHJcbmZ1bmN0aW9uIHVwZGF0ZVBhcmVudENvbXBvbmVudFZOb2Rlcyh2Tm9kZSwgZG9tKSB7XHJcbiAgICBpZiAodk5vZGUuZmxhZ3MgJiAyOCAvKiBDb21wb25lbnQgKi8pIHtcclxuICAgICAgICB2YXIgcGFyZW50Vk5vZGUgPSB2Tm9kZS5wYXJlbnRWTm9kZTtcclxuICAgICAgICBpZiAocGFyZW50Vk5vZGUpIHtcclxuICAgICAgICAgICAgcGFyZW50Vk5vZGUuZG9tID0gZG9tO1xyXG4gICAgICAgICAgICB1cGRhdGVQYXJlbnRDb21wb25lbnRWTm9kZXMocGFyZW50Vk5vZGUsIGRvbSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbnZhciByZXNvbHZlZFByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTtcclxuZnVuY3Rpb24gYWRkVG9RdWV1ZShjb21wb25lbnQsIGZvcmNlLCBjYWxsYmFjaykge1xyXG4gICAgdmFyIHF1ZXVlID0gY29tcG9uZW50Q2FsbGJhY2tRdWV1ZS5nZXQoY29tcG9uZW50KTtcclxuICAgIGlmIChxdWV1ZSA9PT0gdm9pZCAwKSB7XHJcbiAgICAgICAgcXVldWUgPSBbXTtcclxuICAgICAgICBjb21wb25lbnRDYWxsYmFja1F1ZXVlLnNldChjb21wb25lbnQsIHF1ZXVlKTtcclxuICAgICAgICByZXNvbHZlZFByb21pc2UudGhlbigoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb21wb25lbnRDYWxsYmFja1F1ZXVlLmRlbGV0ZShjb21wb25lbnQpO1xyXG4gICAgICAgICAgICBjb21wb25lbnQuX3VwZGF0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgYXBwbHlTdGF0ZShjb21wb25lbnQsIGZvcmNlLCAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHF1ZXVlLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0uY2FsbChjb21wb25lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIGNvbXBvbmVudC5fdXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbiAgICBpZiAoIWlzTnVsbE9yVW5kZWYoY2FsbGJhY2spKSB7XHJcbiAgICAgICAgcXVldWUucHVzaChjYWxsYmFjayk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcXVldWVTdGF0ZUNoYW5nZXMoY29tcG9uZW50LCBuZXdTdGF0ZSwgY2FsbGJhY2spIHtcclxuICAgIGlmIChpc0Z1bmN0aW9uKG5ld1N0YXRlKSkge1xyXG4gICAgICAgIG5ld1N0YXRlID0gbmV3U3RhdGUoY29tcG9uZW50LnN0YXRlLCBjb21wb25lbnQucHJvcHMsIGNvbXBvbmVudC5jb250ZXh0KTtcclxuICAgIH1cclxuICAgIHZhciBwZW5kaW5nID0gY29tcG9uZW50Ll9wZW5kaW5nU3RhdGU7XHJcbiAgICBpZiAoaXNOdWxsT3JVbmRlZihwZW5kaW5nKSkge1xyXG4gICAgICAgIGNvbXBvbmVudC5fcGVuZGluZ1N0YXRlID0gcGVuZGluZyA9IG5ld1N0YXRlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgZm9yICh2YXIgc3RhdGVLZXkgaW4gbmV3U3RhdGUpIHtcclxuICAgICAgICAgICAgcGVuZGluZ1tzdGF0ZUtleV0gPSBuZXdTdGF0ZVtzdGF0ZUtleV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGlzQnJvd3NlciAmJiAhY29tcG9uZW50Ll9wZW5kaW5nU2V0U3RhdGUgJiYgIWNvbXBvbmVudC5fYmxvY2tSZW5kZXIpIHtcclxuICAgICAgICBpZiAoIWNvbXBvbmVudC5fdXBkYXRpbmcpIHtcclxuICAgICAgICAgICAgY29tcG9uZW50Ll9wZW5kaW5nU2V0U3RhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBjb21wb25lbnQuX3VwZGF0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgYXBwbHlTdGF0ZShjb21wb25lbnQsIGZhbHNlLCBjYWxsYmFjayk7XHJcbiAgICAgICAgICAgIGNvbXBvbmVudC5fdXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGFkZFRvUXVldWUoY29tcG9uZW50LCBmYWxzZSwgY2FsbGJhY2spO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHZhciBzdGF0ZSA9IGNvbXBvbmVudC5zdGF0ZTtcclxuICAgICAgICBpZiAoc3RhdGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgY29tcG9uZW50LnN0YXRlID0gcGVuZGluZztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwZW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBzdGF0ZVtrZXldID0gcGVuZGluZ1trZXldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbXBvbmVudC5fcGVuZGluZ1N0YXRlID0gbnVsbDtcclxuICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWYoY2FsbGJhY2spICYmIGNvbXBvbmVudC5fYmxvY2tSZW5kZXIpIHtcclxuICAgICAgICAgICAgY29tcG9uZW50Ll9saWZlY3ljbGUuYWRkTGlzdGVuZXIoY2FsbGJhY2suYmluZChjb21wb25lbnQpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gYXBwbHlTdGF0ZShjb21wb25lbnQsIGZvcmNlLCBjYWxsYmFjaykge1xyXG4gICAgaWYgKGNvbXBvbmVudC5fdW5tb3VudGVkKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGZvcmNlIHx8ICFjb21wb25lbnQuX2Jsb2NrUmVuZGVyKSB7XHJcbiAgICAgICAgY29tcG9uZW50Ll9wZW5kaW5nU2V0U3RhdGUgPSBmYWxzZTtcclxuICAgICAgICB2YXIgcGVuZGluZ1N0YXRlID0gY29tcG9uZW50Ll9wZW5kaW5nU3RhdGU7XHJcbiAgICAgICAgdmFyIHByZXZTdGF0ZSA9IGNvbXBvbmVudC5zdGF0ZTtcclxuICAgICAgICB2YXIgbmV4dFN0YXRlID0gY29tYmluZUZyb20ocHJldlN0YXRlLCBwZW5kaW5nU3RhdGUpO1xyXG4gICAgICAgIHZhciBwcm9wcyA9IGNvbXBvbmVudC5wcm9wcztcclxuICAgICAgICB2YXIgY29udGV4dCA9IGNvbXBvbmVudC5jb250ZXh0O1xyXG4gICAgICAgIGNvbXBvbmVudC5fcGVuZGluZ1N0YXRlID0gbnVsbDtcclxuICAgICAgICB2YXIgbmV4dElucHV0ID0gY29tcG9uZW50Ll91cGRhdGVDb21wb25lbnQocHJldlN0YXRlLCBuZXh0U3RhdGUsIHByb3BzLCBwcm9wcywgY29udGV4dCwgZm9yY2UsIHRydWUpO1xyXG4gICAgICAgIHZhciBkaWRVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgIGlmIChpc0ludmFsaWQobmV4dElucHV0KSkge1xyXG4gICAgICAgICAgICBuZXh0SW5wdXQgPSBpbmZlcm5vLmNyZWF0ZVZOb2RlKDQwOTYgLyogVm9pZCAqLywgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG5leHRJbnB1dCA9PT0gTk9fT1ApIHtcclxuICAgICAgICAgICAgbmV4dElucHV0ID0gY29tcG9uZW50Ll9sYXN0SW5wdXQ7XHJcbiAgICAgICAgICAgIGRpZFVwZGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChpc1N0cmluZ09yTnVtYmVyKG5leHRJbnB1dCkpIHtcclxuICAgICAgICAgICAgbmV4dElucHV0ID0gaW5mZXJuby5jcmVhdGVWTm9kZSgxIC8qIFRleHQgKi8sIG51bGwsIG51bGwsIG5leHRJbnB1dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGlzQXJyYXkobmV4dElucHV0KSkge1xyXG4gICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKFwiYSB2YWxpZCBJbmZlcm5vIFZOb2RlIChvciBudWxsKSBtdXN0IGJlIHJldHVybmVkIGZyb20gYSBjb21wb25lbnQgcmVuZGVyLiBZb3UgbWF5IGhhdmUgcmV0dXJuZWQgYW4gYXJyYXkgb3IgYW4gaW52YWxpZCBvYmplY3QuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRocm93RXJyb3IoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGxhc3RJbnB1dCA9IGNvbXBvbmVudC5fbGFzdElucHV0O1xyXG4gICAgICAgIHZhciB2Tm9kZSA9IGNvbXBvbmVudC5fdk5vZGU7XHJcbiAgICAgICAgdmFyIHBhcmVudERvbSA9IChsYXN0SW5wdXQuZG9tICYmIGxhc3RJbnB1dC5kb20ucGFyZW50Tm9kZSkgfHxcclxuICAgICAgICAgICAgKGxhc3RJbnB1dC5kb20gPSB2Tm9kZS5kb20pO1xyXG4gICAgICAgIGNvbXBvbmVudC5fbGFzdElucHV0ID0gbmV4dElucHV0O1xyXG4gICAgICAgIGlmIChkaWRVcGRhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGNoaWxkQ29udGV4dDtcclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmKGNvbXBvbmVudC5nZXRDaGlsZENvbnRleHQpKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZENvbnRleHQgPSBjb21wb25lbnQuZ2V0Q2hpbGRDb250ZXh0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlzTnVsbE9yVW5kZWYoY2hpbGRDb250ZXh0KSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRDb250ZXh0ID0gY29tcG9uZW50Ll9jaGlsZENvbnRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZENvbnRleHQgPSBjb21iaW5lRnJvbShjb250ZXh0LCBjaGlsZENvbnRleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBsaWZlQ3ljbGUgPSBjb21wb25lbnQuX2xpZmVjeWNsZTtcclxuICAgICAgICAgICAgaW5mZXJuby5pbnRlcm5hbF9wYXRjaChsYXN0SW5wdXQsIG5leHRJbnB1dCwgcGFyZW50RG9tLCBsaWZlQ3ljbGUsIGNoaWxkQ29udGV4dCwgY29tcG9uZW50Ll9pc1NWRywgZmFsc2UpO1xyXG4gICAgICAgICAgICBsaWZlQ3ljbGUudHJpZ2dlcigpO1xyXG4gICAgICAgICAgICBpZiAoIWlzTnVsbE9yVW5kZWYoY29tcG9uZW50LmNvbXBvbmVudERpZFVwZGF0ZSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jb21wb25lbnREaWRVcGRhdGUocHJvcHMsIHByZXZTdGF0ZSwgY29udGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFpc051bGwoaW5mZXJuby5vcHRpb25zLmFmdGVyVXBkYXRlKSkge1xyXG4gICAgICAgICAgICAgICAgaW5mZXJuby5vcHRpb25zLmFmdGVyVXBkYXRlKHZOb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZG9tID0gKHZOb2RlLmRvbSA9IG5leHRJbnB1dC5kb20pO1xyXG4gICAgICAgIGlmIChpbmZlcm5vLm9wdGlvbnMuZmluZERPTU5vZGVFbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGluZmVybm8uaW50ZXJuYWxfRE9NTm9kZU1hcC5zZXQoY29tcG9uZW50LCBuZXh0SW5wdXQuZG9tKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlUGFyZW50Q29tcG9uZW50Vk5vZGVzKHZOb2RlLCBkb20pO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgY29tcG9uZW50LnN0YXRlID0gY29tcG9uZW50Ll9wZW5kaW5nU3RhdGU7XHJcbiAgICAgICAgY29tcG9uZW50Ll9wZW5kaW5nU3RhdGUgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKCFpc051bGxPclVuZGVmKGNhbGxiYWNrKSkge1xyXG4gICAgICAgIGNhbGxiYWNrLmNhbGwoY29tcG9uZW50KTtcclxuICAgIH1cclxufVxyXG52YXIgYWxyZWFkeVdhcm5lZCA9IGZhbHNlO1xyXG52YXIgQ29tcG9uZW50ID0gZnVuY3Rpb24gQ29tcG9uZW50KHByb3BzLCBjb250ZXh0KSB7XHJcbiAgICB0aGlzLnN0YXRlID0gbnVsbDtcclxuICAgIHRoaXMuX2Jsb2NrUmVuZGVyID0gZmFsc2U7XHJcbiAgICB0aGlzLl9ibG9ja1NldFN0YXRlID0gdHJ1ZTtcclxuICAgIHRoaXMuX3BlbmRpbmdTZXRTdGF0ZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5fcGVuZGluZ1N0YXRlID0gbnVsbDtcclxuICAgIHRoaXMuX2xhc3RJbnB1dCA9IG51bGw7XHJcbiAgICB0aGlzLl92Tm9kZSA9IG51bGw7XHJcbiAgICB0aGlzLl91bm1vdW50ZWQgPSBmYWxzZTtcclxuICAgIHRoaXMuX2xpZmVjeWNsZSA9IG51bGw7XHJcbiAgICB0aGlzLl9jaGlsZENvbnRleHQgPSBudWxsO1xyXG4gICAgdGhpcy5faXNTVkcgPSBmYWxzZTtcclxuICAgIHRoaXMuX3VwZGF0aW5nID0gdHJ1ZTtcclxuICAgIC8qKiBAdHlwZSB7b2JqZWN0fSAqL1xyXG4gICAgdGhpcy5wcm9wcyA9IHByb3BzIHx8IGluZmVybm8uRU1QVFlfT0JKO1xyXG4gICAgLyoqIEB0eXBlIHtvYmplY3R9ICovXHJcbiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0IHx8IGluZmVybm8uRU1QVFlfT0JKOyAvLyBjb250ZXh0IHNob3VsZCBub3QgYmUgbXV0YWJsZVxyXG59O1xyXG5Db21wb25lbnQucHJvdG90eXBlLmZvcmNlVXBkYXRlID0gZnVuY3Rpb24gZm9yY2VVcGRhdGUgKGNhbGxiYWNrKSB7XHJcbiAgICBpZiAodGhpcy5fdW5tb3VudGVkIHx8ICFpc0Jyb3dzZXIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBhcHBseVN0YXRlKHRoaXMsIHRydWUsIGNhbGxiYWNrKTtcclxufTtcclxuQ29tcG9uZW50LnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uIHNldFN0YXRlIChuZXdTdGF0ZSwgY2FsbGJhY2spIHtcclxuICAgIGlmICh0aGlzLl91bm1vdW50ZWQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMuX2Jsb2NrU2V0U3RhdGUpIHtcclxuICAgICAgICBxdWV1ZVN0YXRlQ2hhbmdlcyh0aGlzLCBuZXdTdGF0ZSwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgICAgICAgICB0aHJvd0Vycm9yKFwiY2Fubm90IHVwZGF0ZSBzdGF0ZSB2aWEgc2V0U3RhdGUoKSBpbiBjb21wb25lbnRXaWxsVXBkYXRlKCkgb3IgY29uc3RydWN0b3IuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvd0Vycm9yKCk7XHJcbiAgICB9XHJcbn07XHJcbkNvbXBvbmVudC5wcm90b3R5cGUuc2V0U3RhdGVTeW5jID0gZnVuY3Rpb24gc2V0U3RhdGVTeW5jIChuZXdTdGF0ZSkge1xyXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gICAgICAgIGlmICghYWxyZWFkeVdhcm5lZCkge1xyXG4gICAgICAgICAgICBhbHJlYWR5V2FybmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGVcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiSW5mZXJubyBXQVJOSU5HOiBzZXRTdGF0ZVN5bmMgaGFzIGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIG5leHQgcmVsZWFzZS4gVXNlIHNldFN0YXRlIGluc3RlYWQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xyXG59O1xyXG5Db21wb25lbnQucHJvdG90eXBlLl91cGRhdGVDb21wb25lbnQgPSBmdW5jdGlvbiBfdXBkYXRlQ29tcG9uZW50IChwcmV2U3RhdGUsIG5leHRTdGF0ZSwgcHJldlByb3BzLCBuZXh0UHJvcHMsIGNvbnRleHQsIGZvcmNlLCBmcm9tU2V0U3RhdGUpIHtcclxuICAgIGlmICh0aGlzLl91bm1vdW50ZWQgPT09IHRydWUpIHtcclxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XHJcbiAgICAgICAgICAgIHRocm93RXJyb3Iobm9PcCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93RXJyb3IoKTtcclxuICAgIH1cclxuICAgIGlmIChwcmV2UHJvcHMgIT09IG5leHRQcm9wcyB8fFxyXG4gICAgICAgIG5leHRQcm9wcyA9PT0gaW5mZXJuby5FTVBUWV9PQkogfHxcclxuICAgICAgICBwcmV2U3RhdGUgIT09IG5leHRTdGF0ZSB8fFxyXG4gICAgICAgIGZvcmNlKSB7XHJcbiAgICAgICAgaWYgKHByZXZQcm9wcyAhPT0gbmV4dFByb3BzIHx8IG5leHRQcm9wcyA9PT0gaW5mZXJuby5FTVBUWV9PQkopIHtcclxuICAgICAgICAgICAgaWYgKCFpc051bGxPclVuZGVmKHRoaXMuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcykgJiYgIWZyb21TZXRTdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8ga2VlcCBhIGNvcHkgb2Ygc3RhdGUgYmVmb3JlIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHNcclxuICAgICAgICAgICAgICAgIHZhciBiZWZvcmVTdGF0ZSA9IGNvbWJpbmVGcm9tKHRoaXMuc3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYmxvY2tSZW5kZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcywgY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ibG9ja1JlbmRlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFmdGVyU3RhdGUgPSB0aGlzLnN0YXRlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJlZm9yZVN0YXRlICE9PSBhZnRlclN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgc3RhdGUgY2hhbmdlZCBpbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzLCByZWFzc2lnbiB0aGUgYmVmb3JlU3RhdGVcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gYmVmb3JlU3RhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBhZnRlclN0YXRlIGFzIHBlbmRpbmcgc3RhdGUgc28gdGhlIGNoYW5nZSBnZXRzIHBpY2tlZCB1cCBiZWxvd1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTZXRTdGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1N0YXRlID0gYWZ0ZXJTdGF0ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5fcGVuZGluZ1NldFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0U3RhdGUgPSBjb21iaW5lRnJvbShuZXh0U3RhdGUsIHRoaXMuX3BlbmRpbmdTdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nU2V0U3RhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLyogVXBkYXRlIGlmIHNjdSBpcyBub3QgZGVmaW5lZCwgb3IgaXQgcmV0dXJucyB0cnV0aHkgdmFsdWUgb3IgZm9yY2UgKi9cclxuICAgICAgICBpZiAoZm9yY2UgfHxcclxuICAgICAgICAgICAgaXNOdWxsT3JVbmRlZih0aGlzLnNob3VsZENvbXBvbmVudFVwZGF0ZSkgfHxcclxuICAgICAgICAgICAgKHRoaXMuc2hvdWxkQ29tcG9uZW50VXBkYXRlICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3VsZENvbXBvbmVudFVwZGF0ZShuZXh0UHJvcHMsIG5leHRTdGF0ZSwgY29udGV4dCkpKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNOdWxsT3JVbmRlZih0aGlzLmNvbXBvbmVudFdpbGxVcGRhdGUpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ibG9ja1NldFN0YXRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50V2lsbFVwZGF0ZShuZXh0UHJvcHMsIG5leHRTdGF0ZSwgY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ibG9ja1NldFN0YXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wcm9wcyA9IG5leHRQcm9wcztcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IG5leHRTdGF0ZTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcclxuICAgICAgICAgICAgaWYgKGluZmVybm8ub3B0aW9ucy5iZWZvcmVSZW5kZXIpIHtcclxuICAgICAgICAgICAgICAgIGluZmVybm8ub3B0aW9ucy5iZWZvcmVSZW5kZXIodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlbmRlciA9IHRoaXMucmVuZGVyKG5leHRQcm9wcywgbmV4dFN0YXRlLCBjb250ZXh0KTtcclxuICAgICAgICAgICAgaWYgKGluZmVybm8ub3B0aW9ucy5hZnRlclJlbmRlcikge1xyXG4gICAgICAgICAgICAgICAgaW5mZXJuby5vcHRpb25zLmFmdGVyUmVuZGVyKHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnByb3BzID0gbmV4dFByb3BzO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gbmV4dFN0YXRlO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBOT19PUDtcclxufTtcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWVtcHR5XHJcbkNvbXBvbmVudC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyIChuZXh0UHJvcHMsIG5leHRTdGF0ZSwgbmV4dENvbnRleHQpIHsgfTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gQ29tcG9uZW50O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9ub2RlX21vZHVsZXMvaW5mZXJuby1jb21wb25lbnQvZGlzdC9pbmRleC5qc1xuLy8gbW9kdWxlIGlkID0gNVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9